<?php
 goto TysiD; TysiD: defined('IN_IA') or exit('Access Denied'); goto n8M83; n8M83: define('ROOT_PATH', IA_ROOT . '/addons/tiger_newhu/'); goto H1VR3; SvJ0b: require_once ROOT_PATH . 'inc/sdk/tbk/TopSdk.php'; goto p1HHQ; H1VR3: require_once ROOT_PATH . 'lib/excel.php'; goto SvJ0b; p1HHQ: class tiger_newhuModuleSite extends WeModuleSite { public $table_request = "tiger_newhu_request"; public $table_goods = "tiger_newhu_goods"; public $table_ad = "tiger_newhu_ad"; private static $t_sys_member = "mc_members"; public function __construct() { goto U_Xfb; CLia2: echo $arr['msg']; goto vlnkK; U_Xfb: session_start(); goto EVGGv; vb6aI: $tktzurl = $_W['siteurl']; goto dzfW9; dzfW9: $loginurl = $_W['siteroot'] . str_replace('./', 'app/', $this->createMobileurl('login')) . '&m=tiger_newhu' . '&tzurl=' . urlencode($tktzurl); goto Zv2dG; vlnkK: exit; goto N2yvB; llm89: $tkurl1 = urlencode($host); goto VzXNb; q7rxs: $cfg = $this->module['config']; goto YWCl1; YFhXT: if (!($c == 'entry')) { goto COm7s; } goto t12OQ; N2yvB: SuT_x: goto oekjY; fOpMs: if (!($c == 'site')) { goto w6H9K; } goto ANHar; rZc85: AlTE2: goto CrFJj; t12OQ: if (!($cfg['logintype'] == 1)) { goto Wm9sg; } goto IRE4R; lvDtg: $do = $_GPC['do']; goto kazLW; sTIIt: pZs1t: goto PrchN; pXy3x: $host = strtolower($host); goto Hi2jN; I8FGL: $url = 'http://api1.laohucms.com/sqnew.php?tbuid=' . $tbuid . '&tkurl=' . $tkurl1 . '&tkurl2=' . $tkurl2 . '&tkip=' . $tkip . '&sign=' . md5($tkip . 'tig'); goto cfhLd; VzXNb: $tkurl2 = urlencode($_W['setting']['site']['url']); goto zTl1l; ooAPM: COm7s: goto a0ctA; zTl1l: $tkip = $this->get_server_ip(); goto I8FGL; cfhLd: $aa = $this->curl_request($url); goto LED2x; ANHar: $host = $_SERVER['HTTP_HOST']; goto pXy3x; BeCbX: if (!($arr['error'] == 2)) { goto SuT_x; } goto CLia2; BiZtk: if (!($c == 'entry')) { goto AlTE2; } goto oLjQz; kazLW: $cfg = $this->module['config']; goto fOpMs; oLjQz: $_W['siteroot'] = $cfg['tknewurl']; goto rZc85; IRE4R: if (!empty($_SESSION['tkuid'])) { goto pZs1t; } goto vb6aI; Zv2dG: if (!($do != 'login' and $do != 'bdlogin' and $do != 'tupian' and $do != 'postorder' and $do != 'tk')) { goto Cn6HJ; } goto RdW2W; EVGGv: global $_W, $_GPC; goto dlD1j; LED2x: $arr = @json_decode($aa, true); goto BeCbX; RdW2W: header('Location: ' . $loginurl); goto OxXNl; OxXNl: exit; goto dF3CC; oekjY: w6H9K: goto q7rxs; PrchN: Wm9sg: goto ooAPM; dlD1j: $c = $_GPC['c']; goto lvDtg; YWCl1: if (empty($cfg['tknewurl'])) { goto K0CsC; } goto BiZtk; CrFJj: K0CsC: goto YFhXT; Hi2jN: $tbuid = $cfg['tbuid']; goto llm89; dF3CC: Cn6HJ: goto sTIIt; a0ctA: } public function doMobileMdorderlist() { goto htRFW; Hg9by: echo '请从微信客户端打开！'; goto SQglV; eGqNR: $order = pdo_fetchall('select * from ' . tablename($this->modulename . '_mdorder') . " where weid='{$_W['uniacid']}' and  uid='{$share['id']}' and sh!=2 order by id desc"); goto obaBh; gfsM5: r7GMo: goto ceHc1; ZfSQY: if (!empty($fans['tkuid'])) { goto Wqlen; } goto jl71i; TXalw: $order = pdo_fetchall('select * from ' . tablename($this->modulename . '_mdorder') . " where weid='{$_W['uniacid']}' {$ddorwehre} and uid='{$share['id']}' order by id desc"); goto C0E6U; jlexI: if ($op == 'df') { goto RtcJ3; } goto a9jWZ; q3k1C: $uid = $share['id']; goto oX3mJ; yaY6w: $order = pdo_fetchall('select * from ' . tablename($this->modulename . '_mdorder') . " where weid='{$_W['uniacid']}' and  uid='{$share['id']}' and sh=2  order by id desc"); goto gfsM5; P21vC: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and from_user='{$fans['openid']}'"); goto q3k1C; a9jWZ: if ($op == 'yf') { goto o0PLf; } goto KN8qy; VGAq5: if (!empty($fans['openid'])) { goto BLLSL; } goto Hg9by; jDDY0: $cfg = $this->module['config']; goto xreCl; g5eyM: $fans = $this->islogin(); goto ZfSQY; SQglV: exit; goto RKkGe; wHGN8: if (empty($uid)) { goto aDVNf; } goto Yo_in; C0E6U: goto r7GMo; goto clGdp; D_Nqf: JQSNa: goto TXalw; obaBh: goto r7GMo; goto RMp5a; KN8qy: goto r7GMo; goto D_Nqf; rX1Nj: goto VJ5BH; goto qh3af; jl71i: $fans = mc_oauth_userinfo(); goto VGAq5; l2KFX: Wqlen: goto P21vC; tl3Id: $op = $_GPC['op']; goto dPwWK; RKkGe: BLLSL: goto l2KFX; ceHc1: include $this->template('md/mdorderlist'); goto aXpi4; qh3af: aDVNf: goto g5eyM; dPwWK: if ($op == 'qb') { goto JQSNa; } goto jlexI; xreCl: $uid = $_GPC['uid']; goto wHGN8; htRFW: global $_W, $_GPC; goto jDDY0; RMp5a: o0PLf: goto yaY6w; oX3mJ: VJ5BH: goto tl3Id; clGdp: RtcJ3: goto eGqNR; Yo_in: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$uid}'"); goto rX1Nj; aXpi4: } public function doMobileMdaddorder() { goto OnBxx; n8zOY: goto okd9k; goto SuDxA; dBovr: $data = array("weid" => $weid, "openid" => $member['from_user'], "uid" => $member['id'], "nickname" => $member['nickname'], "avatar" => $member['avatar'], "orderid" => $orderid, "itemid" => $tkorder['numid'], "jl" => $jl, "jltype" => $jltype, "sh" => $sh, "yongjin" => $tkorder['xgyg'], "price" => $tkorder['fkprice'], "type" => 0, "createtime" => TIMESTAMP); goto JqFbX; KwlwU: $tbsbuid6 = substr($orderid, -6); goto YIla6; GthEv: $mdyaoqing = pdo_fetchcolumn('select COUNT(*) from ' . tablename('tiger_newhu_tkorder') . " where weid='{$_W['uniacid']}' and tbsbuid6='{$member['tbsbuid6']}' and addtime>'{$timetoday}' and orderzt<>'订单失效' order by id desc"); goto cPtrU; mESq7: $orderid = $_GPC['code']; goto mv61o; msUlu: goto LcD6C; goto B0npA; MTGft: if (!($op == 'bd')) { goto tpnkp; } goto DeHgv; B0npA: OxPxN: goto QguPN; EhOIz: die(json_encode(array("error" => 0, "msg" => "会员数据错误、请稍后在试！"))); goto YyYkW; GzlkC: $sh = 4; goto qTk2Y; ijYSs: goto tLZhW; goto EyHTX; PrGt_: $mdtype = 2; goto DpPKY; OPsXY: die(json_encode(array("error" => 1, "msg" => "系统繁忙、数据有错误！"))); goto yXk78; FT0Yu: geh1M: goto PrGt_; j3i2F: die(json_encode(array("error" => 1, "msg" => "订单已经存在！"))); goto n8zOY; C_LYq: ndcuc: goto VK8gm; pqVeG: IQjm4: goto MWZGm; TY1Jk: OCZeQ: goto spSLM; kSfUe: uxAcc: goto I6ikM; d49dm: MLxQs: goto VdkTR; ilKuW: GSoCz: goto ijYSs; IifqL: $sh = 1; goto Po_sP; HPxzf: $sgmdtype = 6; goto ZcFRJ; ZqNdS: die(json_encode(array("error" => 0, "msg" => "一天只能免单一个商品！"))); goto erV08; PZfVs: LcD6C: goto S8zHL; b0_kQ: $mdset = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_miandanset') . " WHERE weid='{$_W['uniacid']}' order by id desc "); goto vCpBw; lYReA: $adzoneid = $pidSplit[3]; goto HaEYo; t6s0u: if (!empty($member['tbsbuid6'])) { goto kmSCF; } goto KwlwU; YyYkW: gozFk: goto MTGft; AnHd0: ZP2k6: goto OPsXY; FpBe2: if (empty($mdset['mdtype'])) { goto g5w0Y; } goto FDBMW; cydEK: goto GSoCz; goto FT0Yu; YD6ip: if ($time > $mdset['endtime']) { goto eUbFV; } goto X9cL8; erV08: fSJyR: goto VraxO; d7Jj9: $mdday = $mdset['mdrensum'] * 86400; goto BdSC0; sliSZ: tLZhW: goto e_ESc; YIla6: $ups = array("tbsbuid6" => $tbsbuid6); goto wtAwg; FDBMW: if ($time < $mdset['starttime']) { goto geh1M; } goto YD6ip; W8Q94: $weid = $_W['uniacid']; goto mESq7; Po_sP: zpcB_: goto dBovr; X9cL8: if ($mdtime > $time) { goto MLxQs; } goto poBdD; ZcFRJ: LkrEo: goto kSfUe; s0wYx: die(json_encode(array("error" => 1, "msg" => "您提交的订单暂未更新，请过15分钟后在提交，感谢您的支持！"))); goto PZfVs; zZPlX: $mdtype = 5; goto Azx4g; poBdD: if (!($mdset['mdyaoqingcount'] >= 1)) { goto XTE4T; } goto Hqk6J; nokKB: kmSCF: goto YxAhG; FmurT: die(json_encode(array("error" => 0, "msg" => "今天免单不满足！"))); goto C_LYq; gIoIb: $tbsbuid6 = substr($orderid, -6); goto rzgfQ; p6bX6: goto zpcB_; goto pqVeG; WE7rU: if (empty($tkorder)) { goto OxPxN; } goto Kff60; O9hr8: $tkorder = pdo_fetch('select * from ' . tablename('tiger_newhu_tkorder') . " where weid='{$weid}' and orderid='{$orderid}'"); goto WE7rU; x3puc: $mdtype = 3; goto oClrG; HvG6t: goto k6nta; goto AnHd0; DeHgv: if (!empty($member['tbsbuid6'])) { goto bZVAj; } goto gIoIb; gsmEh: NAoqP: goto cydEK; mv61o: $member = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_share') . " WHERE weid='{$_W['uniacid']}' and id='{$uid}'"); goto b0_kQ; QguPN: $sh = 0; goto s0wYx; c1aG5: $mdyaoqing = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('tiger_newhu_share') . " WHERE weid='{$_W['uniacid']}' and helpid='{$member['id']}' and createtime>'{$timetoday}' order by id desc "); goto WvIyh; vY9y_: if ($tkorder['orderzt'] == '订单结算') { goto ED8_1; } goto dzDpe; B2fpd: if ($tkorder['orderzt'] == '订单付款') { goto IQjm4; } goto vY9y_; X9_LU: tpnkp: goto XgRKh; b3jpD: $mderr = 1; goto FmurT; VdkTR: $mdtype = 8; goto jDBlX; S8zHL: okd9k: goto vnqj9; OnBxx: global $_W, $_GPC; goto skGTW; a5HaB: goto zpcB_; goto hQAMR; MWZGm: $sh = 3; goto a5HaB; wtAwg: $b = pdo_update('tiger_newhu_share', $ups, array("id" => $member['id'], "weid" => $weid)); goto nokKB; WvIyh: if (!($mdyaoqing >= $mdset['mdyaoqingcount'])) { goto OBq7a; } goto zZPlX; XgRKh: if (empty($mdset['mdrensum'])) { goto lBMdW; } goto d7Jj9; Wwjrb: $uid = $_GPC['uid']; goto W8Q94; qTk2Y: die(json_encode(array("error" => 1, "msg" => "您提交的订单已退款！"))); goto p6bX6; ww_rU: $myorder = pdo_fetch('select * from ' . tablename('tiger_newhu_mdorder') . " where weid='{$weid}' and createtime>'{$mytimetoday}' and uid='{$uid}'"); goto QVxqh; gllVx: lBMdW: goto x1RDU; JLjXv: eUbFV: goto x3puc; jDBlX: qJFpY: goto ZpgCh; skGTW: $op = $_GPC['op']; goto Wwjrb; vnqj9: die(json_encode(array("error" => 1, "msg" => '您提交的订单已经存在！' . $member['nickname']))); goto YNEYc; ZCZjm: $mytimetoday = strtotime(date('Y-m-d', time())); goto ww_rU; Azx4g: OBq7a: goto uExFX; JqFbX: if (pdo_insert('tiger_newhu_mdorder', $data) === false) { goto ZP2k6; } goto t6s0u; x1RDU: $mdday = 1 * 86400; goto TY1Jk; oClrG: die(json_encode(array("error" => 0, "msg" => "免单已结束！"))); goto gsmEh; m3M6a: bZVAj: goto xbITn; cPtrU: if (!($mdyaoqing >= $mdset['mdzgcount'])) { goto LkrEo; } goto HPxzf; Hqk6J: $timetoday = strtotime(date('Y-m-d', time())); goto c1aG5; yC907: if ($tkorder['orderzt'] == '订单失效') { goto fGwYc; } goto B2fpd; XNvCV: $time = time(); goto FpBe2; DpPKY: die(json_encode(array("error" => 0, "msg" => "免单未开始！"))); goto ilKuW; VraxO: if (empty($order)) { goto hGB0D; } goto j3i2F; yXk78: k6nta: goto msUlu; xbITn: die(json_encode(array("error" => 0, "msg" => "绑定订单成功,请提交免单订单号！"))); goto X9_LU; hdxMb: die(json_encode(array("error" => 1, "msg" => "请提交免单商品订单号！"))); goto tfSOR; HaEYo: if (!($adzoneid != $tkorder['tgwid'])) { goto be7sz; } goto hdxMb; I6ikM: goto qJFpY; goto d49dm; SuDxA: hGB0D: goto O9hr8; YxAhG: die(json_encode(array("error" => 1, "msg" => "订单提交成功"))); goto HvG6t; BdSC0: goto OCZeQ; goto gllVx; uExFX: XTE4T: goto UPBo4; QVxqh: if (empty($myorder)) { goto fSJyR; } goto ZqNdS; hQAMR: ED8_1: goto IifqL; Kff60: $pidSplit = explode('_', $mdset['miandanpid']); goto lYReA; ZpgCh: goto NAoqP; goto JLjXv; imKmG: $b = pdo_update('tiger_newhu_share', $ups, array("id" => $member['id'], "weid" => $weid)); goto m3M6a; spSLM: $mdtime = $member['createtime'] + $mdday; goto XNvCV; tfSOR: be7sz: goto yC907; vCpBw: if (!empty($uid)) { goto gozFk; } goto EhOIz; UPBo4: if (!($mdset['mdzgcount'] >= 1)) { goto uxAcc; } goto I95oN; EyHTX: g5w0Y: goto sliSZ; dzDpe: goto zpcB_; goto MMfsG; I95oN: $timetoday = strtotime(date('Y-m-d', time())); goto GthEv; VK8gm: $order = pdo_fetch('select * from ' . tablename('tiger_newhu_mdorder') . " where weid='{$weid}' and orderid='{$orderid}'"); goto ZCZjm; MMfsG: fGwYc: goto GzlkC; e_ESc: if (!(empty($mdtype) && empty($sgmdtype))) { goto ndcuc; } goto b3jpD; rzgfQ: $ups = array("tbsbuid6" => $tbsbuid6); goto imKmG; YNEYc: } public function doMobileMd() { goto Brrge; ifoKX: $fans = mc_oauth_userinfo(); goto DdPZh; h1RLi: exit(json_encode(array("pages" => $pager, "data" => $list, "lm" => 1))); goto c9bun; Poksj: header('Location: ' . $loginurl); goto eT72M; YjfAc: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_miandangoods') . " where weid='{$_W['uniacid']}'  order by id desc LIMIT " . ($pindex - 1) * $psize . ",{$psize}"); goto KkC09; OS3no: $mdday = $mdset['mdrensum'] * 86400; goto yhUuX; DdPZh: if (!empty($fans)) { goto S48p1; } goto jHQrm; MYEPm: $member = $this->getmember($fans, $mc['uid']); goto CftfW; c9bun: echo '<pre>'; goto RbTPP; IwlIT: $member = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$uid}'"); goto e6D13; jQ6UG: if (!($mdyaoqing >= $mdset['mdyaoqingcount'])) { goto h0erM; } goto Io1ho; yhUuX: goto LgkUO; goto X6f_H; Brrge: global $_W, $_GPC; goto AgvRf; YdClT: $mdtime = $member['createtime'] + $mdday; goto hSXV3; zpCEH: NZtR3: goto nfh5a; IpGMP: $mdyaoqing = pdo_fetchcolumn('select COUNT(*) from ' . tablename('tiger_newhu_tkorder') . " where weid='{$_W['uniacid']}' and tbsbuid6='{$member['tbsbuid6']}' and addtime>'{$timetoday}' and orderzt<>'订单失效' order by id desc"); goto Fes04; XIEWf: dWfir: goto cr5J1; Io1ho: $mdtype = 5; goto tk9Jf; u8C3u: if (empty($mdset['mdrensum'])) { goto QdGl7; } goto OS3no; sswc8: $timetoday = strtotime(date('Y-m-d', time())); goto IpGMP; lB3ap: $mdyaoqing = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('tiger_newhu_share') . " WHERE weid='{$_W['uniacid']}' and helpid='{$member['id']}' and createtime>'{$timetoday}' order by id desc "); goto jQ6UG; L4e10: exit; goto YDi95; HpW0u: QUmaS: goto Mn9iE; wnPhI: if (empty($uid)) { goto dWfir; } goto IwlIT; zr4RB: S48p1: goto pLmf5; XUuXY: if (empty($mdset['mdtype'])) { goto iCJ6F; } goto ZRb2V; OjrzJ: $mderr = 1; goto foAb_; A6C84: $uid = $_GPC['uid']; goto wnPhI; YDi95: sw10Y: goto WiSpf; cr5J1: $fans = $this->islogin(); goto hXTRc; FBHy8: if (!($mdset['mdyaoqingcount'] >= 1)) { goto Sgenl; } goto wkeES; SGD_h: $pindex = max(1, intval($_GPC['page'])); goto q59DZ; iKsV6: if (!(empty($mdtype) && empty($sgmdtype))) { goto o1rDL; } goto OjrzJ; X6f_H: QdGl7: goto G6L0D; FluhH: if (!($op == 1)) { goto sw10Y; } goto SGD_h; NnTyI: OCOqG: goto To9Sz; nfh5a: goto wBVHS; goto ZT1uG; BsoAF: ln5JM: goto deR29; fM07f: wBVHS: goto iKsV6; Fes04: if (!($mdyaoqing >= $mdset['mdzgcount'])) { goto UYBnH; } goto n42wF; ZRb2V: if ($time < $mdset['starttime']) { goto ln5JM; } goto cgNog; To9Sz: goto Th0eS; goto QQ9f4; deR29: $mdtype = 2; goto zpCEH; nXiua: $cfg = $this->module['config']; goto A6C84; L1RPU: UYBnH: goto NnTyI; IwYsP: $mdtype = 8; goto xg8s7; v60TG: goto Yi8yM; goto HpW0u; G6L0D: $mdday = 1 * 86400; goto XbCDn; jHQrm: $loginurl = $_W['siteroot'] . str_replace('./', 'app/', $this->createMobileurl('login')) . '&m=tiger_newhu' . '&tzurl=' . urlencode($tktzurl); goto Poksj; XbCDn: LgkUO: goto YdClT; pLmf5: cwAvH: goto MYEPm; tk9Jf: h0erM: goto Ek5Dc; MUrWS: if ($mdtime > $time) { goto XtW0j; } goto FBHy8; AgvRf: $op = $_GPC['op']; goto bQdHL; gskHf: Yi8yM: goto e8dTf; CftfW: LNskz: goto u8C3u; cgNog: if ($time > $mdset['endtime']) { goto QUmaS; } goto MUrWS; p6eUZ: $mdtype = 1; goto fM07f; xg8s7: Th0eS: goto v60TG; RbTPP: print_r($list); goto L4e10; Ek5Dc: Sgenl: goto f8A7v; ZT1uG: iCJ6F: goto p6eUZ; foAb_: o1rDL: goto FluhH; Mn9iE: $mdtype = 3; goto gskHf; bQdHL: $mdset = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_miandanset') . " WHERE weid='{$_W['uniacid']}' order by id desc "); goto nXiua; WiSpf: include $this->template('md/index'); goto qBICO; hXTRc: if (!empty($fans['tkuid'])) { goto cwAvH; } goto ifoKX; wkeES: $timetoday = strtotime(date('Y-m-d', time())); goto lB3ap; q59DZ: $psize = 20; goto YjfAc; n42wF: $sgmdtype = 6; goto L1RPU; e8dTf: goto NZtR3; goto BsoAF; hSXV3: $time = time(); goto XUuXY; KkC09: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename($this->modulename . '_miandangoods') . " where weid='{$_W['uniacid']}'"); goto yWkem; QQ9f4: XtW0j: goto IwYsP; yWkem: $pager = pagination($total, $pindex, $psize); goto h1RLi; e6D13: goto LNskz; goto XIEWf; eT72M: exit; goto zr4RB; f8A7v: if (!($mdset['mdzgcount'] >= 1)) { goto OCOqG; } goto sswc8; qBICO: } public function doMobileMdadd() { goto GwnYb; JPt2G: goto BqwsG; goto iZ6_v; UUla8: $loginurl = $_W['siteroot'] . str_replace('./', 'app/', $this->createMobileurl('login')) . '&m=tiger_newhu' . '&tzurl=' . urlencode($tktzurl); goto pKnzv; xGcFA: BqwsG: goto hkG6l; pKnzv: header('Location: ' . $loginurl); goto RyOa4; GwnYb: global $_W, $_GPC; goto p4IKw; RyOa4: exit; goto JnxjA; imxzu: $member = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$uid}'"); goto JPt2G; viGUM: if (!empty($fans['tkuid'])) { goto SFM4s; } goto ByxbG; JWghR: $fans = $this->islogin(); goto viGUM; rsYVn: $member = $this->getmember($fans, $mc['uid']); goto xGcFA; iZ6_v: SH7jO: goto JWghR; hkG6l: include $this->template('md/mdadd'); goto eHCql; S1poc: SFM4s: goto rsYVn; cn2MW: $uid = $_GPC['uid']; goto p50Gg; p50Gg: if (empty($uid)) { goto SH7jO; } goto imxzu; ByxbG: $fans = mc_oauth_userinfo(); goto ZiWlA; JnxjA: si9qt: goto S1poc; ZiWlA: if (!empty($fans)) { goto si9qt; } goto UUla8; p4IKw: $mdset = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_miandanset') . " WHERE weid='{$_W['uniacid']}' order by id desc "); goto cn2MW; eHCql: } public function doMobileTaolijin() { goto C7qQH; YRBnj: $secret = $cfg['tksecretKey']; goto t1YhA; V3bp2: exit; goto PSywI; ycXwW: $c->secretKey = $secret; goto wUoey; zh_Jq: $req->setPerFace('10'); goto gnxZP; Ssixt: $req->setUseEndTime('1'); goto JujFu; uhIur: $req->setAdzoneId('110806711'); goto xOcwU; gnxZP: $req->setSendStartTime('2019-06-20 00:00:00'); goto unHeo; xQh4M: echo $resp['result']['msg_info']; goto Wou9i; unHeo: $req->setSendEndTime('2019-06-11 00:00:00'); goto Ssixt; pjqp0: $appkey = $cfg['tkAppKey']; goto YRBnj; Wou9i: echo '<pre>'; goto hW6Q3; t1YhA: $c = new TopClient(); goto YDBvP; JujFu: $req->setUseEndTimeMode('1'); goto GtL5S; c16Ax: $req->setSecuritySwitch('false'); goto zh_Jq; SbQgD: $resp = json_decode(json_encode($resp), TRUE); goto xQh4M; YDBvP: $c->appkey = $appkey; goto ycXwW; hW6Q3: print_r($resp); goto V3bp2; xOcwU: $req->setItemId('584558401295'); goto DpHx7; C7qQH: $cfg = $this->module['config']; goto pjqp0; IjT3v: $req->setUserTotalWinNumLimit('1'); goto c16Ax; DpHx7: $req->setTotalNum('1'); goto wMP1r; wUoey: $req = new TbkDgVegasTljCreateRequest(); goto uhIur; xsAVs: $resp = $c->execute($req); goto SbQgD; GtL5S: $req->setUseStartTime('2019-06-20'); goto xsAVs; wMP1r: $req->setName('淘礼金来啦'); goto IjT3v; PSywI: } public function doMobileAppwnqtzclass() { goto m0m6B; Np4Eh: exit(json_encode(array("data" => $catlist, "title" => $qtz['title'], "picurl" => tomedia($qtz['picurl']), "bjcolor" => $qtz['bjcolor']))); goto OVtyO; ltBC7: foreach ($qtzcate as $k => $v) { $catlist[$k] = explode('-', $v); sOSz9: } goto e62ch; m0m6B: global $_W, $_GPC; goto xBP7H; xBP7H: $id = trim($_GPC['id']); goto TdIF_; TdIF_: $qtz = pdo_fetch('select * from ' . tablename('tiger_newhu_qtzlist') . " where weid='{$_W['uniacid']}' and id='{$id}'"); goto OdVWw; OdVWw: $qtzcate = explode('|', $qtz['cate']); goto V8Xo8; e62ch: TRkD2: goto Np4Eh; V8Xo8: $catlist = array(); goto ltBC7; OVtyO: } public function doMobileAppwnqtzlist() { goto z5vuc; zmGjJ: goto HvgQt; goto daOOY; kqDdj: $goodslist = $this->tblmnewgoods($page, $MaterialId); goto Jpe2I; zsC5W: $islm = $this->getlmid($MaterialId); goto W4PqU; UR7yW: goto O8R6H; goto jTMq2; z5vuc: global $_W, $_GPC; goto R2My3; HzNzO: if (!($MaterialId == 1)) { goto vkAd8; } goto pKSX0; jEhEq: if (!empty($page)) { goto rbLDP; } goto Kp6Py; ef6Ep: vkAd8: goto jEhEq; k8gn0: if (empty($page)) { goto BH6JM; } goto gXguD; Kp6Py: $page = 0; goto D0jqm; govSr: $goodslist = $this->tbqtz($page, $MaterialId); goto UR7yW; pKSX0: $MaterialId = 7950; goto ef6Ep; W4PqU: $page = $_GPC['page']; goto e6ll8; R2My3: $MaterialId = trim($_GPC['MaterialId']); goto zsC5W; gXguD: $page = $page + 1; goto zmGjJ; jTMq2: lWdV6: goto HzNzO; e6ll8: if ($islm == 1) { goto lWdV6; } goto k8gn0; acxPF: $page = 1; goto jwVBz; daOOY: BH6JM: goto acxPF; jwVBz: HvgQt: goto govSr; Jpe2I: O8R6H: goto iV8TC; D0jqm: rbLDP: goto kqDdj; iV8TC: exit(json_encode(array("data" => $goodslist, "lm" => 2))); goto tNVpp; tNVpp: } public function doMobileWnqtzgoods() { goto Ga3sj; YW8i3: $MaterialId = trim($_GPC['MaterialId']); goto aNyzv; yfjyH: AMijJ: goto c1Lpr; fxWpg: foreach ($qtzcate as $k => $v) { $catlist[$k] = explode('-', $v); yzEda: } goto XkzQ2; itQXE: $op = $_GPC['op']; goto f3WF3; Y1x35: hGqDI: goto OO_FI; aNyzv: $qtz = pdo_fetch('select * from ' . tablename('tiger_newhu_qtzlist') . " where weid='{$_W['uniacid']}' and id='{$id}'"); goto WxbAw; Ga3sj: global $_W, $_GPC; goto ahy1m; gYvqS: $page = $_GPC['page']; goto itQXE; wt27U: include $this->template('zt/wnqtzgoods'); goto ofsXu; Opp9K: exit(json_encode(array("pages" => "", "data" => $goodslist, "lm" => 2))); goto pRq3f; OO_FI: if (!($MaterialId == 1)) { goto AMijJ; } goto thEo6; Uj14c: $MaterialId = $qtz['cateid']; goto uKrTQ; XkzQ2: oCfwE: goto gYvqS; LVrhZ: $qtzcate = explode('|', $qtz['cate']); goto pt7Ww; pRq3f: mNg6Z: goto wt27U; c1Lpr: if (!empty($page)) { goto oJBxh; } goto NydAI; pt7Ww: $catlist = array(); goto fxWpg; CmcUh: FIout: goto jjssF; ahy1m: $id = trim($_GPC['id']); goto ZCOa3; v7sSI: goto pZCrR; goto CmcUh; thEo6: $MaterialId = 7950; goto yfjyH; VUpeL: goto rZrSX; goto Y1x35; O_5RS: $goodslist = $this->tblmnewgoods($page, $MaterialId); goto QMq5_; jjssF: $page = 1; goto VYWug; f3WF3: if (!($op == 'toajax')) { goto mNg6Z; } goto ccxiX; uKrTQ: VZ_pd: goto LVrhZ; WxbAw: if (!empty($MaterialId)) { goto VZ_pd; } goto Uj14c; ZzC5U: $page = $page + 1; goto v7sSI; NydAI: $page = 0; goto iGcHL; a24uu: if (empty($page)) { goto FIout; } goto ZzC5U; ccxiX: $islm = $this->getlmid($MaterialId); goto p7jvT; VYWug: pZCrR: goto gAmvH; p7jvT: if ($islm == 1) { goto hGqDI; } goto a24uu; iGcHL: oJBxh: goto O_5RS; gAmvH: $goodslist = $this->tbqtz($page, $MaterialId); goto VUpeL; QMq5_: rZrSX: goto Opp9K; ZCOa3: $tigerapp = $_GPC['tigerapp']; goto YW8i3; ofsXu: } function getlmid($lmid) { goto Uyc1J; hcRed: OavSK: goto m9FUi; hsiNR: CvFQv: goto RAFrd; m9FUi: return 2; goto hsiNR; iMvCF: goto CvFQv; goto hcRed; wY3yo: return 1; goto iMvCF; Uyc1J: $arr = array("21715", "21714", "21713", "21712", "21711", "21710", "21707", "21704", "21705", "21703", "21702", "21706", "21708", "21701", "23593", "23595", "23594", "23590", "23589", "23587", "23945", "23946", "23947", "23959", "23942", "23941", "23920", "23958", "23955", "23956", "23954", "23957", "23922", "22423", "23080", "23165", "23081", "23086", "23087", "23083", "23082", "23085", "23084", "23021", "23019", "23020", "23018", "23111", "23161", "22738", "22737", "22733", "22735", "22659", "22652", "22653", "22654", "22650", "22657", "23114", "22922", "23089", "22914", "22913", "22912", "22911", "22910", "22908", "23134", "22907", "22909", "23204", "23195", "23239", "22677", "19541", "19543", "19540", "19539", "19542", "19579", "19728", "19727", "19719", "19718", "19646", "19705", "19703", "19623", "18493", "19701", "19625", "18845", "18847", "11830", "11842", "7951", "7950", "16697", "16335", "15444", "18935", "18934", "18933", "18931", "18930", "1", "7950", "18620", "18621", "18622", "18623", "18625", "18626", "18627", "18634", "18635", "18636", "18637", "18577", "18578", "18579", "18580", "18581", "18582", "18583", "18584", "18585", "18586", "18587", "18591", "18592", "18593", "18594", "18595", "18596", "18597", "18598", "18599", "18600", "18601", "18628", "18629", "18630", "18631", "18632", "18914", "18906", "18903", "18909", "18910", "18912", "18968", "18969", "18970", "18971", "18976", "18620", "18621", "18622", "18623", "18625", "18626", "18627", "18634", "18635", "18636", "18637", "16217", "15895", "15893", "15896", "15897", "15898", "15899", "15900", "15903", "15902", "15901", "18222", "13671", "13865", "13851", "13852", "13858", "13855", "13854", "13856", "13853", "13857", "13859", "13968", "17122", "14971", "14976", "17359", "11049"); goto F32yJ; F32yJ: if (!in_array($lmid, $arr)) { goto OavSK; } goto wY3yo; RAFrd: } public function tbqtz($page, $MaterialId) { goto CSePP; Lqvcj: foreach ($goods['result_list']['map_data'] as $k => $v) { goto AxhED; irY8Z: goto e9Q4P; goto BFvFZ; MGOtO: $list[$k]['coupon_click_url'] = $goods['coupon_click_url']; goto xIuFi; d44dK: goto ewyco; goto eP0To; cMu0C: $list[$k]['itemid'] = $goods['item_id']; goto MVnqc; R3FmA: $itemendprice = number_format($itemendprice, 2); goto QKJm0; w3MY_: $list[$k]['click_url'] = $goods['click_url']; goto MGOtO; CnOni: $list[$k]['sj'] = $sj; goto hPN4n; MP_K0: $itemendprice = $goods['zk_final_price'] - $conmany; goto R3FmA; qYWnO: goto ftpQE; goto VsleU; GIqnX: $conmany = 0; goto vsHK8; hM1kw: j8heg: goto mgIN5; mgIN5: $conmany = $goods['coupon_amount']; goto MT2Hk; x4S4j: $sj = number_format($sj, 2, '.', ''); goto n3374; AxhED: $goods = $v; goto LovY0; LovY0: if (!empty($goods['coupon_amount'])) { goto j8heg; } goto GIqnX; SZhNj: $list[$k]['lm'] = 1; goto ztdiu; KNpWW: $list[$k]['itemtitle'] = $goods['title']; goto Gi6wQ; VzIzK: $ratea = $this->ptyjjl($itemendprice, $goods['commission_rate'], $cfg); goto encDE; vsHK8: goto GjHQi; goto hM1kw; y0el1: if (empty($ratea)) { goto ei8vn; } goto m2NmS; jNFul: $appcfg = pdo_fetch('select * from ' . tablename('tiger_newhu_appset') . " where weid='{$_W['uniacid']}'"); goto LlNEr; dDXPd: $list[$k]['pid'] = $pid; goto SZhNj; MT2Hk: GjHQi: goto MP_K0; VsleU: JoN4C: goto VzIzK; vd34h: $list[$k]['yj'] = '预估赚:' . $ratea; goto CnOni; uotcG: e9Q4P: goto vd34h; e5hpa: $list[$k]['itempic'] = 'http:' . $goods['pict_url']; goto dDXPd; JoAyI: $sj = $ratea * $appset['jl'] / 100 + $ratea; goto x4S4j; hPN4n: $list[$k]['rate'] = $ratea; goto TUAqH; QKJm0: $status = 1; goto KNpWW; b6Pdp: ewyco: goto irY8Z; e6EER: $list[$k]['couponmoney'] = $conmany; goto uqmzZ; uqmzZ: $list[$k]['itemsale'] = $goods['volume']; goto w3MY_; BFvFZ: ei8vn: goto UBCm0; Gi6wQ: $list[$k]['shoptype'] = $goods['user_type']; goto cMu0C; WHHy5: tNmng: goto HQe4B; xIuFi: $list[$k]['shopTitle'] = $goods['shop_title']; goto e5hpa; nLa9k: $sj = 0; goto d44dK; UBCm0: $sj = '0'; goto uotcG; q1rqv: if ($cfg['lbratetype'] == 3) { goto JoN4C; } goto Ll4d2; m2NmS: $appset = pdo_fetch('SELECT * FROM ' . tablename('tiger_app_tuanzhangset') . " WHERE weid='{$_W['uniacid']}' order by px desc "); goto jNFul; n3374: $sj = '升级赚:' . $sj; goto b6Pdp; encDE: ftpQE: goto y0el1; Ll4d2: $ratea = $this->sharejl($itemendprice, $goods['commission_rate'], $bl, $share, $cfg); goto qYWnO; ztdiu: $list[$k]['commission_rate'] = $goods['commission_rate']; goto q1rqv; eP0To: MDYhz: goto JoAyI; TUAqH: $list[$k]['couponnum'] = $goods['coupon_remain_count']; goto WHHy5; LlNEr: if ($appcfg['sjztype'] == 1) { goto MDYhz; } goto nLa9k; lZk0_: $list[$k]['itemendprice'] = $itemendprice; goto e6EER; MVnqc: $list[$k]['itemprice'] = $goods['zk_final_price']; goto lZk0_; HQe4B: } goto P0CPD; AQ6gr: NzQjW: goto MXQsk; WC9EQ: oMCYQ: goto XkVHd; P0CPD: drrkG: goto Zup8x; MXQsk: $tksign = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_tksign') . " WHERE  tbuid='{$cfg['tbuid']}'"); goto WC9EQ; ShmQF: $tksign = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_tksign') . " WHERE  memberid='{$memberid}'"); goto hx0AH; hx0AH: goto oMCYQ; goto AQ6gr; cfFyp: $cfg = $this->module['config']; goto qGUis; qGUis: $pidSplit = explode('_', $cfg['ptpid']); goto ya7Dk; XkVHd: $goods = qtz($tksign['sign'], $cfg['ptpid'], $MaterialId, $page); goto Lqvcj; CSePP: global $_W, $_GPC; goto YtJmd; sFsoj: if (empty($memberid)) { goto NzQjW; } goto ShmQF; ya7Dk: $memberid = $pidSplit[1]; goto sFsoj; YtJmd: include IA_ROOT . '/addons/tiger_newhu/inc/sdk/tbk/goodsapi.php'; goto cfFyp; Zup8x: return $list; goto wf_9o; wf_9o: } public function tblmnewgoods($page, $hdid) { goto td0PU; g2IbK: $bl = pdo_fetch('select * from ' . tablename('tiger_wxdaili_set') . " where weid='{$_W['uniacid']}'"); goto Zs6Vh; B2O4f: foreach ($data['resultList'] as $k => $v) { goto cexdu; TnKwa: $istm = 1; goto pb_U3; Xf91p: i2k5Z: goto xDnx4; Vg1Vq: $list[$k]['itemid'] = $v['itemId']; goto wCA8O; CKVkr: $list[$k]['sj'] = $sj; goto MrdQH; T6WmD: if (empty($ratea)) { goto AYzcq; } goto Q_W1B; if6qp: if ($appcfg['sjztype'] == 1) { goto Brdt3; } goto ofIv0; UGywA: x1_lC: goto ZvEt3; pb_U3: XWqND: goto EzTPB; O_dhy: $list[$k]['url'] = $v['url']; goto I2a8g; e0FUo: $ratea = $this->sharejl($itemendprice, $tkrates, $bl, $share, $cfg); goto dNTyJ; BB1ek: $istm = $v['userType']; goto W19xG; Xvvw7: $list[$k]['yj'] = '预估赚:' . $ratea; goto CKVkr; mJm7d: $list[$k]['rate'] = $ratea; goto Xvvw7; f22oM: YVxEd: goto O73c1; lNvhX: $list[$k]['couponnum'] = $v['couponsurplus']; goto OB3pX; JFPqz: $tkrates = $v['tkMktRate'] / 100; goto zXSIe; A06B4: if ($v['isTmall'] == true) { goto eraLM; } goto s6LON; VCibk: icnYM: goto l0_gm; Q_W1B: $appset = pdo_fetch('SELECT * FROM ' . tablename('tiger_app_tuanzhangset') . " WHERE weid='{$_W['uniacid']}' order by px desc "); goto NTFAx; I2a8g: $list[$k]['shopTitle'] = $v['sellerNickName']; goto NvcYq; ZvEt3: if (empty($v['userType'])) { goto Vpimm; } goto BB1ek; l0_gm: $tkrates = $v['calTkRate'] / 100; goto f22oM; NvcYq: $list[$k]['itempic'] = 'http:' . $v['pic']; goto kzK58; i9r65: sZtr3: goto T6WmD; s6LON: $istm = 0; goto EE3ym; PFI4T: goto x1_lC; goto a0N29; MrdQH: $list[$k]['itemtitle'] = $v['itemName']; goto TyNG3; dOuUD: $sj = $ratea * $appset['jl'] / 100 + $ratea; goto XS_qC; EE3ym: goto XWqND; goto Blh9J; TQBWi: $list[$k]['itemendprice'] = $itemendprice; goto SVUEw; wze3w: if (empty($v['tkMktRate'])) { goto icnYM; } goto JFPqz; MWDOL: Brdt3: goto dOuUD; buA7O: $list[$k]['itemsale'] = $v['monthSellCount']; goto O_dhy; f3Tz_: $itemendprice = number_format($itemendprice, 2); goto wze3w; cexdu: $itemendprice = $v['promotionPrice'] - $v['couponAmount']; goto f3Tz_; Blh9J: eraLM: goto TnKwa; udhj_: $sj = '升级赚:' . $sj; goto W5ofe; SVUEw: $list[$k]['couponmoney'] = $v['couponAmount']; goto buA7O; XS_qC: $sj = number_format($sj, 2, '.', ''); goto udhj_; aiAW0: $list[$k]['lm'] = 1; goto lNvhX; NTFAx: $appcfg = pdo_fetch('select * from ' . tablename('tiger_newhu_appset') . " where weid='{$_W['uniacid']}'"); goto if6qp; xDnx4: $ratea = $this->ptyjjl($itemendprice, $tkrates, $cfg); goto i9r65; EKF0U: $sj = '0'; goto UGywA; O73c1: if ($cfg['lbratetype'] == 3) { goto i2k5Z; } goto e0FUo; sb54E: Vpimm: goto A06B4; a0N29: AYzcq: goto EKF0U; ofIv0: $sj = 0; goto Ngb6I; dNTyJ: goto sZtr3; goto Xf91p; wCA8O: $list[$k]['itemprice'] = $v['promotionPrice']; goto TQBWi; kzK58: $list[$k]['pid'] = $pid; goto aiAW0; TyNG3: $list[$k]['shoptype'] = $istm; goto Vg1Vq; Ngb6I: goto dHlb9; goto MWDOL; W19xG: goto QmWlM; goto sb54E; zXSIe: goto YVxEd; goto VCibk; EzTPB: QmWlM: goto mJm7d; W5ofe: dHlb9: goto PFI4T; OB3pX: ObFWI: goto DOAPi; DOAPi: } goto WInfB; nJVrN: hwKAY: goto bb3WM; YA4xR: print_r($list); goto oKiXQ; Poh4P: echo '<pre>'; goto YA4xR; GHiz8: $cfg = $this->module['config']; goto g2IbK; td0PU: global $_W, $_GPC; goto GHiz8; tlpjt: $page = 0; goto nJVrN; I3BES: $data = $this->tblmres($data); goto c1PYw; MVCHZ: return $list; goto Poh4P; bb3WM: $data = array("pNum" => $page, "pSize" => 15, "floorId" => $hdid, "refpid" => $cfg['ptpid']); goto I3BES; WInfB: U_yXb: goto MVCHZ; c1PYw: $list = array(); goto B2O4f; Zs6Vh: if (!empty($page)) { goto hwKAY; } goto tlpjt; oKiXQ: } public function doMobileCs6() { goto ECiG0; OLJHr: $dtkapp_secret = $cfg['dtkapp_secret']; goto K8RVJ; KbE51: $dtkgoodsview = $dtkgodsv['data']; goto B7nd2; ECiG0: $cfg = $this->module['config']; goto MkxH1; KYr8S: $mancom = $dtkgoodsview['couponConditions']; goto Ni6Se; qwoRk: $Quan_id = $this->Text_qzj($dtkgoodsview['couponLink'], 'activityId=', '&'); goto KYr8S; vVZ8f: print_r($dtkgoodsview); goto bxgux; p10We: function newgoodsview($goodsId, $dtkapp_key, $dtkapp_secret) { goto mAvA6; davli: $output = curl_exec($ch); goto rgcfT; FN0qC: $url = $host . '?' . http_build_query($data); goto Nzt4S; CsQtt: return $output; goto o4zWH; YpG3l: $data = ["appKey" => $dtkapp_key, "version" => "v1.1.0", "goodsId" => $goodsId]; goto PVm5m; PVm5m: $data['sign'] = makeSign($data, $appSecret); goto FN0qC; WFN8i: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto e5fcK; mAvA6: $host = 'https://openapi.dataoke.com/api/goods/get-goods-details'; goto ysXcx; ysXcx: $appKey = $dtkapp_key; goto CQ1Iw; Nzt4S: $ch = curl_init(); goto ebXC0; e5fcK: curl_setopt($ch, CURLOPT_TIMEOUT, 10); goto cbdmP; CQ1Iw: $appSecret = $dtkapp_secret; goto YpG3l; ebXC0: curl_setopt($ch, CURLOPT_URL, $url); goto WFN8i; rgcfT: curl_close($ch); goto CsQtt; cbdmP: curl_setopt($ch, CURLOPT_HEADER, 0); goto davli; o4zWH: } goto mpVrS; mpVrS: $dtkgods = newgoodsview('575889114043', $dtkapp_key, $dtkapp_secret); goto m0o1O; m5cG7: echo '<pre>'; goto JWSfd; Ni6Se: $money = $dtkgoodsview['couponPrice']; goto m5cG7; m0o1O: $dtkgodsv = @json_decode($dtkgods, true); goto KbE51; B7nd2: $dtkgoodsview['couponLink'] = $dtkgoodsview['couponLink'] . '&'; goto qwoRk; JWSfd: echo $Quan_id . '券' . $money . '【满' . $mancom . '元使用】'; goto vVZ8f; MkxH1: $dtkapp_key = $cfg['dtkapp_key']; goto OLJHr; K8RVJ: function makeSign($data, $appSecret) { goto FJ1jg; mgLne: QPFvM: goto IRfZc; aJRxz: $str = ''; goto EISms; EISms: foreach ($data as $k => $v) { $str .= '&' . $k . '=' . $v; ltOv6: } goto mgLne; FJ1jg: ksort($data); goto aJRxz; IRfZc: $str = trim($str, '&'); goto ByXAk; ByXAk: $sign = strtoupper(md5($str . '&key=' . $appSecret)); goto ZfGr7; ZfGr7: return $sign; goto tFRn0; tFRn0: } goto p10We; bxgux: } public function tblmres($data) { goto w3zg8; uHwSG: $json = $this->curl_request($url, '', $cookies, 1); goto UFCs4; y3Dqw: $jsondata = json_encode($data); goto VxQ2u; uwSl0: $singjson = $_m_h5_tk . '&' . $t . '&' . $appkey . '&' . $jsondata; goto Bh__n; nkIej: $dataarr = @json_decode($jsondata, true); goto bk5WI; Bh__n: $sign = md5($singjson); goto IIZ2h; jYIvO: $url = 'https://acs.m.taobao.com/h5/mtop.alimama.union.xt.en.api.entry/1.0/?jsv=2.4.16&appKey=' . $appkey; goto uHwSG; w3zg8: $appkey = '12574478'; goto tD2dQ; UFCs4: $_m_h5_tk = $this->qudaimapianduan($json['cookie'], '_m_h5_tk=', '_'); goto uwSl0; YophG: $jsondata = str_replace('mtopjsonp1(', '', $json); goto cLLFo; IIZ2h: $url = 'https://acs.m.taobao.com/h5/mtop.alimama.union.xt.en.api.entry/1.0/?jsv=2.4.16&appKey=' . $appkey . '&t=' . $t . '&sign=' . $sign . '&api=mtop.alimama.union.xt.en.api.entry&v=1.0&AntiCreep=true&type=jsonp&dataType=jsonp&callback=mtopjsonp1&data=' . urlencode($jsondata); goto pAcRo; pAcRo: $json = $this->curl_request($url, '', $json['cookie'], 0); goto YophG; VxQ2u: $jsondata = str_replace('\\/', '/', $jsondata); goto jYIvO; bk5WI: return $dataarr['data']['recommend']; goto Kf5ZJ; cLLFo: $jsondata = str_replace(')', '', $jsondata); goto nkIej; tD2dQ: $t = '0'; goto y3Dqw; Kf5ZJ: } public function doMobileCs4() { goto enHRL; ouj3L: print_r($data); goto V80rF; V80rF: exit; goto Suvu5; e9tAp: $data = $this->tbviewimg($data); goto NOrW2; NOrW2: echo '<pre>'; goto ouj3L; M9N4e: echo $this->getMillisecond(); goto e9tAp; osT7H: echo 11; goto M9N4e; enHRL: $data = array("id" => "19673324092", "type" => "1"); goto osT7H; Suvu5: } public function getMillisecond() { goto PZkG1; CW8zm: $ran = rand(100, 300); goto aWsMH; X3Pu5: return $t; goto R6cUM; PZkG1: $time = time(); goto CW8zm; aWsMH: $t = $time . $ran; goto X3Pu5; R6cUM: } public function tbviewimg($data) { goto JEaYQ; vKY6S: $jsondata = str_replace('mtopjsonp1(', '', $json); goto QaGGb; qwq7O: $jsondata = str_replace('\\/', '/', $jsondata); goto fqYLk; eIsC8: return $dataarr; goto SKFOE; lPhfH: $jsondata = json_encode($data); goto qwq7O; iX0BR: $url = 'https://h5api.m.taobao.com/h5/mtop.taobao.detail.getdesc/6.0/?jsv=2.4.0&appKey=' . $appkey . '&t=' . $t . '&sign=' . $sign . '&api=mtop.taobao.detail.getdesc&v=6.0&AntiFlool=true&AntiCreep=true&type=jsonp&dataType=jsonp&callback=mtopjsonp1&data=' . urlencode($jsondata); goto lj5bE; aIilB: $json = $this->curl_request($url, '', $cookies, 1); goto H9m_Q; QaGGb: $jsondata = str_replace(')', '', $jsondata); goto Q51AC; PHTt_: return $img; goto jxpm9; JEaYQ: $appkey = '12574478'; goto Zshs3; Vll68: foreach ($descarr[1] as $k => $v) { goto uwaqN; Uk8Mb: $xcximg[$k] = $v; goto qJ7iL; uwaqN: $img .= '<img src=\'' . $v . '\'/>'; goto Uk8Mb; qJ7iL: wGu0D: goto lNbfc; lNbfc: } goto GGI0p; WhHDx: $singjson = $_m_h5_tk . '&' . $t . '&' . $appkey . '&' . $jsondata; goto CB36h; lj5bE: $json = $this->curl_request($url, '', $json['cookie'], 0); goto vKY6S; CB36h: $sign = md5($singjson); goto iX0BR; GGI0p: CW54w: goto PHTt_; Zshs3: $t = $this->getMillisecond(); goto lPhfH; CSBdx: preg_match_all('<img[\\s\\S]*?src="([\\s\\S]*?)"[\\s\\S]*?>', $descstr, $descarr); goto Vll68; H9m_Q: $_m_h5_tk = $this->qudaimapianduan($json['cookie'], '_m_h5_tk=', '_'); goto WhHDx; fqYLk: $url = 'https://h5api.m.taobao.com/h5/mtop.taobao.detail.getdesc/6.0/?jsv=2.4.0&appKey=' . $appkey; goto aIilB; SKFOE: $descstr = $dataarr['data']['pcDescContent']; goto CSBdx; Q51AC: $dataarr = @json_decode($jsondata, true); goto eIsC8; jxpm9: } function qudaimapianduan($ss, $qian, $hou) { goto TYq2w; Ld_Vk: $output = substr($ss, $i + strlen($qian), strlen($ss)); goto Lq6Hb; D1g_L: return $output; goto bTKRa; TYq2w: $i = strpos($ss, $qian); goto Ld_Vk; OblIQ: $output = substr($output, 0, $i); goto D1g_L; Lq6Hb: $i = strpos($output, $hou); goto OblIQ; bTKRa: } public function jd1fgoufl() { goto eD1QO; YhhrS: $hjkarr = @json_decode($hjkview, true); goto ZwF4e; ZwF4e: return $hjkarr; goto T9bor; gh7rb: $hjkpost = array("hdid" => 3); goto HrQDv; eD1QO: $hjkurl = 'https://api.91fyt.com/index.php/api/v1/hd/hdgoodscname'; goto gh7rb; HrQDv: $hjkview = $this->curl_request($hjkurl, $hjkpost); goto YhhrS; T9bor: } public function jd1fgougoodlist($page, $cid) { goto STj9U; STj9U: $hjkurl = 'https://api.91fyt.com/index.php/api/v1/hd/hdgoodslist'; goto iD21k; eeL6p: $hjkview = $this->curl_request($hjkurl, $hjkpost); goto DYvNW; DYvNW: $hjkarr = @json_decode($hjkview, true); goto aGgUj; iD21k: $hjkpost = array("hdid" => 3, "pagesize" => 10, "pageindex" => $page, "cid" => $cid); goto eeL6p; aGgUj: return $hjkarr; goto bAG0u; bAG0u: } public function jd1fgougoodurl($goods_id, $subunionid) { goto fpCDY; XsgaC: $hjkarr = @json_decode($hjkview, true); goto wZbZa; wZbZa: return $hjkarr; goto NWsyZ; zpGkr: $hjkpost = array("memberid" => 1014414, "hdid" => 3, "goods_id" => $goods_id, "subunionid" => $subunionid); goto NaGp3; NaGp3: $hjkview = $this->curl_request($hjkurl, $hjkpost); goto XsgaC; fpCDY: $hjkurl = 'https://api.91fyt.com/index.php/api/v1/hd/hdgetunionurlapi'; goto zpGkr; NWsyZ: } public function jd1fgorder($subunionid = "", $page = 1) { goto S70Od; BUblg: $hjkarr = @json_decode($hjkview, true); goto fnYsC; EZSBH: $hjkview = $this->curl_request($hjkurl, $hjkpost); goto BUblg; fnYsC: return $hjkarr; goto nvH0f; U6rBN: $hjkpost = array("memberid" => 1014414, "hdid" => 3, "pageindex" => $page, "pagesize" => 50, "subunionid" => $subunionid); goto EZSBH; S70Od: $hjkurl = 'https://api.91fyt.com/index.php/api/v1/hd/hdorderlistapi'; goto U6rBN; nvH0f: } public function dlzdsh($uid, $share, $guanliopenid = "", $cfg = "") { goto BV21f; CnNGB: GgkZ1: goto DQAkY; bugo5: DbvVP: goto EIc3K; XzAZN: $this->postText($share['from_user'], $dlmsg); goto iEOiF; FD_4r: $pddpidres = pdo_fetch('select * from ' . tablename('tiger_wxdaili_pddpid') . " where weid='{$_W['uniacid']}' and type=0 order by id desc "); goto fWwQm; EIc3K: $jdpidres = pdo_fetch('select * from ' . tablename('tiger_wxdaili_jdpid') . " where weid='{$_W['uniacid']}' and type=0 order by id desc "); goto iJn8m; txl1X: $dlmsg = '<a href=\'' . $tturl . '\'>进入合伙人中心</a>
重点：进入合伙人中心，复制口令，打开淘♂寳APP完成渠道授权，未授权不能跟单结算佣金！'; goto XzAZN; BV21f: global $_W; goto vW9qE; ZC7l0: $res = pdo_update('tiger_wxdaili_jdpid', array("type" => 1, "uid" => $share['id'], "nickname" => $share['nickname']), array("id" => $jdpidres['id'])); goto Df7uD; cnCH0: if (empty($res)) { goto makB_; } goto NBGV5; bheRz: if (empty($guanliopenid)) { goto GgkZ1; } goto CnNGB; gHiV8: if (empty($guanliopenid)) { goto JLvJQ; } goto LACNx; Er4q2: $res = pdo_update('tiger_newhu_share', array("tgwid" => 11111), array("id" => $uid, "weid" => $_W['uniacid'])); goto bugo5; LACNx: JLvJQ: goto B4c7w; hFv_t: if (empty($jdpidres['pid'])) { goto eioAf; } goto to7cM; fWwQm: if (!empty($pddpidres)) { goto XvNUL; } goto bheRz; DQAkY: XvNUL: goto hFv_t; rN397: makB_: goto m7qip; vW9qE: if (!empty($share['tgwid'])) { goto DbvVP; } goto Er4q2; N2fbJ: if (empty($res)) { goto rSeEa; } goto ZC7l0; to7cM: $res = pdo_update('tiger_newhu_share', array("jdpid" => $jdpidres['pid'], "dltype" => 1), array("id" => $uid, "weid" => $_W['uniacid'])); goto N2fbJ; NBGV5: $res = pdo_update('tiger_wxdaili_pddpid', array("type" => 1, "uid" => $share['id'], "nickname" => $share['nickname']), array("id" => $pddpidres['id'])); goto rN397; m7qip: pKNOy: goto hdhOG; fXpm8: eioAf: goto C2fH9; iJn8m: if (!empty($jdpidres)) { goto ZHfBL; } goto gHiV8; hdhOG: $tturl = $cfg['tknewurl'] . 'app/index.php?i=' . $_W['uniacid'] . '&c=entry&do=newmember&m=tiger_wxdaili'; goto txl1X; B4c7w: ZHfBL: goto FD_4r; LFuR5: $res = pdo_update('tiger_newhu_share', array("pddpid" => $pddpidres['pid'], "dltype" => 1), array("id" => $uid, "weid" => $_W['uniacid'])); goto cnCH0; C2fH9: if (empty($pddpidres['pid'])) { goto pKNOy; } goto LFuR5; Df7uD: rSeEa: goto fXpm8; iEOiF: } public function doMobileMobanxiaoxi() { goto Gpfey; wHW14: $str = $this->mbmsg($openid, $mb, $mb['mbid'], $url = '', $fans, $orderid, $cfg = '', $valuedata = ''); goto xKBC2; v4YJY: $id = $_GPC['id']; goto JkHio; key4q: $mb = pdo_fetch('select * from ' . tablename($this->modulename . '_mobanmsg') . " where weid='{$_W['uniacid']}' and id='{$id}'"); goto uRx2W; uRx2W: $fans = pdo_fetch('select * from ' . tablename($this->modulename . '_share') . " where weid='{$_W['uniacid']}' and from_user='{$yhopenid}'"); goto wHW14; OwoIc: exit; goto pIoab; u17EV: $yhopenid = $_GPC['yhopenid']; goto dUVMT; JkHio: $orderid = $_GPC['orderid']; goto key4q; a34yw: $openid = $_GPC['openid']; goto u17EV; pIoab: sgq0o: goto v4YJY; xKBC2: print_r($str); goto N5sD8; Gpfey: global $_W, $_GPC; goto a34yw; Aq0nc: echo 'openid必填'; goto OwoIc; dUVMT: if (!empty($openid)) { goto sgq0o; } goto Aq0nc; N5sD8: } public function doMobileKefuxiaoxi() { goto Y7aI9; WHI_E: $openid = $_GPC['openid']; goto eTJL5; Y7aI9: global $_W, $_GPC; goto WHI_E; lpkU3: echo $str; goto vyZlE; ToL3t: $str = $this->postText($openid, $msg); goto lpkU3; ORmwM: echo 'openid必填'; goto aE8zP; aE8zP: exit; goto q5fx1; eTJL5: if (!empty($openid)) { goto t9NKc; } goto ORmwM; ApQft: $msg = $_GPC['msg']; goto ToL3t; q5fx1: t9NKc: goto ApQft; vyZlE: } public function jiangli($openid, $order) { goto J9BXJ; tKAWp: $data['cengji'] = 3; goto YGcr7; u7_53: $data['avatar'] = $sjmember['avatar']; goto qzo9g; J9BXJ: global $_W; goto i_LHS; VzhM7: iSUnE: goto iSAAm; g0Kwc: goto kBL3k; goto qQmof; rGqpB: pdo_insert($this->modulename . '_order', $data); goto c0nKt; wBh4g: $msg0 = str_replace('#昵称#', $member['nickname'], $bl['zfmsg0']); goto Fm9AJ; qQmof: SfCB_: goto r1kir; iSAAm: $data['price'] = $order['price'] * $bl['level2'] / 100; goto FThKR; mY3w2: goto mZNUb; goto Ptcxh; VCc45: $msg2 = str_replace('#金额#', $data['price'], $msg2); goto clxzp; AYdqL: $data['nickname'] = $sjmember['nickname']; goto u7_53; IJfWO: $data['price'] = $bl['glevel3']; goto g0Kwc; uAQP5: QH81V: goto Bz6BJ; QGVVt: if (empty($data['price'])) { goto q9hT8; } goto oAnCO; ZMnrg: $this->postText($smember['from_user'], $msg3); goto blK5e; XqEga: kBL3k: goto X5NDM; addTp: $data['memberid'] = $hmember['id']; goto vlqaM; FcIyf: if (empty($data['price'])) { goto UVtUT; } goto UsLnw; hsdW1: $data['cengji'] = 1; goto RzvuT; dSO77: $hmember = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_share') . " WHERE id = '{$sjmember['helpid']}' and weid='{$_W['uniacid']}' and dltype=1 order by id desc limit 1"); goto Mv_A1; o5zUP: $data['openid'] = $hmember['from_user']; goto qRHG0; ysQax: if (empty($data['price'])) { goto Md0Us; } goto O1jY9; HKqRF: UVtUT: goto l9h7r; qRHG0: $data['cengji'] = 2; goto FqIEW; k45tA: U1amj: goto F2zc8; zmnbq: $member = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_share') . " WHERE id = '{$order['memberid']}' and weid='{$_W['uniacid']}'"); goto EWebn; CwDWR: $sjmember = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_share') . " WHERE id = '{$member['helpid']}' and weid='{$_W['uniacid']}' and dltype=1"); goto PCu6E; X5NDM: $data['memberid'] = $smember['id']; goto iWKE7; oAnCO: $msg2 = str_replace('#昵称#', $member['nickname'], $bl['zfmsg2']); goto VCc45; LR5ti: $msg1 = str_replace('#金额#', $data['price'], $msg1); goto H0_Dn; O1jY9: $msg3 = str_replace('#昵称#', $member['nickname'], $bl['zfmsg3']); goto qOklJ; vlqaM: $data['nickname'] = $hmember['nickname']; goto hExvZ; aGH20: $data['price'] = $bl['glevel2']; goto o780X; guJ4M: $this->mc_jl($hmember['id'], 1, 10, $data['price'], $data['msg'], $order['orderno']); goto rGqpB; clxzp: $this->postText($hmember['from_user'], $msg2); goto guJ4M; l9h7r: xWWnM: goto DmkBP; qzo9g: $data['openid'] = $sjmember['from_user']; goto hsdW1; xb48g: FGSS0: goto GhyIS; Ptcxh: mZ6Ct: goto gA0RS; Mv_A1: if (!empty($bl['level1'])) { goto iSUnE; } goto aGH20; o780X: goto BXrSo; goto VzhM7; fkTDp: if (empty($sjmember['from_user'])) { goto xWWnM; } goto FcIyf; H0_Dn: $this->postText($sjmember['from_user'], $msg1); goto eNKGT; j4HAy: XF6E0: goto WW3Uu; DmkBP: if (empty($sjmember['helpid'])) { goto k2GU9; } goto dSO77; PCu6E: if (!empty($bl['level1'])) { goto mZ6Ct; } goto r1Mqd; qfkuu: $this->postText($member['from_user'], $msg0); goto czKKs; YGcr7: $data['msg'] = $member['nickname'] . '三级奖励'; goto KoxSu; FThKR: BXrSo: goto addTp; p7d13: $cfg = $this->module['config']; goto xGa8n; mG1ha: Md0Us: goto xb48g; x4n7z: pdo_insert($this->modulename . '_order', $data); goto mG1ha; iCBTi: if (empty($hmember['openid'])) { goto QH81V; } goto QGVVt; S6YHI: $data['openid'] = $smember['from_user']; goto tKAWp; F2zc8: k2GU9: goto j4HAy; bIiU0: $data['memberid'] = $sjmember['id']; goto AYdqL; r1Mqd: $data['price'] = $bl['glevel1']; goto mY3w2; iWKE7: $data['nickname'] = $smember['nickname']; goto iDUVV; KoxSu: if (empty($smember['openid'])) { goto FGSS0; } goto ysQax; RzvuT: $data['msg'] = $member['nickname'] . '一级奖励'; goto fkTDp; GhyIS: file_put_contents(IA_ROOT . '/addons/tiger_wxdaili/log.txt', '
' . json_encode($uid . '--3--' . $data['price']), FILE_APPEND); goto k45tA; A5tNx: if (!empty($bl['level1'])) { goto SfCB_; } goto IJfWO; r1kir: $data['price'] = $order['price'] * $bl['level3'] / 100; goto XqEga; Fm9AJ: $msg0 = str_replace('#金额#', $order['price'], $msg0); goto qfkuu; EWebn: $data = array("weid" => $_W['uniacid'], "orderno" => $order['orderno'], "goods_id" => $order['goods_id'], "state" => 1, "paystate" => 1, "paytime" => $order['paytime'], "createtime" => time()); goto wBh4g; Mj3Oi: $smember = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_share') . " WHERE id = '{$hmember['helpid']}' and weid='{$_W['uniacid']}' and dltype=1 order by id desc limit 1"); goto A5tNx; blK5e: $this->mc_jl($smember['id'], 1, 10, $data['price'], $data['msg'], $order['orderno']); goto x4n7z; czKKs: if (empty($member['helpid'])) { goto XF6E0; } goto CwDWR; s2kPW: pdo_insert($this->modulename . '_order', $data); goto HKqRF; Bz6BJ: if (empty($hmember['helpid'])) { goto U1amj; } goto Mj3Oi; UsLnw: $msg1 = str_replace('#昵称#', $member['nickname'], $bl['zfmsg1']); goto LR5ti; gA0RS: $data['price'] = $order['price'] * $bl['level1'] / 100; goto dUWjL; iDUVV: $data['avatar'] = $smember['avatar']; goto S6YHI; dUWjL: mZNUb: goto bIiU0; eNKGT: $this->mc_jl($sjmember['id'], 1, 10, $data['price'], $data['msg'], $order['orderno']); goto s2kPW; hExvZ: $data['avatar'] = $hmember['avatar']; goto o5zUP; c0nKt: q9hT8: goto uAQP5; xGa8n: $bl = pdo_fetch('select * from ' . tablename('tiger_wxdaili_set') . " where weid='{$_W['uniacid']}'"); goto zmnbq; FqIEW: $data['msg'] = $member['nickname'] . '二级奖励'; goto iCBTi; i_LHS: load()->model('mc'); goto p7d13; qOklJ: $msg3 = str_replace('#金额#', $data['price'], $msg3); goto ZMnrg; WW3Uu: } public function jdtbtgetorder($appKey, $appSecret, $accesstoken, $unionid, $page, $time) { goto wF9OO; R60gU: $arr = @json_decode($arr, true); goto yb2iF; FSWFA: $req->setPageIndex($page); goto c_DT0; c1JVe: $c->accessToken = $accesstoken; goto zltUC; wF9OO: $c = new JdClient(); goto Ob2DP; yb2iF: $arrres = $arr['data']; goto WvFDk; IqQGF: return $arrres; goto ggHTS; c_DT0: $req->setPageSize(400); goto de7On; Ob2DP: $c->appKey = $appKey; goto tg2N4; cMkbb: $resp = $resp->result; goto R60gU; tg2N4: $c->appSecret = $appSecret; goto c1JVe; sXl5t: Z2S2h: goto IqQGF; jMnIS: $req = new UnionServiceQueryOrderListRequest(); goto G1gCI; WvFDk: if (!empty($arrres)) { goto Z2S2h; } goto zj1pY; G1gCI: $req->setUnionId($unionid); goto LySoE; de7On: $resp = $c->execute($req, $c->accessToken); goto cMkbb; zj1pY: $arrres = $arr; goto sXl5t; zltUC: $c->serverUrl = 'https://gw.api.360buy.com/routerjson'; goto jMnIS; LySoE: $req->setTime($time); goto FSWFA; ggHTS: } public function get_server_ip() { goto vg66H; vg66H: if (isset($_SERVER)) { goto DuVm9; } goto mavyI; P_fH5: XKAF1: goto PJkWG; PJkWG: IKIhE: goto umNoe; g4D7A: i1Yhy: goto OsxvB; LG4yK: goto XKAF1; goto g4D7A; OsxvB: $server_ip = $_SERVER['SERVER_ADDR']; goto P_fH5; abq5W: DuVm9: goto UfYrl; mavyI: $server_ip = getenv('SERVER_ADDR'); goto Uv3yd; Uv3yd: goto IKIhE; goto abq5W; umNoe: return $server_ip; goto zZih0; UfYrl: if ($_SERVER['SERVER_ADDR']) { goto i1Yhy; } goto QJOi1; QJOi1: $server_ip = $_SERVER['LOCAL_ADDR']; goto LG4yK; zZih0: } public function sms($tel, $accessKeyId, $accessKeySecret, $SignName, $TemplateCode, $code) { goto vc9s4; qQcVA: b1kiY: goto hAqzg; Cfk4K: $cfg = $this->module['config']; goto d2o8z; WUOvJ: goto BcDzC; goto qQcVA; VmOWc: return '发送失败'; goto WUOvJ; AK5fD: $rurl = $this->curl_request($smsurl); goto vMWIi; d2o8z: $smsurl = $_W['siteroot'] . 'addons/tiger_newhu/inc/sms/sms/sendSms.php?tel=' . $tel . '&accessKeyId=' . $accessKeyId . '&accessKeySecret=' . $accessKeySecret . '&SignName=' . $SignName . '&TemplateCode=' . $TemplateCode . '&code=' . $code . ''; goto AK5fD; E3sOP: BcDzC: goto NT6dD; vMWIi: file_put_contents(IA_ROOT . '/addons/tiger_newhu/sms_log.txt', '
' . json_encode($rurl), FILE_APPEND); goto qad5i; vc9s4: global $_W, $_GPC; goto Cfk4K; qad5i: if (strpos($rurl, 'OK') !== false) { goto b1kiY; } goto VmOWc; hAqzg: return 'OK'; goto E3sOP; NT6dD: } public function getzdorder($member, $cfg) { goto TghRF; TghRF: global $_W; goto vMcgK; SRb0g: return ''; goto xCAv7; tuaou: foreach ($tkorlist as $k => $tkorder) { goto keYSu; xDDtx: hsjtR: goto mkSvg; O1bRm: if (empty($dltgw)) { goto kOGrc; } goto Viphg; Viphg: goto n2El0; goto vWlZ_; eGIpy: $rjmember = pdo_fetch('select * from ' . tablename($this->modulename . '_share') . " where weid='{$_W['uniacid']}' and id='{$yjmember['helpid']}' order by id desc"); goto M26EX; PBYym: goto SBg7j; goto RWhPl; vgO6i: $jltype = 1; goto ZBokG; O0SRz: if ($cfg['gdfxtype'] == 1) { goto Ebn2Y; } goto j3oxd; keYSu: $adzoneid = $pidSplit[3]; goto sidfi; dUQp2: $data3 = array("weid" => $_W['uniacid'], "openid" => $rjmember['from_user'], "memberid" => $rjmember['openid'], "uid" => $rjmember['id'], "nickname" => $rjmember['nickname'], "jl" => $jl, "jltype" => $jltype, "avatar" => $rjmember['avatar'], "jlnickname" => $member['nickname'], "jlavatar" => $member['avatar'], "orderid" => $orderid, "yongjin" => $tkorder['xgyg'], "itemid" => $tkorder['numid'], "type" => 2, "sh" => $sh, "createtime" => TIMESTAMP); goto QY4nY; Qcis_: MUuNV: goto DBmvf; tQg8C: pdo_insert($this->modulename . '_order', $data3); goto qUkOy; daTLR: if ($cfg['gdfxtype'] == 1) { goto WWez1; } goto zM0tt; iFNDi: JRbAA: goto tFpuh; V0Lhe: pdo_insert($this->modulename . '_order', $data2); goto gavOL; GFPsm: if ($cfg['fxtype'] == 2) { goto dzopf; } goto s0BDt; RJmAm: goto FHtLZ; goto HLufN; N20QV: AJfb4: goto RuciO; Xm1fo: N62tN: goto nzplP; sidfi: if (!($tkorder['tgwid'] == $adzoneid)) { goto T_FSP; } goto xAeFj; nFxHW: KMRl6: goto SdvRW; YG7G5: kNVc8: goto ZYfmo; nzplP: goto zqQYK; goto nFxHW; QY4nY: $order = pdo_fetchall('select * from ' . tablename($this->modulename . '_order') . " where weid='{$_W['uniacid']}' and type=2 and orderid={$orderid}  and itemid='{$tkorder['numid']}'"); goto m6e0E; AL85Z: if (empty($cfg['ejf'])) { goto dlCgI; } goto PLncz; zziVd: dlCgI: goto xDDtx; Vl0Fi: $jltype = 0; goto H4p7u; WZaYS: $jl = $cfg['zgf']; goto SsiIA; O1hoG: if ($cfg['gdfxtype'] == 1) { goto zbXBW; } goto Zzr2y; wyEuH: tAqUk: goto UG5tc; VFX_F: zqQYK: goto pkUCz; mkSvg: bTI0F: goto zuTEJ; RuciO: $jl = $cfg['ejf']; goto lk705; qGTy2: $jl = $cfg['yjf']; goto Xm1fo; xAeFj: goto n2El0; goto Tq8gl; dL_IE: AcW7p: goto lhgQ0; mhaex: $yjtxmsg = str_replace('#金额#', $jl, $yjtxmsg); goto Ss1x7; blOSd: if (!empty($order)) { goto zrtfr; } goto V0Lhe; y7YoY: $jltype = 1; goto TqZ29; QBuVG: $ejtxmsg = str_replace('#订单号#', $orderid, $ejtxmsg); goto X4WV9; HLufN: SlJlM: goto daTLR; qUkOy: NQexm: goto zziVd; pkUCz: $yjmember = pdo_fetch('select * from ' . tablename($this->modulename . '_share') . " where weid='{$_W['uniacid']}' and id='{$member['helpid']}' order by id desc"); goto ul3xd; IPUQp: if (!($resorder != false)) { goto kNVc8; } goto evXha; wvYpe: Ma6yQ: goto wZHj0; mUN65: goto x5nUb; goto N20QV; fe9uT: $jl = number_format($jl, 2, '.', ''); goto yYeeN; jM7eM: if ($cfg['fxtype'] == 2) { goto RC7b3; } goto fJxnL; fJxnL: goto ogTUD; goto NcBvG; s0BDt: goto MUuNV; goto qoTbD; evXha: pdo_update($this->modulename . '_tkorder', array("zdgd" => 1), array("weid" => $_W['uniacid'], "orderid" => $orderid)); goto YG7G5; IFVYD: if (empty($tkorder['relation_id'])) { goto HCvZU; } goto R5adL; m6e0E: if (!empty($order)) { goto NQexm; } goto tQg8C; t57G5: $this->postText($rjmember['from_user'], $ejtxmsg); goto dUQp2; H4p7u: goto ogTUD; goto HQaPD; JemPA: if ($cfg['fxtype'] == 1) { goto XNMuD; } goto E5Ly_; zM0tt: $jl = $tkorder['xgyg'] * $cfg['ejf'] / 100; goto fe9uT; Qcv76: if ($cfg['fxtype'] == 1) { goto AcW7p; } goto tiZoR; B8OF2: if ($cfg['fxtype'] == 1) { goto PNlWD; } goto jM7eM; j3oxd: $jl = intval($tkorder['xgyg'] * $cfg['zgf'] / 100 * $cfg['jfbl']); goto C9M1W; r3n5K: $sh = 3; goto JemPA; EYJJA: $order = pdo_fetch('select * from ' . tablename($this->modulename . '_order') . " where weid='{$_W['uniacid']}' and orderid='{$tkorder['orderid']}' and itemid='{$tkorder['numid']}'"); goto SFFoG; zRDS9: $order = pdo_fetchall('select * from ' . tablename($this->modulename . '_order') . " where weid='{$_W['uniacid']}' and type=1 and orderid={$orderid} and itemid='{$tkorder['numid']}'"); goto blOSd; bT_MR: $jl = $cfg['zgf']; goto wyEuH; yLdJN: $yjtxmsg = str_replace('#订单号#', $orderid, $yjtxmsg); goto mhaex; ZBokG: ogTUD: goto r3n5K; ym99q: FHtLZ: goto eGIpy; vWlZ_: kOGrc: goto r6fWy; Z4kwA: dzopf: goto O1hoG; F8Vfm: GtiF5: goto ym99q; SdvRW: if ($cfg['gdfxtype'] == 1) { goto JRbAA; } goto f1MQ_; WnPCy: $resorder = pdo_insert($this->modulename . '_order', $data); goto IPUQp; lk705: x5nUb: goto RJmAm; sCUg6: $jl = intval($tkorder['xgyg'] * $cfg['yjf'] / 100 * $cfg['jfbl']); goto qaPIq; C9M1W: goto tAqUk; goto VnsYd; qaPIq: goto N62tN; goto Wb4FC; R5adL: $dltgw = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and qdid='{$tkorder['relation_id']}'"); goto g2YqK; TqZ29: SBg7j: goto mK1AM; tzMAY: $data = array("weid" => $_W['uniacid'], "openid" => $member['from_user'], "memberid" => $member['openid'], "uid" => $member['id'], "nickname" => $member['nickname'], "avatar" => $member['avatar'], "orderid" => $orderid, "itemid" => $tkorder['numid'], "jl" => $jl, "jltype" => $jltype, "sh" => $sh, "yongjin" => $tkorder['xgyg'], "type" => 0, "createtime" => TIMESTAMP); goto WnPCy; VnsYd: Ebn2Y: goto bT_MR; xgviZ: RDqGc: goto VFX_F; iQbmr: goto zqQYK; goto dL_IE; uZ2Ib: $jl = number_format($jl, 2, '.', ''); goto vI8a3; I6ZM6: XNMuD: goto uvbE7; E5Ly_: if ($cfg['fxtype'] == 2) { goto vwjzI; } goto Q5RKn; Tq8gl: T_FSP: goto B88F2; f1MQ_: $jl = $tkorder['xgyg'] * $cfg['yjf'] / 100; goto uZ2Ib; mK1AM: if ($cfg['fxtype'] == 1) { goto OaMgw; } goto GFPsm; gavOL: zrtfr: goto sybcv; wZHj0: if ($cfg['gdfxtype'] == 1) { goto AJfb4; } goto VPi4j; U0gwq: WWez1: goto gBRbi; DBmvf: $orderid = $tkorder['orderid']; goto tzMAY; RWhPl: vwjzI: goto y7YoY; UG5tc: goto MUuNV; goto Z4kwA; bpJk7: hmYj0: goto O1bRm; Ss1x7: $this->postText($yjmember['from_user'], $yjtxmsg); goto A0QRc; Zzr2y: $jl = $tkorder['xgyg'] * $cfg['zgf'] / 100; goto Xzf5_; gBRbi: $jl = $cfg['ejf']; goto F8Vfm; M26EX: $ejtxmsg = str_replace('#昵称#', $member['nickname'], $cfg['ejtxmsg']); goto QBuVG; SsiIA: Bhisa: goto Qcis_; ybKTv: HCvZU: goto a7JX_; r6fWy: qazZj: goto EYJJA; XGCgc: zbXBW: goto WZaYS; sybcv: yo9iC: goto iAkBy; vI8a3: goto RDqGc; goto iFNDi; Wb4FC: c2hkr: goto qGTy2; Xzf5_: $jl = number_format($jl, 2, '.', ''); goto gnOej; a7JX_: $dltgw = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and tgwid='{$tkorder['tgwid']}'"); goto bpJk7; P3Cbj: goto FHtLZ; goto wvYpe; A0QRc: $data2 = array("weid" => $_W['uniacid'], "openid" => $yjmember['from_user'], "memberid" => $yjmember['openid'], "uid" => $yjmember['id'], "nickname" => $yjmember['nickname'], "jl" => $jl, "jltype" => $jltype, "avatar" => $yjmember['avatar'], "jlnickname" => $member['nickname'], "jlavatar" => $member['avatar'], "orderid" => $orderid, "yongjin" => $tkorder['xgyg'], "itemid" => $tkorder['numid'], "type" => 1, "sh" => $sh, "createtime" => TIMESTAMP); goto zRDS9; AFIrF: n2El0: goto Dtf9g; NcBvG: PNlWD: goto Vl0Fi; HQaPD: RC7b3: goto vgO6i; X4WV9: $ejtxmsg = str_replace('#金额#', $jl, $ejtxmsg); goto t57G5; Hmnkb: if ($cfg['fxtype'] == 2) { goto SlJlM; } goto P3Cbj; tiZoR: if ($cfg['fxtype'] == 2) { goto KMRl6; } goto iQbmr; SFFoG: if (!empty($order['id'])) { goto Wp1rR; } goto B8OF2; ZYfmo: if (empty($member['helpid'])) { goto bTI0F; } goto VY0gg; PLncz: if ($cfg['fxtype'] == 1) { goto Ma6yQ; } goto Hmnkb; g2YqK: goto hmYj0; goto ybKTv; qoTbD: OaMgw: goto O0SRz; iAkBy: if (empty($yjmember['helpid'])) { goto hsjtR; } goto AL85Z; lhgQ0: if ($cfg['gdfxtype'] == 1) { goto c2hkr; } goto sCUg6; VY0gg: if (empty($cfg['yjf'])) { goto yo9iC; } goto Qcv76; tFpuh: $jl = $cfg['yjf']; goto xgviZ; gnOej: goto Bhisa; goto XGCgc; B88F2: if (!($cfg['dlddfx'] == 1)) { goto qazZj; } goto IFVYD; ul3xd: $yjtxmsg = str_replace('#昵称#', $member['nickname'], $cfg['yjtxmsg']); goto yLdJN; yYeeN: goto GtiF5; goto U0gwq; Q5RKn: goto SBg7j; goto I6ZM6; uvbE7: $jltype = 0; goto PBYym; zuTEJ: Wp1rR: goto AFIrF; VPi4j: $jl = intval($tkorder['xgyg'] * $cfg['ejf'] / 100 * $cfg['jfbl']); goto mUN65; Dtf9g: } goto be1qQ; PhNtP: $tkorlist = pdo_fetchall('select * from ' . tablename($this->modulename . '_tkorder') . " where weid='{$_W['uniacid']}' and tbsbuid6='{$tbsbuid6}' and addtime>'{$ztime}' and orderzt<>'订单失效' and zdgd<>1 order by id desc"); goto ievE_; ievE_: $mdset = pdo_fetch('SELECT * FROM ' . tablename('tiger_newhu_miandanset') . " WHERE weid='{$weid}' order by id desc "); goto pPvL8; K2Fv3: return ''; goto kB1nu; Sr0K1: if (!($member['dltype'] == 1)) { goto q8ROc; } goto UcWI2; F1lFd: $ztime = mktime(0, 0, 0, date('m'), date('d') - date('w') + 1 - 20, date('Y')); goto PhNtP; pPvL8: $pidSplit = explode('_', $mdset['miandanpid']); goto tuaou; be1qQ: ztOt7: goto MNAKL; vMcgK: if (!($cfg['zdgdtype'] != 1)) { goto p1Xv1; } goto SRb0g; kB1nu: dAl4L: goto iOjsU; ZUjEX: q8ROc: goto iIBbh; UX2hc: B5daT: goto sSSoB; OHcOb: $bl = pdo_fetch('select * from ' . tablename('tiger_wxdaili_set') . " where weid='{$weid}'"); goto Rqno2; Rqno2: if (!($bl['dlfxtype'] == 1)) { goto Y6Rjb; } goto Sr0K1; iIBbh: Y6Rjb: goto UX2hc; UcWI2: return ''; goto ZUjEX; iOjsU: $tbsbuid6 = $member['tbsbuid6']; goto F1lFd; sSSoB: if (!empty($member['tbsbuid6'])) { goto dAl4L; } goto K2Fv3; xCAv7: p1Xv1: goto ZDfjW; ZDfjW: if (!pdo_tableexists('tiger_wxdaili_set')) { goto B5daT; } goto OHcOb; MNAKL: } public function getmember($fans = "", $wqid = "", $helpid = "", $lytype = 0) { goto vgWEv; LeJ7V: kU0p2: goto UWdr9; T1Iny: JS6d1: goto Gclss; U53kG: return $share; goto hOQZT; UWdr9: goto Mzl_Y; goto UEKs6; wP3Dx: $updata = array("from_user" => $fans['openid'], "openid" => $wqid, "nickname" => $fans['nickname'], "avatar" => $fans['avatar']); goto Z6Vjj; A_nQL: return ''; goto O4VsV; vgWEv: global $_W; goto WIdJJ; e5sw1: pdo_update('tiger_newhu_share', $updata, array("weid" => $_W['uniacid'], "from_user" => $fans['openid'])); goto mwSxQ; hs7pf: pdo_update('tiger_newhu_share', $updata, array("weid" => $_W['uniacid'], "from_user" => $fans['openid'])); goto siB62; qRoou: $share['id'] = pdo_insertid(); goto BI9RK; qSHdW: $cfg = $this->module['config']; goto eBAG2; wq2kn: $this->dlzdsh($share['id'], $share, '', $cfg); goto OZOXO; wdEVh: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and from_user='{$fans['openid']}'"); goto xDa99; Jsdz3: return $share; goto FOnPP; LRjWQ: B8J3y: goto jEqaP; aoyQQ: return $share; goto d6GiJ; UEKs6: g2Fer: goto wP3Dx; x7DpC: if (!empty($fans['unionid'])) { goto B8J3y; } goto xCk3L; siB62: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and from_user='{$fans['openid']}'"); goto XIgHO; mwSxQ: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and from_user='{$fans['openid']}'"); goto E382l; xCk3L: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and from_user='{$fans['openid']}'"); goto RVbMw; mxPlI: DvafN: goto x7DpC; gSlhM: if (!empty($fans['openid'])) { goto j6Mpw; } goto A_nQL; XIgHO: return $share; goto LeJ7V; d6GiJ: goto kU0p2; goto T1Iny; T8v7L: Mzl_Y: goto D2I8b; aOlmf: pdo_insert('tiger_newhu_share', array("openid" => $wqid, "nickname" => $fans['nickname'], "avatar" => $fans['avatar'], "unionid" => $fans['unionid'], "pid" => "", "updatetime" => time(), "createtime" => time(), "parentid" => 0, "weid" => $_W['uniacid'], "helpid" => $helpid, "score" => "", "cscore" => "", "pscore" => "", "from_user" => $fans['openid'], "lytype" => $lytype, "follow" => 1)); goto qRoou; o_dCy: return ''; goto mxPlI; jEqaP: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and unionid='{$fans['unionid']}'"); goto dTovI; eBAG2: if (!($cfg['dlgzsdtype'] == 1)) { goto naKIQ; } goto wq2kn; AaSjp: if (!empty($fans['unionid'])) { goto QfDz5; } goto U53kG; O4VsV: goto F8egv; goto T19Ut; OZOXO: naKIQ: goto aoyQQ; Lyphk: AScrj: goto ew2jB; T19Ut: j6Mpw: goto aOlmf; hOQZT: goto FoI9A; goto rubxd; ew2jB: goto Sqx1M; goto LRjWQ; WIdJJ: if (!empty($fans['openid'])) { goto DvafN; } goto o_dCy; dTovI: if (!empty($share['id'])) { goto g2Fer; } goto wdEVh; f5YRD: goto AScrj; goto awmSI; BI9RK: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and from_user='{$fans['openid']}'"); goto Jsdz3; nIK1P: FoI9A: goto Lyphk; nZJit: $updata = array("unionid" => $fans['unionid'], "openid" => $wqid, "nickname" => $fans['nickname'], "avatar" => $fans['avatar']); goto e5sw1; D2I8b: Sqx1M: goto nDcgS; awmSI: M3TPb: goto AaSjp; rubxd: QfDz5: goto nZJit; Z6Vjj: pdo_update('tiger_newhu_share', $updata, array("weid" => $_W['uniacid'], "unionid" => $fans['unionid'])); goto kLWSB; FOnPP: F8egv: goto f5YRD; xDa99: if (!empty($share['id'])) { goto JS6d1; } goto UuO3w; eEhCl: return $share; goto T8v7L; Gclss: $updata = array("unionid" => $fans['unionid'], "openid" => $wqid, "nickname" => $fans['nickname'], "avatar" => $fans['avatar']); goto hs7pf; E382l: return $share; goto nIK1P; UuO3w: pdo_insert('tiger_newhu_share', array("openid" => $wqid, "nickname" => $fans['nickname'], "avatar" => $fans['avatar'], "unionid" => $fans['unionid'], "pid" => "", "updatetime" => time(), "createtime" => time(), "parentid" => 0, "weid" => $_W['uniacid'], "helpid" => $helpid, "score" => "", "cscore" => "", "pscore" => "", "from_user" => $fans['openid'], "lytype" => $lytype, "follow" => 1)); goto dspnj; v_eaL: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$share['id']}'"); goto qSHdW; kLWSB: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and unionid='{$fans['unionid']}'"); goto eEhCl; dspnj: $share['id'] = pdo_insertid(); goto v_eaL; RVbMw: if (!empty($share['id'])) { goto M3TPb; } goto gSlhM; nDcgS: } public function bryj($share, $begin_time, $end_time, $zt, $bl, $cfg) { goto qEhYq; XN0D3: ur_ek: goto U9F2g; sJbU6: N3xjf: goto BLk1H; Pi5Tj: if (empty($bl['dlkcbl'])) { goto hXxcJ; } goto IYASR; BiTm8: hXxcJ: goto MnKPt; V2V1N: $yj3 = $byygsum * $bl['dlbl3'] / 100; goto LkAb0; Gp8fP: goto q1SnK; goto fnfni; V3w_c: povSE: goto O03dI; MG9tH: goto fj2BN; goto sJbU6; fnfni: oaN3N: goto j3nXy; KLV30: if ($bl['fxtype'] == 1) { goto sIpa4; } goto cusOz; zya2y: $byygsum = $byygsum * $bl['dlbl1'] / 100; goto XN0D3; uNiW7: $sj2 = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$sj['helpid']}'"); goto IaTkm; G0SLe: $addtime = 'jstime'; goto lOVJL; MU8JU: if (!empty($share['tgwid'])) { goto b2XvD; } goto CgqrT; X82tL: $dwhere = "and addtime>={$begin_time}"; goto ibb5a; R9YUX: goto s3i2D; goto iuY_l; M5Imp: $dj = 2; goto VoAMI; fx3mW: goto pEd6J; goto KM_rN; Xs_1m: $yj1 = $yj3 * $bl['dlbl1t3'] / 100; goto hEgZ9; ZpjNq: tutLH: goto hsDyc; kkziW: Xjr7Y: goto OrN2E; xIKZh: ZX3ZX: goto d8wrq; d8wrq: $send_time = strtotime(date('Y-m-d 23:59:59', strtotime(-date('d') . 'day'))); goto hhA8y; kp4dM: RPMf7: goto Gp8fP; kitaU: $tgwarr = explode('|', $share['tgwid']); goto OYPc5; HNJWp: Jv6sa: goto uNiW7; CgqrT: $where .= ' and tgwid=111111'; goto R9YUX; sjI0Q: $byygsum = $byygsum * $bl['dlbl1'] / 100; goto KwoXv; bb50U: if ($zt == 2) { goto N3xjf; } goto GX96f; TSikt: $dj = 1; goto HNJWp; O03dI: if (empty($end_time)) { goto oaN3N; } goto p0hcp; cYvcB: sIpa4: goto zya2y; IaTkm: if (!($bl['dltype'] == 3)) { goto zMeWO; } goto nW2u6; VoAMI: pEd6J: goto DcL3P; AEhIx: $addtime = 'addtime'; goto MsGLk; LkAb0: $yj2 = $yj3 * $bl['dlbl2t3'] / 100; goto Xs_1m; j3nXy: if (empty($begin_time)) { goto W4EeQ; } goto X82tL; hsDyc: goto ur_ek; goto cYvcB; a8B62: foreach ($tgwarr as $k => $v) { $where .= ' tgwid=' . $v . ' or '; yWOxL: } goto B3p4I; Lgvyh: $sj = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$share['helpid']}'"); goto bitDr; OWQGM: s3i2D: goto XjwzM; hEgZ9: $byygsum = $yj3 - $yj2 - $yj1; goto ZpjNq; zXeqg: goto fj2BN; goto aaP_q; p0hcp: if (empty($begin_time)) { goto RPMf7; } goto fIB3M; UrTkl: QY7DC: goto V3w_c; F_KbP: $yj1 = $yj2 * $bl['dlbl1t2'] / 100; goto XwDmT; bitDr: if (empty($sj)) { goto Xjr7Y; } goto AfXEW; hgw4Q: fj2BN: goto kitaU; aizTc: $addtime = 'addtime'; goto vZlfm; QEso1: $yj2 = $byygsum * $bl['dlbl2'] / 100; goto F_KbP; OYPc5: $where = ''; goto MU8JU; iuY_l: b2XvD: goto Y4z6A; GX96f: if ($zt == 3) { goto ToP9q; } goto Y5uev; AfXEW: if (!($bl['dltype'] == 2)) { goto Jv6sa; } goto TSikt; qEhYq: global $_W; goto S2DRD; S2DRD: if (empty($share['dlbl'])) { goto ZX3ZX; } goto kqy7A; ibb5a: W4EeQ: goto eaz0l; xc9sl: goto tutLH; goto gBPx2; kqy7A: $bl['dlbl1'] = $share['dlbl']; goto xIKZh; eaz0l: q1SnK: goto Wu6H1; nW2u6: if (!empty($sj2)) { goto JQqva; } goto TDByn; KM_rN: JQqva: goto M5Imp; U6K5p: if ($send_time == $end_time) { goto vd0V4; } goto aizTc; WcJqg: $addtime = 'addtime'; goto UrTkl; MsGLk: goto povSE; goto I0BnP; U9F2g: return $byygsum; goto tOXhF; Wu6H1: if ($zt == 1) { goto zdvZr; } goto bb50U; GaWhL: if (!($zt == 2)) { goto QY7DC; } goto WcJqg; Gdjzt: $where .= 'tgwid=' . $tgwarr[0] . ')'; goto OWQGM; vZlfm: goto dpH5H; goto NOGpN; wdT1u: w3wyq: goto GnC_M; OrN2E: goto dKF8T; goto wdT1u; IYASR: $byygsum = $byygsum * (100 - $bl['dlkcbl']) / 100; goto BiTm8; XwDmT: $byygsum = $yj2 - $yj1; goto xc9sl; iahCB: rVjie: goto QEso1; KwoXv: goto tutLH; goto iahCB; hhA8y: if ($cfg['jsms'] == 1) { goto cNNbP; } goto AEhIx; Y4z6A: $where .= 'and ('; goto a8B62; DcL3P: zMeWO: goto kkziW; fIB3M: $dwhere = "and {$addtime}>={$begin_time} and {$addtime}<{$end_time}"; goto kp4dM; I0BnP: cNNbP: goto U6K5p; MnKPt: if (empty($byygsum)) { goto w3wyq; } goto Lgvyh; Y5uev: goto fj2BN; goto n13T2; fzafA: dKF8T: goto KLV30; n13T2: zdvZr: goto FU5ln; GnC_M: $byygsum = '0.00'; goto fzafA; aaP_q: ToP9q: goto JDjWk; JDjWk: $ddzt = ' and orderzt<>\'订单失效\''; goto hgw4Q; XjwzM: $byygsum = pdo_fetchcolumn('SELECT sum(xgyg) FROM ' . tablename('tiger_newhu_tkorder') . " where weid='{$_W['uniacid']}'  {$ddzt} {$dwhere} {$where}"); goto Pi5Tj; TDByn: $dj = 1; goto fx3mW; B3p4I: ksQ7E: goto Gdjzt; FU5ln: $ddzt = ' and orderzt=\'订单结算\''; goto MG9tH; cusOz: if ($dj == 1) { goto rVjie; } goto t_Sju; BLk1H: $ddzt = ' and orderzt=\'订单付款\''; goto zXeqg; NOGpN: vd0V4: goto G0SLe; t_Sju: if ($dj == 2) { goto yXtqK; } goto sjI0Q; lOVJL: dpH5H: goto GaWhL; gBPx2: yXtqK: goto V2V1N; tOXhF: } public function jcbl($share, $bl) { goto ew3o3; LKjeR: $sj = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$share['helpid']}'"); goto qm4uO; nIBjO: goto jGEV7; goto XZwJI; i7Ekk: $djbl = $bl['dlbl1']; goto X6E7m; ysL2u: $cj = 2; goto lqHDT; F4PRy: if (!empty($sj2)) { goto iUfsv; } goto FKZmo; DPg0j: goto oYihs; goto abZnN; YpF6r: $tname = $bl['dlname3']; goto tkotd; RpZVY: $cj = 1; goto Y4lSE; o4yXf: if (empty($share['dlbl'])) { goto aCcO4; } goto nJjuB; uT5tC: $djbl = $bl['dlbl3']; goto YpF6r; ABNTt: $djbl = $bl['dlbl1']; goto qaErZ; ctLWj: $arr = array("bl" => $djbl, "tname" => $tname, "cj" => $cj); goto ho3Xy; qaErZ: $tname = $bl['dlname1']; goto RpZVY; r2InN: if ($bl['dltype'] == 2) { goto XU5Nr; } goto ABNTt; rhYmu: nhiF_: goto o4yXf; zmyoa: h1B7t: goto btc5a; abZnN: pS9Ij: goto Rtt9Z; b6t9h: $cj = 2; goto BWBfY; B8jB9: iUfsv: goto uT5tC; LUgeM: qV8_N: goto ipHXv; Y4lSE: goto nhiF_; goto zmyoa; Rtt9Z: $djbl = $bl['dlbl2']; goto z2vjv; BWBfY: goto qV8_N; goto B8jB9; lqHDT: oYihs: goto rhYmu; UP3lO: $sj2 = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$sj['helpid']}'"); goto F4PRy; FKZmo: $djbl = $bl['dlbl2']; goto bA5DL; nJjuB: $djbl = $share['dlbl']; goto Nu9wE; bA5DL: $tname = $bl['dlname2']; goto b6t9h; fGvJH: $tname = $bl['dlname1']; goto Li1ia; btc5a: if (!empty($sj)) { goto IB9oz; } goto vC_iL; hipgh: goto nhiF_; goto g0DBC; vC_iL: $djbl = $bl['dlbl1']; goto fGvJH; tkotd: $cj = 3; goto LUgeM; XZwJI: IB9oz: goto UP3lO; ho3Xy: return $arr; goto flppM; ew3o3: global $_W; goto LKjeR; Nu9wE: $tname = $bl['dlname1']; goto D7Kkl; g0DBC: XU5Nr: goto hPfLp; D7Kkl: aCcO4: goto ctLWj; Li1ia: $cj = 1; goto nIBjO; ipHXv: jGEV7: goto hipgh; VlqPM: $cj = 1; goto DPg0j; X6E7m: $tname = $bl['dlname1']; goto VlqPM; z2vjv: $tname = $bl['dlname2']; goto ysL2u; hPfLp: if (!empty($sj)) { goto pS9Ij; } goto i7Ekk; qm4uO: if ($bl['dltype'] == 3) { goto h1B7t; } goto r2InN; flppM: } public function bydlyj($share, $begin_time, $end_time = "", $zt, $bl, $cfg) { goto EnTAV; y1YP1: goto sL2bP; goto vzKwU; P6YkX: $bl['dlbl1'] = $share['dlbl']; goto qYwoA; wJaoz: if (!($zt == 2)) { goto O56SD; } goto h7Wbw; H0RDe: syfLt: goto aKKDr; SXXmj: lsqGr: goto qAib3; qAib3: goto syfLt; goto rT8cK; bZQ6V: goto ktiS2; goto n6M3U; te56O: NFNBV: goto ezHCm; Lv39f: sL2bP: goto SEuo5; pgOJ3: $sjrs = '0.00'; goto T9b8j; m_Y12: goto PeIPy; goto V94pL; IQCac: $sjrs = pdo_fetchcolumn('SELECT sum(t.xgyg) FROM ' . tablename('tiger_newhu_share') . ' s left join ' . tablename('tiger_newhu_tkorder') . " t ON s.tgwid=t.tgwid where s.weid='{$_W['uniacid']}'   and s.dltype=1  {$ddzt} and s.helpid in (" . implode(',', array_keys($fans1)) . ") {$where}"); goto Ia18k; sPLyH: Ln32J: goto S2xSj; bV1ph: sKE6A: goto H0RDe; zbjhv: if ($zt == 3) { goto Q1Viz; } goto B3a0J; i41eL: $ddzt = ' and orderzt=\'订单结算\''; goto y1YP1; BjCkL: $rjrs = '0.00'; goto pgOJ3; MuIyt: $rjrs = $rjrs * (100 - $bl['dlkcbl']) / 100; goto sPLyH; QBDwd: $send_time = strtotime(date('Y-m-d 23:59:59', strtotime(-date('d') . 'day'))); goto MG7Gy; tFDpj: $ddzt = ' and orderzt<>\'订单失效\''; goto Lv39f; vzKwU: o9378: goto OKvZf; T9b8j: won7O: goto j6voy; KhMr9: if (!($bl['dltype'] == 1)) { goto won7O; } goto BjCkL; V94pL: YRspG: goto f0bSJ; hmWRh: if (!empty($sjrs)) { goto NFNBV; } goto ZKYGk; YTPCT: $addtime = 'jstime'; goto gFEx7; ZKYGk: $sjrs = '0.00'; goto te56O; XTEbQ: Q1Viz: goto tFDpj; E1Zz2: foreach ($rjshare as $k => $v) { goto VnY1S; X1iro: IpAJv: goto B6R6k; VnY1S: $a = pdo_fetchcolumn('SELECT sum(xgyg) FROM ' . tablename('tiger_newhu_tkorder') . "  where weid='{$_W['uniacid']}' and tgwid='{$v['tgwid']}' {$ddzt} {$where}"); goto mFKmq; mFKmq: $r = $r + $a; goto X1iro; B6R6k: } goto TNpYp; Lisi2: $addtime = 'addtime'; goto m_Y12; LvdRo: wr7qL: goto BB_ev; ezHCm: ktiS2: goto KhMr9; qYwoA: HR2Ge: goto QBDwd; f0bSJ: if ($send_time == $end_time) { goto mL9z_; } goto hz2N_; KPFGm: $rjrs = $r; goto RL1X8; NEYss: goto sL2bP; goto XTEbQ; Ia18k: A_Hdp: goto nx35G; rhlr4: YBjow: goto i41eL; wj67k: PeIPy: goto LswpI; LswpI: if (empty($end_time)) { goto OjjkB; } goto FcDVS; n6M3U: oglX7: goto rCw8b; TNpYp: v1E9c: goto KPFGm; NEMx_: if ($zt == 2) { goto o9378; } goto zbjhv; YUyjz: if (empty($begin_time)) { goto sKE6A; } goto D9zWD; j6voy: $array = array("yj2" => $rjrs * $bl['dlbl2'] / 100, "yj3" => $sjrs * $bl['dlbl3'] / 100); goto p5QD8; rCw8b: $fans1 = pdo_fetchall('select id from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and dltype=1 and helpid='{$share['id']}'", array(), 'id'); goto afqLB; aKKDr: if ($zt == 1) { goto YBjow; } goto NEMx_; S2xSj: if (!empty($rjrs)) { goto wr7qL; } goto wsoUq; XT5A8: $sjrs = '0.00'; goto bZQ6V; UbJ2P: $r = ''; goto E1Zz2; OKvZf: $ddzt = ' and orderzt=\'订单付款\''; goto NEYss; tf5kD: $rjshare = pdo_fetchall('SELECT id,helpid,tgwid FROM ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and helpid='{$share['id']}' and dltype=1"); goto UbJ2P; OiQ4e: $where = "and {$addtime}>={$begin_time} and {$addtime}<{$end_time}"; goto SXXmj; IaA34: if (empty($share['dlbl'])) { goto HR2Ge; } goto P6YkX; RL1X8: if (empty($bl['dlkcbl'])) { goto Ln32J; } goto MuIyt; hz2N_: $addtime = 'addtime'; goto YQEqf; afqLB: if (empty($fans1)) { goto A_Hdp; } goto IQCac; nx35G: if (empty($bl['dlkcbl'])) { goto nWUcN; } goto qxYSk; gFEx7: NHtXB: goto wJaoz; FcDVS: if (empty($begin_time)) { goto lsqGr; } goto OiQ4e; MG7Gy: if ($cfg['jsms'] == 1) { goto YRspG; } goto Lisi2; B3a0J: goto sL2bP; goto rhlr4; p5QD8: return $array; goto u38sc; EnTAV: global $_W; goto IaA34; wsoUq: $rjrs = '0.00'; goto LvdRo; YQEqf: goto NHtXB; goto Qj6Fn; BB_ev: if ($bl['dltype'] == 3) { goto oglX7; } goto XT5A8; SEuo5: $bbegin_time = strtotime(date('Y-m-d H:i:s', mktime(0, 0, 0, date('m'), 1, date('Y')))); goto tf5kD; rT8cK: OjjkB: goto YUyjz; D9zWD: $where = "and addtime>={$begin_time}"; goto bV1ph; qxYSk: $sjrs = $sjrs * (100 - $bl['dlkcbl']) / 100; goto Xl0Xq; h7Wbw: $addtime = 'addtime'; goto eQKdO; eQKdO: O56SD: goto wj67k; Qj6Fn: mL9z_: goto YTPCT; Xl0Xq: nWUcN: goto hmWRh; u38sc: } public function dljiangli($endprice, $tkrate, $bl, $share) { goto AtEyu; TMPqb: Qkv51: goto zpiV0; SP_Z7: return $dlrate; goto VAERC; THtho: $jrsjyj = $yj * $bl['dlbl1t3'] / 100; goto DWBO9; CBqml: goto HGm9q; goto R0e9U; eu6FN: czc65: goto bk4vl; AdnUA: $dlrate = number_format($jrzyj, 2); goto ClDcT; DWBO9: goto Jtpis; goto sex6P; P3Ioi: $dlyj = $dlyj * (100 - $bl['dlkcbl']) / 100; goto AT2d8; EPW0B: if ($bl['dltype'] == 3) { goto Qkv51; } goto W6hDD; mUxuR: if (empty($bl['dlkcbl'])) { goto SCULx; } goto P3Ioi; LN_1V: SaARU: goto Idl0V; bXBsZ: if (empty($share['helpid'])) { goto jr38x; } goto hyJEc; Z2QaL: $jryj = 0; goto svk9R; KDWSs: goto yGHbp; goto LN_1V; Fimg5: Gm8RB: goto bXBsZ; xXzje: $yj = number_format($dlyj * $dlbl / 100, 2); goto n1StT; AEOSq: if ($bl['fxtype'] == 1) { goto czc65; } goto xXzje; zpiV0: if (empty($share['helpid'])) { goto CNGRn; } goto CuaM8; Idl0V: $dlbl = $bl['dlbl1']; goto ADNh2; bmbEV: HGm9q: goto SH1VP; WhPvN: if (empty($share['dlbl'])) { goto SaARU; } goto gutMU; ClDcT: goto VIQ1v; goto eu6FN; ADNh2: yGHbp: goto AEOSq; SH1VP: QPvV6: goto C4UOx; GOTiT: Jtpis: goto CBqml; nF1N7: $jrsjyj = 0; goto GOTiT; MEDlv: goto QPvV6; goto TMPqb; gutMU: $dlbl = $fs['bl']; goto KDWSs; oo8z3: VIQ1v: goto SP_Z7; CP5Pz: file_put_contents(IA_ROOT . '/addons/tiger_tkxcx/yj_log.txt', '
' . 'uid:' . $share['id'] . '------' . $yj . '-' . $jryj . '-' . $jrsjyj . '=' . $jrzyj, FILE_APPEND); goto AdnUA; Gxyt5: $fs = $this->jcbl($share, $bl); goto WhPvN; C4UOx: $jrzyj = $yj - $jryj - $jrsjyj; goto CP5Pz; wq_X6: $jryj = 0; goto bmbEV; FWKA6: jr38x: goto Z2QaL; sex6P: xKAnn: goto nF1N7; GI11m: if (empty($sjshare['helpid'])) { goto xKAnn; } goto THtho; HHfd1: $dlyj = $endprice * $tkrate / 100; goto mUxuR; n1StT: if ($bl['dltype'] == 2) { goto Gm8RB; } goto EPW0B; svk9R: kqCcd: goto MEDlv; AT2d8: SCULx: goto Gxyt5; CuaM8: $sjshare = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$share['weid']}'and dltype=1 and id='{$share['helpid']}'"); goto wO0zw; AtEyu: global $_W; goto HHfd1; jC_pF: goto kqCcd; goto FWKA6; W6hDD: goto QPvV6; goto Fimg5; hyJEc: $jryj = $yj * $bl['dlbl1t2'] / 100; goto jC_pF; wO0zw: $jryj = $yj * $bl['dlbl2t3'] / 100; goto GI11m; R0e9U: CNGRn: goto wq_X6; bk4vl: $dlrate = number_format($dlyj * $dlbl / 100, 2); goto oo8z3; VAERC: } public function ptyjjl($endprice, $tkrate, $cfg) { goto yweCM; TL2kt: goto Vg4s1; goto l67pg; OrW0b: $yongj = $yj * $cfg['zgf'] / 100; goto rzCWX; pKtVf: Vg4s1: goto zlRTT; zlRTT: return $yj1; goto MIHje; Sp30R: $yj1 = $yongj * $cfg['jfbl']; goto tnRdF; dEYKH: goto Vg4s1; goto TurU1; NnueT: if ($cfg['fxtype'] == 2) { goto qdn9R; } goto TL2kt; rzCWX: if (!empty($yongj)) { goto TFK43; } goto jyI6m; l67pg: s_9Zj: goto Sp30R; Uf20o: $yj = $endprice * $tkrate / 100; goto OrW0b; yweCM: global $_W; goto Uf20o; GEYOu: if ($cfg['fxtype'] == 1) { goto s_9Zj; } goto NnueT; OefNa: $yj1 = number_format($yongj, 2); goto pKtVf; TurU1: qdn9R: goto OefNa; zRcSe: TFK43: goto GEYOu; tnRdF: $yj1 = intval($yj1); goto dEYKH; jyI6m: $yongj = '0.00'; goto zRcSe; MIHje: } public function sharejl($endprice, $tkrate, $bl, $share, $cfg) { goto STYRq; Mg3Vw: PFO9X: goto YOMux; w6wb4: return $yj; goto x9Ivq; YOMux: $yj = $this->dljiangli($endprice, $tkrate, $bl, $share); goto fK2Pk; fK2Pk: RWvlp: goto w6wb4; wVreh: goto RWvlp; goto Mg3Vw; Ee_ju: $yj = $this->ptyjjl($endprice, $tkrate, $cfg); goto wVreh; STYRq: if ($share['dltype'] == 1) { goto PFO9X; } goto Ee_ju; x9Ivq: } public function tkljx($msg) { goto fC0A9; nsPV4: $req = new WirelessShareTpwdQueryRequest(); goto FqJKN; ZPZBp: $appkey = $cfg['tkAppKey']; goto qQJYU; AJ_nb: if ($cfg['jqtkAppKey']) { goto qWlGv; } goto ZPZBp; ElJIw: $c->appkey = $appkey; goto EYKYw; CaRsz: $secret = $cfg['jqtksecretKey']; goto DoEO5; fC0A9: global $_W, $_GPC; goto StH0b; StH0b: $cfg = $this->module['config']; goto AJ_nb; U5iOz: qWlGv: goto VcZIK; N9xOq: $jsonArray = json_decode($jsonStr, true); goto EQkPJ; fyx0D: $jsonStr = json_encode($resp); goto N9xOq; EYKYw: $c->secretKey = $secret; goto nsPV4; W1h14: $resp = $c->execute($req); goto fyx0D; FqJKN: $req->setPasswordContent($msg); goto W1h14; hbpS9: goto J_19i; goto U5iOz; rFbQI: $c = new TopClient(); goto ElJIw; EQkPJ: return $jsonArray; goto SUS1r; qQJYU: $secret = $cfg['tksecretKey']; goto hbpS9; VcZIK: $appkey = $cfg['jqtkAppKey']; goto CaRsz; DoEO5: J_19i: goto rFbQI; SUS1r: } public function mc_jl($uid, $type, $typelx, $num, $remark, $orderid) { goto i9cqw; NbEV7: rGXQU: goto sK0nQ; zjFuq: return array("error" => 0, "data" => "积分更新失败"); goto StfDw; WYwxY: return array("error" => 0, "data" => "积分更新失败"); goto hoVD5; fo2h2: goto ttxSF; goto FG0vi; nxnHV: goto ttxSF; goto NbEV7; ZOrCr: if (!($credit1 < 0)) { goto Hn2Ky; } goto KJtZh; hoVD5: GV389: goto UI6yT; CzwbF: $res = pdo_update($this->modulename . '_share', array("credit2" => $credit2), array("id" => $uid)); goto O1Kqa; StfDw: KTj7x: goto DTxDK; v5Kle: $credit2 = $share['credit2'] + $num; goto qF3eD; p7j5u: if ($res === false) { goto DA3QW; } goto PgtlQ; lepQr: if ($inst === false) { goto nTQuP; } goto l3Nm7; MQ04G: if ($type == 1) { goto NgCsR; } goto QNri_; RUgPU: $data = array("uid" => $uid, "weid" => $_W['uniacid'], "type" => $type, "typelx" => $typelx, "num" => $num, "remark" => $remark, "orderid" => $orderid, "createtime" => time()); goto M2ptn; wlRzb: nTQuP: goto emmQJ; q4DU1: yeHor: goto DfRQV; emmQJ: return array("error" => 0, "data" => "余额更新失败"); goto q4DU1; imDx8: goto GV389; goto QKkXB; O1Kqa: if ($res === false) { goto xWti7; } goto ECBof; QYvRi: DA3QW: goto zjFuq; DfRQV: goto xZwx6; goto tvN7d; i9cqw: global $_W; goto bboGF; aN7_D: $res = pdo_update($this->modulename . '_share', array("credit1" => $credit1), array("id" => $uid)); goto p7j5u; qF3eD: if (!($credit2 < 0)) { goto y3VNp; } goto ww0Ku; KJtZh: return array("error" => 0, "data" => "积分不足"); goto kpKY3; M2ptn: $share = pdo_fetch('SELECT credit1,credit2 FROM ' . tablename($this->modulename . '_share') . " WHERE id='{$uid}' and weid='{$_W['uniacid']}' "); goto MQ04G; DTxDK: ttxSF: goto blfBz; l3Nm7: return array("error" => 1, "data" => "余额更新成功"); goto tcIDS; jP0jx: xZwx6: goto nxnHV; OgxkP: bnaRG: goto RUgPU; ww0Ku: return array("error" => 0, "data" => "余额不足"); goto yta6I; yta6I: y3VNp: goto CzwbF; tcIDS: goto yeHor; goto wlRzb; ECBof: $inst = pdo_insert($this->modulename . '_jl', $data); goto lepQr; maf3W: return; goto OgxkP; kpKY3: Hn2Ky: goto aN7_D; PgtlQ: $inst = pdo_insert($this->modulename . '_jl', $data); goto eyH53; QKkXB: U9N6L: goto WYwxY; cnGEm: return array("error" => 0, "data" => "余额更新失败"); goto jP0jx; tvN7d: xWti7: goto cnGEm; FG0vi: NgCsR: goto v5Kle; eyH53: if ($inst === false) { goto U9N6L; } goto NR9KC; bboGF: if (!empty($uid)) { goto bnaRG; } goto maf3W; QNri_: if ($type == 0) { goto rGXQU; } goto fo2h2; UI6yT: goto KTj7x; goto QYvRi; sK0nQ: $credit1 = $share['credit1'] + $num; goto ZOrCr; NR9KC: return array("error" => 1, "data" => "积分更新成功"); goto imDx8; blfBz: } public function islogin() { goto CT6ne; qiuwK: $share = pdo_fetch('select * from ' . tablename($this->modulename . '_share') . " where weid='{$_W['uniacid']}' and id='{$_SESSION['tkuid']}'"); goto dYE0t; CT6ne: global $_W; goto Nbxdb; w3Bpv: $fans = array("id" => $_SESSION['tkuid'], "tkuid" => $_SESSION['tkuid'], "wquid" => $mc['uid'], "credit1" => $share['credit1'], "credit2" => $share['credit2'], "nickname" => $share['nickname'], "avatar" => $share['avatar'], "helpid" => $share['helpid'], "dlptpid" => $share['dlptpid'], "unionid" => $share['unionid'], "from_user" => $share['from_user'], "openid" => $share['from_user'], "createtime" => $share['createtime'], "tgwid" => $share['tgwid'], "cqtype" => $share['cqtype'], "dltype" => $share['dltype'], "status" => $share['status']); goto YUe9i; YUe9i: return $fans; goto aijUi; dYE0t: X1Cvq: goto s3MV9; s3MV9: $mc = mc_fetch($fans['openid']); goto w3Bpv; EaDOw: $fans['openid'] = $_SESSION['openid']; goto qiuwK; Nbxdb: if (empty($_SESSION['openid'])) { goto X1Cvq; } goto EaDOw; aijUi: } public function doMobileLogin() { goto hUIfS; SPcg9: goto NW3Ix; goto jSX1I; cGigS: $username = trim($_GPC['username']); goto kedKV; vPj6u: include $this->template('login'); goto MSs4L; tY2oe: $_SESSION['tkuid'] = $share['id']; goto dY7fA; jSX1I: t_MqH: goto KRw83; EONkZ: $fans = mc_oauth_userinfo(); goto gm26l; LuhcF: $cfg = $this->module['config']; goto NbYB8; apMT7: $_SESSION['unionid'] = $share['unionid']; goto QqyL1; dY7fA: $_SESSION['openid'] = $share['from_user']; goto apMT7; gm26l: if (!$_W['isajax']) { goto dQOZr; } goto cGigS; jEAN1: if ($username == $share['pcuser'] && $password == $share['pcpasswords']) { goto t_MqH; } goto RJvA0; hUIfS: global $_GPC, $_W; goto LuhcF; RJvA0: exit(json_encode(array("status" => 0, "msg" => "帐号密码错误", "tzurl" => urldecode($tzurl)))); goto SPcg9; R88AE: exit(json_encode(array("status" => 1, "msg" => "登录成功", "tzurl" => urldecode($tzurl)))); goto Am8PU; ydRHk: $tzurl = $_GPC['tzurl']; goto EONkZ; Am8PU: NW3Ix: goto iUV63; KRw83: $_SESSION['username'] = $share['pcuser']; goto tY2oe; NbYB8: $pid = $_GPC['pid']; goto ydRHk; kedKV: $password = trim($_GPC['password']); goto Y3cFa; QqyL1: $_SESSION['pid'] = $share['dlptpid']; goto R88AE; iUV63: dQOZr: goto vPj6u; Y3cFa: $share = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_share') . " WHERE pcuser='{$username}' and weid='{$_W['uniacid']}' "); goto jEAN1; MSs4L: } public function doMobileLoginout() { goto Vcdxi; Vcdxi: session_unset(); goto se8e3; Dwe49: exit(json_encode(array("status" => 1, "msg" => "退出登录成功"))); goto Dg5tq; se8e3: session_destroy(); goto Dwe49; Dg5tq: } public function doMobilebdLogin() { goto SWClE; SWClE: global $_GPC, $_W; goto RFKEI; z5MV5: dS9K8: goto Ac8U1; iVImp: goto WkNpI; goto Jj3qI; ECObs: goto ks8t5; goto z5MV5; C88sH: $username = trim($_GPC['username']); goto Pm4h2; unGlR: CBOn8: goto QCbnp; jRFA0: if (empty($share['id'])) { goto j55bF; } goto p3h3M; p3h3M: $aaa = pdo_update($this->modulename . '_share', $usdata, array("weid" => $_W['uniacid'], "id" => $share['id'])); goto Fi2MV; Rig_J: yKbrF: goto yTl3W; Xcl10: if (empty($sharepcuser['id'])) { goto CBOn8; } goto c9cxh; xfCm7: $fans = mc_oauth_userinfo(); goto UcmQn; QCbnp: $share = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_share') . " WHERE from_user='{$openid}' and weid='{$_W['uniacid']}' "); goto jRFA0; CabGx: exit(json_encode(array("status" => 1, "msg" => "绑定成功！"))); goto eq_3T; Fi2MV: if (!($aaa !== 'false')) { goto O0feL; } goto CabGx; AR3oM: exit(json_encode(array("status" => 0, "msg" => $aaa))); goto iVImp; KP7xf: ks8t5: goto w5WE8; PfrW4: if (!$_W['isajax']) { goto yKbrF; } goto HKvtt; HKvtt: if (!empty($openid)) { goto ZPDyC; } goto ITCUZ; Ye1Mg: exit(json_encode(array("status" => 0, "msg" => "用户不存在，请先关注公众号"))); goto S6bdc; w5WE8: WkNpI: goto ehjGL; RFKEI: $cfg = $this->module['config']; goto xfCm7; rOsXT: $unionid = $_GPC['unionid']; goto C88sH; ITCUZ: exit(json_encode(array("status" => 0, "msg" => "请在微信端绑定"))); goto ncQRa; c9cxh: exit(json_encode(array("status" => 0, "msg" => "手机号已经存在！"))); goto unGlR; yTl3W: include $this->template('bdlogin'); goto sp6Gi; gUq7y: $sharepcuser = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_share') . " WHERE pcuser='{$username}' and weid='{$_W['uniacid']}' "); goto Xcl10; ipxYH: $usdata = array("pcuser" => $username, "pcpasswords" => $password); goto PfrW4; UcmQn: $openid = $_GPC['openid']; goto rOsXT; Ac8U1: pdo_update($this->modulename . '_share', $usdata, array("weid" => $_W['uniacid'], "id" => $share['id'])); goto KP7xf; ehjGL: if (!empty($share['id'])) { goto tezdV; } goto Ye1Mg; IudOE: if (!empty($share['id'])) { goto dS9K8; } goto bzcug; S6bdc: tezdV: goto Rig_J; Jj3qI: j55bF: goto qdO5h; eq_3T: O0feL: goto AR3oM; qdO5h: $share = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_share') . " WHERE unionid='{$unionid}' and weid='{$_W['uniacid']}' "); goto IudOE; Pm4h2: $password = trim($_GPC['password']); goto ipxYH; bzcug: exit(json_encode(array("status" => 0, "msg" => "用户不存在，请先关注公众号"))); goto ECObs; ncQRa: ZPDyC: goto gUq7y; sp6Gi: } public function sjrd44($length = 4) { goto pkjfW; gHKGc: ZHMNm: goto oJG5H; x7u5K: $str = ''; goto XLT63; ZUujV: IamXj: goto Dx0td; i3ME4: goto ZHMNm; goto ZUujV; TO3mz: $str .= $chars[mt_rand(0, strlen($chars) - 1)]; goto HUYG7; BpYQB: $i++; goto i3ME4; Dx0td: return $str; goto v9OPP; pkjfW: $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'; goto x7u5K; XLT63: $i = 0; goto gHKGc; HUYG7: CjSxK: goto BpYQB; oJG5H: if (!($i < $length)) { goto IamXj; } goto TO3mz; v9OPP: } public function getimg($url, $path = "", $_W) { goto tZsw2; sHWzg: $filename = $path . '/' . $sctime . '.png'; goto ubDKF; cT88v: fclose($fp); goto wucRk; tZsw2: empty($path) && ($path = IA_ROOT . '/addons/tiger_newhu/goodsimg/' . date('Ymd')); goto Y2F02; EIRYt: return false; goto L1vrQ; S3WTx: if (!($url == '')) { goto PeSh4; } goto EIRYt; sDwlE: ob_end_clean(); goto ffVAs; wucRk: return $_W['siteroot'] . 'addons/tiger_newhu/goodsimg/' . date('Ymd') . '/' . $sctime . '.png'; goto SAVXH; ubDKF: ob_start(); goto V7dsP; NJvDi: fwrite($fp, $img); goto cT88v; ffVAs: $fp = fopen($filename, 'a'); goto NJvDi; J1VXj: $img = ob_get_contents(); goto sDwlE; L1vrQ: PeSh4: goto T1UEI; Y2F02: !file_exists($path) && mkdir($path, 0777, true); goto S3WTx; V7dsP: readfile($url); goto J1VXj; T1UEI: $sctime = date('YmdHis') . $this->sjrd44(6); goto sHWzg; SAVXH: } public function doMobileTupian() { goto Um95j; Vkvs4: $orprice = $_GPC['orprice']; goto QQ3ef; qz9w5: $cfg = $this->module['config']; goto q4VbC; LKJI4: $taoimage = $_GPC['taoimage']; goto L6Bzy; GJypV: $price = $_GPC['price']; goto GInC0; Um95j: global $_GPC, $_W; goto qz9w5; H7MDH: picjialidun($_W, $title, $price, $yhj, $orprice, $xiaol, $jrprice, $taoimage, $ewm); goto c1_x5; l472d: $url = $urlarr; goto ZNpPv; q4VbC: $title = urldecode($_GPC['title']); goto GJypV; GInC0: $yhj = $_GPC['yhj']; goto Vkvs4; m4KbS: include IA_ROOT . '/addons/tiger_newhu/inc/sdk/tbk/tb.php'; goto fu8xT; QQ3ef: $xiaol = $_GPC['xiaol']; goto fXmWm; ZNpPv: $ewm = $this->getimg('http://bshare.optimix.asia/barCode?site=weixin&url=' . $url, '', $_W); goto H7MDH; fXmWm: $jrprice = $_GPC['jrprice']; goto LKJI4; L6Bzy: $url = urldecode($_GPC['url']); goto m4KbS; fu8xT: $urlarr = $this->dwzw($url); goto l472d; c1_x5: } public function getfc($string, $len = 2) { goto uu4eK; lzcXa: $string = mb_substr($string, $len, $strlen, 'utf8'); goto C08TM; NvsP3: $strlen = mb_strlen($string); goto MEsDj; C08TM: $strlen = mb_strlen($string); goto T6YVt; T6YVt: goto h6yL4; goto uRqnt; dxOjL: return $array; goto F93GI; MEsDj: h6yL4: goto qeihE; qeihE: if (!$strlen) { goto ueOIq; } goto KOP2z; Ic32F: $start = 0; goto NvsP3; KOP2z: $array[] = mb_substr($string, $start, $len, 'utf8'); goto lzcXa; uRqnt: ueOIq: goto dxOjL; uu4eK: $string = str_replace(' ', '', $string); goto Ic32F; F93GI: } public function curl_request($url, $post = "", $cookie = "", $returnCookie = 0) { goto acme0; GX7Jz: curl_setopt($curl, CURLOPT_AUTOREFERER, 1); goto y65pA; YUBqH: if (!$cookie) { goto CgDCN; } goto ob_3B; alz5N: curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 0); goto UlDzo; MEGiz: curl_setopt($curl, CURLOPT_USERAGENT, 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; 	Trident/6.0)'); goto BqRYz; ob_3B: curl_setopt($curl, CURLOPT_COOKIE, $cookie); goto MFbbG; porVw: curl_setopt($curl, CURLOPT_HEADER, $returnCookie); goto H9H6Q; BPANn: preg_match_all('/Set\\-Cookie:([^;]*);/', $header, $matches); goto yTzpZ; Scx6c: $info['cookie'] = substr($cookies, 1); goto HXRDb; OfbdR: ZfwfP: goto YUBqH; yTzpZ: N1mWQ: goto nqAKC; BqRYz: curl_setopt($curl, CURLOPT_FOLLOWLOCATION, 1); goto GX7Jz; aZ3t2: return $data; goto V1nie; HXRDb: $info['content'] = $body; goto ZVJvO; y65pA: curl_setopt($curl, CURLOPT_REFERER, 'http://XXX'); goto d1_ET; d1_ET: curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 0); goto alz5N; nqAKC: if (!(list($key, $val) = each($matches[1]))) { goto xuE5O; } goto Plz24; DEtBs: curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); goto hKpN0; JqlhF: goto N1mWQ; goto LZgGC; Plz24: if ($cookies == '') { goto gJH57; } goto n3sHx; dVuDo: curl_setopt($curl, CURLOPT_POSTFIELDS, http_build_query($post)); goto OfbdR; ZVJvO: return $info; goto Q0HtC; n3sHx: $cookies = $cookies . '; ' . $val; goto TVPcG; B2qXO: return curl_error($curl); goto udOm8; udOm8: BxImP: goto pq0dp; hT96x: gJH57: goto rlV1D; UlDzo: if (!$post) { goto ZfwfP; } goto fxQg0; r7fq0: curl_setopt($curl, CURLOPT_URL, $url); goto OjpUh; hjvX7: a4OEm: goto IB922; rlV1D: $cookies = $val; goto YOXB2; YOXB2: awEH6: goto JqlhF; bHRTK: if (!curl_errno($curl)) { goto BxImP; } goto B2qXO; H9H6Q: curl_setopt($curl, CURLOPT_TIMEOUT, 10); goto DEtBs; hKpN0: $data = curl_exec($curl); goto bHRTK; V1nie: goto RrsuE; goto hjvX7; OjpUh: curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); goto MEGiz; acme0: $curl = curl_init(); goto r7fq0; LZgGC: xuE5O: goto Scx6c; TVPcG: goto awEH6; goto hT96x; IB922: list($header, $body) = explode('

', $data, 2); goto BPANn; fxQg0: curl_setopt($curl, CURLOPT_POST, 1); goto dVuDo; Q0HtC: RrsuE: goto ZTrYE; PiCoe: if ($returnCookie) { goto a4OEm; } goto aZ3t2; pq0dp: curl_close($curl); goto PiCoe; MFbbG: CgDCN: goto porVw; ZTrYE: } public function strurl($coupons_url) { goto EkVeb; Ylkbd: wMTxn: goto adaDy; EEBSE: goto wMTxn; goto xt1K_; xt1K_: t6fwM: goto gDqWr; tz2xu: return substr($url, $wz + 12, 32); goto EEBSE; LSz1c: return substr($url, $wz + 11, 32); goto Ylkbd; Rq38v: $wz = strpos($url, $activity_id); goto YZFh_; to3do: $wz = strpos($url, $activity_id); goto LSz1c; gDqWr: $activity_id = 'activityid='; goto to3do; YZFh_: if (empty($wz)) { goto t6fwM; } goto tz2xu; goKE1: $activity_id = 'activity_id='; goto Rq38v; EkVeb: $url = strtolower($coupons_url); goto goKE1; adaDy: } public function doMobileLjtkl() { goto I4HPK; I4HPK: global $_W, $_GPC; goto RVgUp; RxArA: $tjcontent = $_GPC['title']; goto fp3FS; fp3FS: $tkl = $this->tkl($url, $img, $tjcontent); goto FHg2Z; FHg2Z: die(json_encode(array("tkl" => $tkl))); goto cX6bL; RVgUp: $url = urldecode($_GPC['url']); goto kCdel; kCdel: $img = urldecode($_GPC['img']); goto RxArA; cX6bL: } public function tkl($url, $img, $tjcontent) { goto Eea6q; S5780: $req->setExt('{}'); goto S3h87; oymhO: $taokou = $cfg['tklleft'] . $taokou . $cfg['tklright']; goto SrqD1; nbCU3: $appkey = $cfg['tkAppKey']; goto vI3Gp; jcLMe: $taokou = str_replace('《', '￥', $taokou); goto gdnh0; JG0yA: $c->secretKey = $secret; goto RcB3c; aFfdr: $c->appkey = $appkey; goto JG0yA; LKNSU: return $taokou; goto ZXbH0; vI3Gp: $secret = $cfg['tksecretKey']; goto GsIDd; RcB3c: $req = new TbkTpwdCreateRequest(); goto IW5ug; djEKr: $cfg = $this->module['config']; goto nbCU3; B1p2e: $taokou = $jsonArray['data']['model']; goto Yjvzo; IW5ug: $req->setText($tjcontent); goto L_FJ0; reWai: $taokou = str_replace('￥', '', $taokou); goto oymhO; SrqD1: zoQG0: goto WAp_b; TIS8M: if (empty($cfg['tklleft'])) { goto zoQG0; } goto reWai; L_FJ0: $req->setUrl($url); goto PG59O; Lk2M3: $jsonStr = json_encode($resp); goto rDnFY; WAp_b: file_put_contents(IA_ROOT . '/addons/tiger_newhu/tkl_log.txt', '
' . $url . '------' . $img . '-----' . $tjcontent . '------' . json_encode($jsonArray), FILE_APPEND); goto LKNSU; GsIDd: $c = new TopClient(); goto aFfdr; Yjvzo: if (!($cfg['tklnewtype'] == 1)) { goto jkz5k; } goto jcLMe; S3h87: $resp = $c->execute($req); goto Lk2M3; Eea6q: global $_W, $_GPC; goto djEKr; rDnFY: $jsonArray = json_decode($jsonStr, true); goto B1p2e; PG59O: $req->setLogo($img); goto S5780; gdnh0: jkz5k: goto TIS8M; ZXbH0: } public function doMobileSq88888888() { goto oS3uV; Lxrf3: EH5G2: goto ZCF3l; U6Uut: echo 'cs'; goto whh92; oS3uV: global $_W, $_GPC; goto n_Jfs; Vo4U5: $tkurl1 = $host; goto NPK4h; Tedir: $host = $_SERVER['HTTP_HOST']; goto cfPL5; whh92: exit; goto H3yQw; yOv0w: $tkip = $this->get_server_ip(); goto lZBvt; ZK3pO: $tbuid = $cfg['tbuid']; goto Vo4U5; H3yQw: ZE6fR: goto NGYB4; lvJHb: echo 'tkip:' . $tkip . '<br>'; goto UzbEH; n_Jfs: if (!($_GPC['my'] != 'tigernewhu')) { goto ZE6fR; } goto U6Uut; cfPL5: $host = strtolower($host); goto ZK3pO; NPK4h: $tkurl2 = $_W['setting']['site']['url']; goto yOv0w; awi6x: echo '淘ID:' . $tbuid . '<br>'; goto XfO3t; nbtMV: foreach ($s as $k => $v) { goto CZ0Vc; CZ0Vc: $b = unserialize($v['settings']); goto tU19I; tU19I: echo ',' . $b['tbuid']; goto u4K_Q; u4K_Q: dxFYZ: goto ZAOWF; ZAOWF: } goto Lxrf3; UzbEH: $s = pdo_fetchall('select settings from ' . tablename('uni_account_modules') . ' where module=\'tiger_newhu\''); goto nbtMV; lZBvt: echo '使用域名:' . $host . '<br>'; goto awi6x; NGYB4: $cfg = $this->module['config']; goto Tedir; XfO3t: echo '域名:' . $tkurl2 . '<br>'; goto lvJHb; ZCF3l: } public function oldtkl($url, $img, $tjcontent) { goto zC5GH; ZyZ_U: $tpwd_param->logo = $img; goto LLDXe; pB11a: settype($taokou, 'string'); goto Mjb3E; CzKVe: $taokou = str_replace('《', '￥', $taokou); goto Nu_4G; Mjb3E: if (!($cfg['tklnewtype'] == 1)) { goto NU8HQ; } goto CzKVe; rB9M3: $secret = $cfg['tksecretKey']; goto juwcf; p5dza: $resp = $c->execute($req); goto V2Q86; SqnyX: return $taokou; goto nT479; juwcf: $c = new TopClient(); goto LT3W7; IPTwU: $req = new WirelessShareTpwdCreateRequest(); goto GlL0Z; LT3W7: $c->appkey = $appkey; goto TgNke; i7cOt: $tpwd_param->url = $url; goto FFA3o; TgNke: $c->secretKey = $secret; goto IPTwU; Nu_4G: NU8HQ: goto qF4XV; FFA3o: $req->setTpwdParam(json_encode($tpwd_param)); goto p5dza; V2Q86: $taokou = $resp->model; goto pB11a; SukkW: $tpwd_param->ext = '{"":""}'; goto ZyZ_U; LLDXe: $tpwd_param->text = $tjcontent; goto i7cOt; GlL0Z: $tpwd_param = new GenPwdIsvParamDto(); goto SukkW; oiZsw: $cfg = $this->module['config']; goto WbBhL; WbBhL: $appkey = $cfg['tkAppKey']; goto rB9M3; zC5GH: global $_W, $_GPC; goto oiZsw; qF4XV: file_put_contents(IA_ROOT . '/addons/tiger_newhu/oldtkl_log.txt', '
' . json_encode($resp), FILE_APPEND); goto SqnyX; nT479: } public function hlinorder($userInfo, $_W) { goto OSJJZ; bM6Qz: $cfg = $this->module['config']; goto tlRyg; weXJW: B2qA1: goto XZQ5_; OSJJZ: global $_W, $_GPC; goto bM6Qz; tlRyg: foreach ($userInfo as $v) { goto jfQpU; OHdsD: J9FDo: goto PzB1x; SFI3Y: goto J9FDo; goto u3J0x; PzB1x: Zqxil: goto kk_U2; sB8jn: pdo_update($this->modulename . '_newtbgoods', $item, array("weid" => $_W['uniacid'], "itemid" => $v['itemid'])); goto SFI3Y; EDExk: $go = pdo_fetch('SELECT id FROM ' . tablename($this->modulename . '_newtbgoods') . " WHERE weid='{$_W['uniacid']}' and itemid='{$v['itemid']}' ORDER BY id desc"); goto N2pPh; AOIxj: $Quan_id = $this->strurl($v['couponurl']); goto z848A; u3J0x: F3Ia1: goto kLEaz; N2pPh: if (empty($go)) { goto F3Ia1; } goto sB8jn; jfQpU: $fztype = pdo_fetch('select * from ' . tablename($this->modulename . '_fztype') . " where weid='{$_W['uniacid']}' and hlcid='{$v['fqcat']}' order by px desc"); goto AOIxj; kLEaz: pdo_insert($this->modulename . '_newtbgoods', $item); goto OHdsD; z848A: $item = array("weid" => $_W['uniacid'], "fqcat" => $fztype['id'], "zy" => 2, "quan_id" => $Quan_id, "itemid" => $v['itemid'], "itemtitle" => $v['itemtitle'], "itemshorttitle" => $v['itemshorttitle'], "itemdesc" => $v['itemdesc'], "itemprice" => $v['itemprice'], "itemsale" => $v['itemsale'], "itemsale2" => $v['itemsale2'], "conversion_ratio" => $v['conversion_ratio'], "itempic" => $v['itempic'], "itemendprice" => $v['itemendprice'], "shoptype" => $v['shoptype'], "userid" => $v['userid'], "sellernick" => $v['sellernick'], "tktype" => $v['tktype'], "tkrates" => $v['tkrates'], "ctrates" => $v['ctrates'], "cuntao" => $v['cuntao'], "tkmoney" => $v['tkmoney'], "tkurl" => $v['tkurl'], "couponurl" => $v['couponurl'], "planlink" => $v['planlink'], "couponmoney" => $v['couponmoney'], "couponsurplus" => $v['couponsurplus'], "couponreceive" => $v['couponreceive'], "couponreceive2" => $v['couponreceive2'], "couponnum" => $v['couponnum'], "couponexplain" => $v['couponexplain'], "couponstarttime" => $v['couponstarttime'], "couponendtime" => $v['couponendtime'], "starttime" => $v['starttime'], "isquality" => $v['isquality'], "item_status" => $v['item_status'], "report_status" => $v['report_status'], "is_brand" => $v['is_brand'], "is_live" => $v['is_live'], "videoid" => $v['videoid'], "activity_type" => $v['activity_type'], "createtime" => TIMESTAMP); goto EDExk; kk_U2: } goto weXJW; XZQ5_: } public function indtkgoods($dtklist) { goto DJQSZ; DJQSZ: global $_W, $_GPC; goto GsiO9; Q4hKA: FutD_: goto rTm5e; GsiO9: $page = $_GPC['page']; goto pNuBP; pNuBP: $cfg = $this->module['config']; goto t4J47; t4J47: foreach ($dtklist as $v) { goto ETpmb; JE5SV: CYTnw: goto DFBJ7; ZwYvz: dcL2u: goto VtPOc; JUzIz: $item = array("weid" => $_W['uniacid'], "fqcat" => $fztype['id'], "zy" => 1, "tktype" => $lxtype, "itemid" => $v['GoodsID'], "itemtitle" => $v['Title'], "itemdesc" => $v['Introduce'], "itempic" => $v['Pic'], "itemendprice" => $v['Price'], "itemsale" => $v['Sales_num'], "tkrates" => $yjbl, "couponreceive" => $v['Quan_receive'], "couponsurplus" => $v['Quan_surplus'], "couponmoney" => $v['Quan_price'], "couponendtime" => strtotime($v['Quan_time']), "couponurl" => $v['Quan_link'], "shoptype" => $shoptype, "quan_id" => $v['Quan_id'], "couponexplain" => $v['Quan_condition'], "itemprice" => $v['Org_Price'], "tkurl" => $v['Jihua_link'], "createtime" => TIMESTAMP); goto jpdPT; VtPOc: $lxtype = '鹊桥活动'; goto hTC8T; hTC8T: $yjbl = $v['Commission_queqiao']; goto v3nyD; LYIdb: if ($v['Commission_queqiao'] != '0.00') { goto dcL2u; } goto mTSsf; E9cLm: $yjbl = $v['Commission_jihua']; goto TvE_p; ETpmb: $fztype = pdo_fetch('select * from ' . tablename($this->modulename . '_fztype') . " where weid='{$_W['uniacid']}' and dtkcid='{$v['Cid']}' order by px desc"); goto LYIdb; YP4I3: $lxtype = '营销计划'; goto E9cLm; NnToA: $lxtype = '通用计划'; goto pVFzO; DFBJ7: $shoptype = 'B'; goto SF_NV; acaQd: pdo_update($this->modulename . '_newtbgoods', $item, array("weid" => $_W['uniacid'], "itemid" => $v['GoodsID'])); goto qzlWW; r_JGp: goto JE5Ye; goto JE5SV; uFmsW: goto Ld_ft; goto ZwYvz; Lfh61: h9CkC: goto YP4I3; pVFzO: $yjbl = $v['Commission_jihua']; goto uFmsW; qzlWW: goto CxoCg; goto mqIg1; jpdPT: $go = pdo_fetch('SELECT itemid FROM ' . tablename($this->modulename . '_newtbgoods') . " WHERE weid = '{$_W['uniacid']}' and  itemid={$v['GoodsID']} "); goto cdQ9V; mTSsf: if ($v['Commission_jihua'] != '0.00') { goto h9CkC; } goto NnToA; RYkSV: CxoCg: goto JzLpO; TvE_p: Ld_ft: goto J0HxR; mqIg1: KkTrD: goto tErGk; v3nyD: goto Ld_ft; goto Lfh61; SF_NV: JE5Ye: goto JUzIz; J0HxR: if ($v['IsTmall'] == 1) { goto CYTnw; } goto Uisl1; cdQ9V: if (empty($go)) { goto KkTrD; } goto acaQd; Uisl1: $shoptype = 'C'; goto r_JGp; tErGk: pdo_insert($this->modulename . '_newtbgoods', $item); goto RYkSV; JzLpO: sFkBt: goto Dqsj3; Dqsj3: } goto Q4hKA; rTm5e: } public function apUpload($media_id) { goto EZLZd; ltN1M: curl_setopt($ch, CURLOPT_HEADER, 0); goto Cu1Ld; rlHku: $accObj = WeixinAccount::create($_W['uniacid']); goto BuoGm; PRnjk: curl_setopt($ch, CURLOPT_FILE, $fp); goto ltN1M; Cjcfy: if (is_dir($newfolder)) { goto rAxhQ; } goto Szr82; BuoGm: $access_token = $accObj->fetch_token(); goto leejU; vG0gB: $newfolder = ATTACHMENT_ROOT . 'images' . '/tiger_newhu_photos' . '/'; goto Cjcfy; Cu1Ld: curl_exec($ch); goto eiwiz; vCr9F: load()->classs('weixin.account'); goto rlHku; leejU: $url = 'http://file.api.weixin.qq.com/cgi-bin/media/get?access_token=' . $access_token . '&media_id=' . $media_id; goto GVEXw; EZLZd: global $_W, $_GPC; goto vCr9F; KpOf8: $picurl = 'images' . '/tiger_newhu_photos' . '/' . date('YmdHis') . rand(1000, 9999) . '.jpg'; goto KvcIC; eiwiz: curl_close($ch); goto saenx; Uml_6: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log.txt', '
 old:' . json_encode($media_id), FILE_APPEND); goto vG0gB; Lq89h: $ch = curl_init($url); goto fIntl; rFKhs: return $picurl; goto MBxDE; saenx: fclose($fp); goto rFKhs; fIntl: $fp = fopen($targetName, 'wb'); goto PRnjk; sj8CB: rAxhQ: goto KpOf8; GVEXw: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log.txt', '
 old:' . json_encode($access_token), FILE_APPEND); goto Uml_6; Szr82: mkdir($newfolder, 7777); goto sj8CB; KvcIC: $targetName = ATTACHMENT_ROOT . $picurl; goto Lq89h; MBxDE: } public function dwz($url) { goto HJo34; sfo4x: goto qNE3b; goto G2Wf4; vggzo: $urlarr = $this->zydwz($turl); goto IUCQj; sG5dg: $url = urlencode($url); goto Rb4Nk; FNdkr: qNE3b: goto IZo9j; G2Wf4: gtcJM: goto ShkuX; HJo34: global $_W; goto utfXm; utfXm: $cfg = $this->module['config']; goto sG5dg; IUCQj: goto qNE3b; goto GTCgE; OLgkk: $url = $this->sinadwz($turl); goto sfo4x; L54Mh: if ($cfg['dwzlj'] == 1) { goto gtcJM; } goto vggzo; GTCgE: Y6hC5: goto OLgkk; Rb4Nk: $turl = $_W['siteroot'] . str_replace('./', 'app/', $this->createMobileurl('openlink', array("link" => $url))); goto otgpf; otgpf: if ($cfg['dwzlj'] == 0) { goto Y6hC5; } goto L54Mh; ShkuX: $url = $this->wxdwz($turl); goto FNdkr; IZo9j: } public function dwzw($turl) { goto BILg4; zSEjq: $url = $this->wxdwz($turl); goto q41k9; To5I8: oooF2: goto zSEjq; q41k9: pPH1n: goto sDHp1; SUPAW: $url = $this->sinadwz($turl); goto D5WAu; xV18Q: if ($cfg['dwzlj'] == 1) { goto oooF2; } goto OqOWj; g14rJ: $cfg = $this->module['config']; goto Lwnvd; NPEJ7: SOBAx: goto SUPAW; sDHp1: return $url; goto JLpHs; BILg4: global $_W; goto g14rJ; Lwnvd: if ($cfg['dwzlj'] == 0) { goto SOBAx; } goto xV18Q; OqOWj: $url = $this->zydwz($turl); goto Dr8t_; D5WAu: goto pPH1n; goto To5I8; Dr8t_: goto pPH1n; goto NPEJ7; JLpHs: } public function zydwz($turl) { goto qS3Ba; mD3h7: $url = $cfg['zydwz'] . 't.php?d=' . $id; goto G_uxv; qS3Ba: global $_W; goto jLzY3; Ak9bm: pdo_insert('tiger_newhu_dwz', $data); goto VgdVC; VgdVC: $id = pdo_insertid(); goto mD3h7; Wacpk: $data = array("weid" => $_W['uniacid'], "url" => $turl, "createtime" => TIMESTAMP); goto Ak9bm; G_uxv: return $url; goto mQ_P6; jLzY3: $cfg = $this->module['config']; goto Wacpk; mQ_P6: } public function wxdwz($url) { goto v00yS; v00yS: $result = '{"action":"long2short","long_url":"' . $url . '"}'; goto Jbfx8; hIAco: $url = "https://api.weixin.qq.com/cgi-bin/shorturl?access_token={$access_token}"; goto GQFGF; GQFGF: $ret = ihttp_request($url, $result); goto zhKz3; aonsw: return $content['short_url']; goto eHb4n; zhKz3: $content = @json_decode($ret['content'], true); goto aonsw; Jbfx8: $access_token = $this->getAccessToken(); goto hIAco; eHb4n: } public function sinadwz($url) { goto i7e2y; lVR8x: $json = ihttp_get($sinaurl); goto Zn9c7; Zn9c7: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log--sina.txt', '
--3' . $url, FILE_APPEND); goto t2bF3; P2eNj: $result = @json_decode($json['content'], true); goto m9vuz; kg7kk: goto IIui7; goto tYO71; SB7_o: $cfg = $this->module['config']; goto rnfvU; i7e2y: global $_W; goto SB7_o; FZz_y: $turl2 = urlencode($url); goto owH9r; k2Ne9: IIui7: goto FZz_y; owH9r: $sinaurl = "http://api.t.sina.com.cn/short_url/shorten.json?source={$key}&url_long={$turl2}"; goto L5Dap; Qi9BE: $key = trim($cfg['sinkey']); goto kg7kk; t2bF3: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log--sina.txt', '
--3' . json_encode($json), FILE_APPEND); goto P2eNj; m9vuz: return $result[0]['url_short']; goto CxRPw; tYO71: uVJFm: goto jLA8K; L5Dap: load()->func('communication'); goto lVR8x; rnfvU: if (empty($cfg['sinkey'])) { goto uVJFm; } goto Qi9BE; jLA8K: $key = '1549359964'; goto k2Ne9; CxRPw: } public function addtbgoods($data) { goto aacYE; vgEwN: goto gPUUd; goto Pv6gt; kvSg_: $go = pdo_fetch('SELECT id FROM ' . tablename($this->modulename . '_tbgoods') . " WHERE weid = '{$data['weid']}' and  num_iid='{$data['num_iid']}'"); goto Ybv5g; tnJcm: pdo_update($this->modulename . '_tbgoods', $data, array("weid" => $data['weid'], "num_iid" => $data['num_iid'])); goto vgEwN; eIPrZ: if (!($cfg['cxrk'] == 1)) { goto JvaGQ; } goto JyTIt; GJCK4: pdo_insert($this->modulename . '_tbgoods', $data); goto ZgF33; JyTIt: if (!empty($data['num_iid'])) { goto Ay5kQ; } goto u3STC; XIhsv: Ay5kQ: goto kvSg_; Pv6gt: s1e3X: goto GJCK4; aacYE: $cfg = $this->module['config']; goto eIPrZ; ZgF33: gPUUd: goto d4PmX; u3STC: return ''; goto XIhsv; Ybv5g: if (empty($go)) { goto s1e3X; } goto tnJcm; d4PmX: JvaGQ: goto IsOr1; IsOr1: } public function mygetID($url) { goto m3l8s; ODFG1: vQ04A: goto F9lIX; m3l8s: if (preg_match('/[\\?&]id=(\\d+)/', $url, $match)) { goto vQ04A; } goto Lk9bO; F9lIX: return $match[1]; goto bHosP; bHosP: Y65ia: goto m1cpo; Lk9bO: return ''; goto rPDq1; rPDq1: goto Y65ia; goto ODFG1; m1cpo: } public function getyouhui2($str) { preg_match_all('|(￥[^￥]+￥)|ism', $str, $matches); return $matches[1][0]; } public function geturl($str) { goto g5Kn_; HfXga: $url = substr($url, 0, $matches[0][1]); goto vpnzb; CixHD: return ''; goto b6LC3; aOizZ: $url = 'http' . trim($exp[1]) . ' '; goto Adm2y; EQPUR: return $url; goto EY7EE; b6LC3: W96B1: goto HaA75; g5Kn_: $exp = explode('http', $str); goto aOizZ; Adm2y: preg_match('/[\\s]/u', $url, $matches, PREG_OFFSET_CAPTURE); goto HfXga; QAklf: XbPyY: goto CixHD; EY7EE: goto W96B1; goto QAklf; vpnzb: if ($url == 'http') { goto XbPyY; } goto EQPUR; HaA75: } public function myisexists($url) { goto KwhDk; kwHKr: return 1; goto p96DZ; oGHDn: return 2; goto fvM7r; Z94EG: if (stripos($url, 'tmall.hk') !== false) { goto DsHol; } goto kwHKr; CfMmw: GYTrL: goto oGHDn; KwhDk: if (stripos($url, 'taobao.com') !== false) { goto GYTrL; } goto dtIO_; DZC6Y: e7lks: goto cp7l0; aF4JP: return 2; goto hkIiw; Th9Zb: return 0; goto hSsQ2; hkIiw: GDsFd: goto Th9Zb; cp7l0: return 2; goto jgD15; dtIO_: if (stripos($url, 'tmall.com') !== false) { goto e7lks; } goto Z94EG; jgD15: goto GDsFd; goto rySS7; rySS7: DsHol: goto aF4JP; p96DZ: goto GDsFd; goto CfMmw; fvM7r: goto GDsFd; goto DZC6Y; hSsQ2: } public function jdgoodsID($url) { goto XTa4s; SnaCE: jXadw: goto EERnG; XTa4s: $goodsid = $this->Text_qzj($url, '?sku=', '&'); goto ZG_AA; W_Ijr: $goodsid = $this->Text_qzj($url, 'product/', '.html'); goto KdL_E; EERnG: if (!empty($goodsid)) { goto R7ANs; } goto nBP2w; KdL_E: ggHVB: goto NScHH; Bggqv: $goodsid = $this->Text_qzj($url, 'com/', '.html'); goto SnaCE; ZG_AA: if (!empty($goodsid)) { goto ggHVB; } goto W_Ijr; NScHH: if (!empty($goodsid)) { goto jXadw; } goto Bggqv; cK6U5: return $goodsid; goto ustgT; ifByU: R7ANs: goto cK6U5; nBP2w: $goodsid = $this->jdgoods($url); goto ifByU; ustgT: } public function pddgoodsID($url) { goto tNiMa; cJpmW: w82kk: goto qEJeA; qEJeA: return $match[1]; goto MUhQt; MUhQt: lOOh1: goto NZdE6; BAcxe: goto lOOh1; goto cJpmW; tCvxI: return ''; goto BAcxe; tNiMa: if (preg_match('/[\\?&]goods_id=(\\d+)/', $url, $match)) { goto w82kk; } goto tCvxI; NZdE6: } public function pdddwzw($turl) { goto d7N6U; Wt6Ik: $cfg = $this->module['config']; goto xvYm9; d7N6U: global $_W; goto Wt6Ik; xvYm9: $url = $this->zydwz($turl); goto XgIHz; XgIHz: return $url; goto MLZZg; MLZZg: } public function getgoodsid($url) { goto kQjxm; mnpnp: if (!empty($goodsid)) { goto yRGWH; } goto K9TGt; klsca: if (!empty($goodsid)) { goto tr5lq; } goto vhkIe; WoFwn: $goodsid = $this->Text_qzj($str, 'com/i', '.htm'); goto ugtta; Zk6eF: if (!empty($goodsid)) { goto cd1ht; } goto gup8l; gup8l: $goodsid = $this->Text_qzj($str, '&id=', '&'); goto ha2Wu; vhkIe: $goodsid = $this->Text_qzj($str, 'itemId:', ','); goto xLReh; HRSnI: $goodsid = $this->Text_qzj($str, '?id=', '&'); goto Zk6eF; kQjxm: $str = $url; goto HRSnI; eGkls: $goodsid = $this->Text_qzj($str, 'itemId%3D', '%26'); goto x0z16; K9TGt: $url = $this->Text_qzj($str, 'url = \'', '\';'); goto WoFwn; ha2Wu: cd1ht: goto klsca; ugtta: yRGWH: goto FR3Lw; jlgUu: if (!empty($goodsid)) { goto cp151; } goto eGkls; lw1EO: if (!empty($goodsid)) { goto gbBUz; } goto mUCVz; x0z16: cp151: goto F5o9I; al52O: gbBUz: goto jlgUu; F5o9I: return $goodsid; goto Hj1Bq; C6cOb: $goodsid = $this->Text_qzj($str, 'itemid=', '&'); goto DTYH5; mUCVz: $goodsid = $this->Text_qzj($str, 'itemId=', '&'); goto al52O; xLReh: tr5lq: goto mnpnp; DTYH5: r4OKU: goto lw1EO; FR3Lw: if (!empty($goodsid)) { goto r4OKU; } goto C6cOb; Hj1Bq: } public function hqgoodsid($url) { goto Ilb_e; wgmSo: $goodsid = $this->Text_qzj($str, 'itemId:', ','); goto bcQlV; MzYM4: $goodsid = $this->Text_qzj($str, '?id=', '&'); goto vyiOq; NFgDU: $goodsid = $this->Text_qzj($str, '&id=', '&'); goto MaZLY; aWSD0: $goodsid = $this->Text_qzj($str, 'com/i', '.htm'); goto eKXul; PGn1E: if (!empty($goodsid)) { goto OKZ6B; } goto wgmSo; EfbZX: if (!empty($goodsid)) { goto x7oPW; } goto XC5Yp; eKXul: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log.txt', '
' . json_encode($goodsid), FILE_APPEND); goto jaBEE; MaZLY: NUaJh: goto PGn1E; XC5Yp: $url = $this->Text_qzj($str, 'url = \'', '\';'); goto aWSD0; jaBEE: x7oPW: goto RlHgi; FKrPr: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log.txt', '
' . $str, FILE_APPEND); goto MzYM4; RlHgi: return $goodsid; goto YGZoc; bcQlV: OKZ6B: goto EfbZX; jpXBZ: $str = str_replace('"', '', $str); goto FKrPr; vyiOq: if (!empty($goodsid)) { goto NUaJh; } goto NFgDU; Ilb_e: $str = file_get_contents($url); goto jpXBZ; YGZoc: } public function Text_qzj($Text, $Front, $behind) { goto OvRlW; Lveqw: SkXmT: goto AUiOL; c9LB4: $t1 = $t1 - 1 + strlen($Front); goto XnUJ2; XnUJ2: goto SkXmT; goto SJoHH; AUiOL: $temp = mb_substr($Text, $t1, strlen($Text) - $t1); goto qOar5; Ug2kt: FXqWw: goto hbQYY; SJoHH: i0wX0: goto UHO34; hqM3D: if (!($t2 == FALSE)) { goto FXqWw; } goto kvGK4; kvGK4: return ''; goto Ug2kt; UHO34: return ''; goto Lveqw; hbQYY: return mb_substr($temp, 0, $t2); goto Wh25r; OvRlW: $t1 = mb_strpos('.' . $Text, $Front); goto noXED; noXED: if ($t1 == FALSE) { goto i0wX0; } goto c9LB4; qOar5: $t2 = mb_strpos($temp, $behind); goto hqM3D; Wh25r: } function gstr($str) { goto eIx88; OY103: DwtnH: goto a050c; Lbahx: if (!(!$encode == 'UTF-8')) { goto DwtnH; } goto imYEq; eIx88: $encode = mb_detect_encoding($str, array("ASCII", "UTF-8", "GB2312", "GBK")); goto Lbahx; a050c: return $str; goto xuv2E; imYEq: $str = iconv('UTF-8', $encode, $str); goto OY103; xuv2E: } public function ewm($url) { goto h79Pv; pGAMm: $errorCorrectionLevel = 'L'; goto yrsGq; BQGFM: exit; goto DZ3LS; aDFux: $value = $url; goto pGAMm; yrsGq: $matrixPointSize = '4'; goto N6Gr3; h79Pv: include 'phpqrcode.php'; goto aDFux; N6Gr3: QRcode::png($value, false, $errorCorrectionLevel, $matrixPointSize); goto BQGFM; DZ3LS: } public function sendNews($openid, $text) { goto W5819; p37Nm: return $ret; goto yuKY4; RoHxK: $result = urldecode(json_encode($custom)); goto B5uHF; W5819: global $_W, $_GPC; goto jVWCn; LK3zB: $custom = array("touser" => $openid, "msgtype" => "news", "news" => array("articles" => array(array("title" => urlencode('晒单奖励提醒'), "description" => urlencode($text), "url" => $url, "picurl" => "")))); goto RoHxK; D431E: $ret = ihttp_request($url, $result); goto p37Nm; jVWCn: $url = $_W['siteroot'] . str_replace('./', 'app/', $this->createMobileurl('index')); goto LK3zB; Sk2Dz: $url = "https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token={$access_token}"; goto D431E; B5uHF: $access_token = $this->getAccessToken(); goto Sk2Dz; yuKY4: } public function postText($openid, $text) { goto pxkaZ; kkej6: $ret = $this->postRes($this->getAccessToken(), $post); goto ylqVJ; ylqVJ: return $ret; goto OC3MY; pxkaZ: $post = '{"touser":"' . $openid . '","msgtype":"text","text":{"content":"' . $text . '"}}'; goto kkej6; OC3MY: } private function postRes($access_token, $data) { goto EzDIn; j_NB_: $ret = ihttp_request($url, $data); goto scC6C; gAgvB: load()->func('communication'); goto j_NB_; scC6C: $content = @json_decode($ret['content'], true); goto IDuG_; IDuG_: return $content['errcode']; goto DB7WG; EzDIn: $url = "https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token={$access_token}"; goto gAgvB; DB7WG: } private function getAccessToken() { goto dVanj; kVnAv: return $token; goto XlNnL; G5oQT: g9pm9: goto kwtKp; VkEuq: load()->model('account'); goto O1lQM; kwtKp: include IA_ROOT . '/addons/tiger_newhu/wxtoken.php'; goto kVnAv; R2FLt: if (!empty($acid)) { goto g9pm9; } goto fq0X0; O1lQM: $acid = $_W['acid']; goto R2FLt; fq0X0: $acid = $_W['uniacid']; goto G5oQT; dVanj: global $_W; goto VkEuq; XlNnL: } public function createRule($kword, $pid) { goto NrmuG; TUb12: $rule['type'] = 1; goto qUSrz; l1LUv: unset($rule['name']); goto TUb12; cBFvy: $rule = array("uniacid" => $_W['uniacid'], "name" => $this->modulename, "module" => $this->modulename, "status" => 1, "displayorder" => 254); goto edmM0; D8tm3: pdo_update($this->modulename . '_poster', array("rid" => $rule['rid']), array("id" => $pid)); goto wNXJ0; JzRXH: $rule['content'] = $kword; goto GoCFP; qUSrz: $rule['rid'] = pdo_insertid(); goto JzRXH; GoCFP: pdo_insert('rule_keyword', $rule); goto bcAPr; bcAPr: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log.txt', '
 old:' . json_encode($pid . '----' . $rule['rid']), FILE_APPEND); goto D8tm3; NrmuG: global $_W; goto cBFvy; edmM0: pdo_insert('rule', $rule); goto l1LUv; wNXJ0: } public function get_device_type() { goto x4PwW; iBHEx: if (!(strpos($agent, 'iphone') || strpos($agent, 'ipad'))) { goto rvAqn; } goto EHkc6; hPU3q: return $type; goto K2ge5; pIDCv: $type = 'android'; goto OI3UN; a8Xa6: if (!strpos($agent, 'android')) { goto sYz1Z; } goto pIDCv; OI3UN: sYz1Z: goto hPU3q; x4PwW: $agent = strtolower($_SERVER['HTTP_USER_AGENT']); goto ZViz7; A9JDp: rvAqn: goto a8Xa6; EHkc6: $type = 'ios'; goto A9JDp; ZViz7: $type = 'android'; goto iBHEx; K2ge5: } public function gettaogoods($numid, $api) { goto L77d3; cfsx7: $appkey = $api['appkey']; goto CfBnv; dv8Lx: return $arr; goto Zd2Nr; dHSHi: $c->appkey = $appkey; goto TsckV; mryed: $req->setPlatform('1'); goto sCah2; L77d3: $c = new TopClient(); goto cfsx7; sCah2: $req->setNumIids($numid); goto PAjsx; feYEj: $secretKey = $api['tksecretKey']; goto A4p2y; PAjsx: $resp = $c->execute($req); goto vpWOJ; KOcBw: $req->setFields('num_iid,title,pict_url,small_images,reserve_price,zk_final_price,user_type,provcity,item_url,seller_id,volume,nick,shop_dsr,ratesum,i_rfd_rate,h_good_rate,h_pay_rate30'); goto mryed; TsckV: $c->secretKey = $secretKey; goto pmV2l; CfBnv: $secretKey = $api['secretKey']; goto Jif6n; A4p2y: uey6w: goto dHSHi; QCtg3: $appkey = $api['tkAppKey']; goto feYEj; vpWOJ: $resp = json_decode(json_encode($resp), TRUE); goto DT9rC; DT9rC: $arr = $resp['results']['n_tbk_item']; goto dv8Lx; Jif6n: if (!empty($appkey)) { goto uey6w; } goto QCtg3; pmV2l: $req = new TbkItemInfoGetRequest(); goto KOcBw; Zd2Nr: } public function goodlist($key, $pid, $page) { goto DhVwz; bHW1u: $resp = json_decode(json_encode($resp), TRUE); goto T6qgB; gDXyD: $c->appkey = $api['appkey']; goto Ixs1c; Vd3r4: NcmJE: goto wFq1T; Ixs1c: $c->secretKey = $api['secretKey']; goto bsNaI; wFq1T: return $list; goto iMIrD; a2UZE: $api = taobaopp($tiger); goto XwIIr; J9cDE: $req->setQ($key); goto PUGo_; XwIIr: $c = new TopClient(); goto gDXyD; fZmY1: $req->setPlatform('2'); goto B32I1; T6qgB: $goods = $resp['results']['tbk_coupon']; goto lNjI0; PUGo_: $req->setPageNo($page); goto d45Pj; DhVwz: require_once IA_ROOT . '/addons/tiger_newhu/inc/sdk/getpic.php'; goto a2UZE; bsNaI: $req = new TbkItemCouponGetRequest(); goto fZmY1; d45Pj: $req->setPid($pid); goto UO0K4; UO0K4: $resp = $c->execute($req); goto bHW1u; lNjI0: foreach ($goods as $k => $v) { goto WkihB; RGWYa: $list[$k]['url'] = $v['coupon_click_url']; goto K6JN0; fuVIU: preg_match_all('|满([\\d\\.]+).*元减([\\d\\.]+).*元|ism', $v['coupon_info'], $matches); goto Lld4h; dLJfU: $list[$k]['nick'] = $v['nick']; goto KkH8l; Lld4h: $list[$k]['coupons_price'] = $matches[2][0]; goto xxTlV; TBqDi: $list[$k]['pic_url'] = $v['pict_url']; goto zK05p; P4pql: $list[$k]['small_images'] = $v['small_images']['string']; goto TBqDi; s_EI3: $list[$k]['item_url'] = $v['item_url']; goto P4pql; sxhQX: $list[$k]['coupons_total'] = $v['coupon_total_count']; goto s_EI3; KkH8l: $list[$k]['coupons_take'] = $v['coupon_remain_count']; goto sxhQX; cumBk: $list[$k]['price'] = $v['zk_final_price'] - $matches[2][0]; goto kNTMK; zK05p: gkesR: goto PSr7F; K6JN0: $list[$k]['coupons_end'] = $v['coupon_end_time']; goto fuVIU; mdMgZ: $list[$k]['pic_url'] = $v['pict_url']; goto soiaZ; xxTlV: $list[$k]['goods_sale'] = $v['volume']; goto cumBk; kNTMK: $list[$k]['org_price'] = $v['zk_final_price']; goto mdMgZ; QT6a6: $list[$k]['istmall'] = $v['user_type']; goto gecZv; soiaZ: $list[$k]['shop_title'] = $v['shop_title']; goto NkePN; gecZv: $list[$k]['num_iid'] = $v['num_iid']; goto RGWYa; NkePN: $list[$k]['tk_rate'] = $v['commission_rate']; goto dLJfU; WkihB: $list[$k]['title'] = $v['title']; goto QT6a6; PSr7F: } goto Vd3r4; B32I1: $req->setPageSize('20'); goto J9cDE; iMIrD: } public function rhy($quan_id, $num_iid, $pid) { $url = 'https://uland.taobao.com/coupon/edetail?activityId=' . $quan_id . '&itemId=' . $num_iid . '&src=tiger_tiger&pid=' . $pid . ''; return $url; } public function rhydx($quan_id, $num_iid, $pid) { $url = 'https://uland.taobao.com/coupon/edetail?activityId=' . $quan_id . '&itemId=' . $num_iid . '&src=tiger_tiger&pid=' . $pid . '&dx=1'; return $url; } private function sendtext($txt, $openid) { goto fDT6I; ibw1B: JlYOn: goto mQMq1; fDT6I: global $_W; goto za7t8; w2IXI: $acid = pdo_fetchcolumn('SELECT acid FROM ' . tablename('account') . ' WHERE uniacid=:uniacid ', array(":uniacid" => $_W['uniacid'])); goto ibw1B; mQMq1: include IA_ROOT . '/addons/tiger_newhu/wxtoken.php'; goto eTHgM; iTZME: if ($acid) { goto JlYOn; } goto w2IXI; eTHgM: $data = $account->sendCustomNotice(array("touser" => $openid, "msgtype" => "text", "text" => array("content" => urlencode($txt)))); goto tyfGR; tyfGR: return $data; goto ZV3aY; za7t8: $acid = $_W['account']['acid']; goto iTZME; ZV3aY: } function GetIpLookup($ip = "") { goto bOBC4; Kp0IV: return false; goto kzZN2; Wc0hL: DjULf: goto JAgXl; XLHE1: if (!empty($res)) { goto fnKuQ; } goto Kp0IV; CBQ3v: $res = @file_get_contents('http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js&ip=' . $ip); goto XLHE1; IHz2n: if (isset($json['ret']) && $json['ret'] == 1) { goto DjULf; } goto gPkhf; H01mH: preg_match('#\\{.+?\\}#', $res, $jsonMatches); goto GzL_C; RINCt: IQt_y: goto lzVeT; tOM11: $jsonMatches = array(); goto H01mH; b2cv7: DTEWw: goto CBQ3v; NGVLN: unset($json['ret']); goto js8qy; A8uR9: return $json; goto Rh73J; qIPp8: return false; goto RINCt; GzL_C: if (isset($jsonMatches[0])) { goto IQt_y; } goto qIPp8; tIxk_: $ip = GetIp(); goto b2cv7; bOBC4: if (!empty($ip)) { goto DTEWw; } goto tIxk_; lzVeT: $json = json_decode($jsonMatches[0], true); goto IHz2n; JAgXl: $json['ip'] = $ip; goto NGVLN; YSwJO: goto UrObb; goto Wc0hL; kzZN2: fnKuQ: goto tOM11; gPkhf: return false; goto YSwJO; js8qy: UrObb: goto A8uR9; Rh73J: } function getIp() { goto agD0O; P78V_: goto SUqaX; goto Cs0Qn; pKvqk: goto SUqaX; goto f3zXi; ahAQl: SUqaX: goto X7BYL; agD0O: $onlineip = ''; goto y_bTW; Cs0Qn: WaAll: goto XrYGN; Kqchw: goto SUqaX; goto vbOjw; CF4LG: if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], 'unknown')) { goto rlGhA; } goto pKvqk; XrYGN: $onlineip = getenv('HTTP_X_FORWARDED_FOR'); goto Kqchw; y_bTW: if (getenv('HTTP_CLIENT_IP') && strcasecmp(getenv('HTTP_CLIENT_IP'), 'unknown')) { goto UQ8DN; } goto pKAa5; P0zhC: rlGhA: goto QTaqH; jw9AW: $onlineip = getenv('REMOTE_ADDR'); goto E0TH3; vbOjw: W3T7E: goto jw9AW; f3zXi: UQ8DN: goto cZvm_; QTaqH: $onlineip = $_SERVER['REMOTE_ADDR']; goto ahAQl; cZvm_: $onlineip = getenv('HTTP_CLIENT_IP'); goto P78V_; X7BYL: return $onlineip; goto XEC4q; XeRxF: if (getenv('REMOTE_ADDR') && strcasecmp(getenv('REMOTE_ADDR'), 'unknown')) { goto W3T7E; } goto CF4LG; E0TH3: goto SUqaX; goto P0zhC; pKAa5: if (getenv('HTTP_X_FORWARDED_FOR') && strcasecmp(getenv('HTTP_X_FORWARDED_FOR'), 'unknown')) { goto WaAll; } goto XeRxF; XEC4q: } public function sendMsg($openid, $tplmsgid, $data = array(), $data1, $url = "") { goto dUhyM; fslSQ: if (empty($data)) { goto Agswe; } goto lFNeA; gSn2q: return $account->sendTplNotice($openid, $tplmsgid, $data, $url); goto s_xvz; lFNeA: include IA_ROOT . '/addons/tiger_newhu/wxtoken.php'; goto sLH2W; Gng7Y: if ($_W['account']['level'] == 4) { goto rSg0g; } goto Ye9NM; dUhyM: global $_W; goto aEKNs; ApkvA: $this->postText($this->message['from'], $data1); goto GDTt2; zAuSf: Agswe: goto B5m3L; GDTt2: goto IhyRu; goto ss0mF; s_xvz: IhyRu: goto zAuSf; aEKNs: $cfg = $this->module['config']; goto fslSQ; ss0mF: rSg0g: goto gSn2q; Ye9NM: goto IhyRu; goto tEwst; sLH2W: if (empty($tplmsgid)) { goto mVQjg; } goto Gng7Y; tEwst: mVQjg: goto ApkvA; B5m3L: } public function sendMsg1($openid, $tplmsgid, $data = array(), $data1, $url = "") { goto b8hY_; avZt2: return $account->sendTplNotice($openid, $tplmsgid, $data, $url); goto S6s8P; b8hY_: global $_W; goto g1V6i; A6JEC: include IA_ROOT . '/addons/tiger_newhu/wxtoken.php'; goto avZt2; g1V6i: $cfg = $this->module['config']; goto A6JEC; S6s8P: } public function mbmsg($openid, $mb, $mbid, $url = "", $fans, $orderid, $cfg = "", $valuedata = "") { goto hfQ8x; Ppj_4: $mb['remark'] = str_replace('#昵称#', $fans['nickname'], $mb['remark']); goto EftFl; Lhn6H: return $msg; goto d7fVp; yTQn5: $tp_value1 = str_replace('#订单号#', $orderid, $tp_value1); goto fHATi; Xs3lg: $tp_value1 = str_replace('#时间#', date('Y-m-d H:i:s', time()), $tp_value1); goto ET1n5; S6T4f: $tp_value1 = str_replace('#微信号#', $valuedata['weixin'], $tp_value1); goto TFIId; zgzOO: $tp_value1 = str_replace('#提现金额#', $valuedata['rmb'], $tp_value1); goto zE94e; S2JhR: $mb['first'] = str_replace('#订单号#', $orderid, $mb['first']); goto y0QJ_; EftFl: $mb['remark'] = str_replace('#订单号#', $orderid, $mb['remark']); goto iEckw; at4uj: $tp_color1 = unserialize($mb['zjcolor']); goto W6bja; hfQ8x: global $_W; goto F9TRK; YfdHj: $mb['first'] = str_replace('#昵称#', $fans['nickname'], $mb['first']); goto S2JhR; W6bja: $mb['first'] = str_replace('#时间#', date('Y-m-d H:i:s', time()), $mb['first']); goto YfdHj; F9TRK: $tp_value1 = unserialize($mb['zjvalue']); goto Xs3lg; fHATi: if (empty($valuedata)) { goto VLXsw; } goto zgzOO; Vchjj: YA8YV: goto vSRh1; qdG6I: VLXsw: goto at4uj; y0QJ_: $tplist1 = array("first" => array("value" => $mb['first'], "color" => $mb['firstcolor'])); goto pBHIS; iEckw: $tplist1['remark'] = array("value" => $mb['remark'], "color" => $mb['remarkcolor']); goto VO6cT; ET1n5: $tp_value1 = str_replace('#昵称#', $fans['nickname'], $tp_value1); goto yTQn5; TFIId: $tp_value1 = str_replace('#手机号#', $valuedata['tel'], $tp_value1); goto qdG6I; VO6cT: $msg = $this->sendMsg1($openid, $mbid, $tplist1, '', $url); goto Lhn6H; vSRh1: $mb['remark'] = str_replace('#时间#', date('Y-m-d H:i:s', time()), $mb['remark']); goto Ppj_4; pBHIS: foreach ($tp_value1 as $key => $value) { goto dPZTr; yPZSC: $tplist1['keyword' . $key] = array("value" => $value, "color" => $tp_color1[$key]); goto TfJ1p; vvKmK: goto HxjQX; goto IycjN; dPZTr: if (!empty($value)) { goto v2lQj; } goto vvKmK; IycjN: v2lQj: goto yPZSC; TfJ1p: HxjQX: goto UHilA; UHilA: } goto Vchjj; zE94e: $tp_value1 = str_replace('#提现账号#', $valuedata['txzhanghao'], $tp_value1); goto S6T4f; d7fVp: } function post_txhb($cfg, $openid, $dtotal_amount, $desc, $dmch_billno) { goto ZcA2U; gSkCA: $pars['min_value'] = $dtotal_amount; goto fyW50; zpWql: $dtotal = $dtotal_amount / 100; goto wzjDx; Q09D2: load()->model('mc'); goto nOZQ2; WDYYa: xc9hR: goto etRn2; S98eP: goto iAdGT; goto xtfkc; l2lyv: exit; goto Kbr7E; gLkep: $ret['message'] = $error; goto jHsqS; gMAZK: $ret['code'] = -3; goto lPdLW; VfPKh: if (strtolower($code) == 'success' && strtolower($result) == 'success') { goto HA5fp; } goto UGjk3; C0aiN: return $ret; goto JbrnK; W1TAf: return $ret; goto UGJul; s7ByD: $pars['total_num'] = 1; goto Rhj9o; c1XLa: $pars['send_name'] = $cfg['copyright']; goto gxdXY; CEtpU: $ret['code'] = -1; goto yQrXn; w1fd_: $pars['mch_billno'] = $dmch_billno; goto uOaRs; Tiv_L: $pars['act_name'] = '兑换红包'; goto dMuwB; PhzmM: O0SNp: goto w3T2G; RzZKh: vCvwG: goto EUgqD; LK4QZ: $extras['CURLOPT_SSLKEY'] = $root . 'apiclient_key.pem'; goto jLLNz; iUjHm: $ret['code'] = -1; goto G801b; Rhj9o: $pars['wishing'] = '提现红包成功!'; goto gRJd5; SceGE: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/sendredpack'; goto RPYQm; rlTGa: ksort($pars, SORT_STRING); goto jM5FF; nOZQ2: if (empty($desc)) { goto O0SNp; } goto osHML; uOaRs: $pars['mch_id'] = $cfg['mchid']; goto ecKwh; frjTB: return $ret; goto l2lyv; JbrnK: iAdGT: goto RzZKh; lPdLW: $ret['dissuccess'] = 0; goto jgVJ9; RPYQm: $pars = array(); goto AlNz9; dMuwB: $pars['remark'] = '来自' . $cfg['copyright'] . '的红包'; goto rlTGa; jCw79: mmHnU: goto XDXzh; mK1VM: $code = $xpath->evaluate('string(//xml/return_code)'); goto vsvOx; wzjDx: if (!($dtotal > $fans['credit2'])) { goto z4vNf; } goto CEtpU; EUgqD: goto vmKUQ; goto KvLEq; KvLEq: iq8u9: goto x2IpB; w9UKt: if (is_error($resp)) { goto iq8u9; } goto L7gT7; fniMa: return $ret; goto iyB2y; wLiWE: $pars['total_amount'] = $dtotal_amount; goto gSkCA; iyB2y: vmKUQ: goto zPSse; U1ITi: $ret = array(); goto peW3M; kDNZd: $dom = new DOMDocument(); goto aMNla; vsvOx: $result = $xpath->evaluate('string(//xml/result_code)'); goto VfPKh; x2IpB: $procResult = $resp['message']; goto iUjHm; aMNla: if ($dom->loadXML($xml)) { goto mmHnU; } goto gMAZK; zRBA3: $extras['CURLOPT_CAINFO'] = $root . 'rootca.pem'; goto wFRA1; XDXzh: $xpath = new DOMXPath($dom); goto mK1VM; jHsqS: return $ret; goto S98eP; wFRA1: $extras['CURLOPT_SSLCERT'] = $root . 'apiclient_cert.pem'; goto LK4QZ; cLID9: $string1 .= "key={$cfg['apikey']}"; goto thoWd; HzQ8s: $ret['message'] = 'success'; goto SceGE; ecKwh: $pars['wxappid'] = $cfg['appid']; goto vs8Cl; peW3M: $ret['code'] = 0; goto HzQ8s; xtfkc: HA5fp: goto fCbhl; G801b: $ret['dissuccess'] = 0; goto NBs9a; w3T2G: if (!empty($dmch_billno)) { goto xc9hR; } goto Pk_9P; jgVJ9: $ret['message'] = '3error3'; goto W1TAf; cNmvG: $procResult = null; goto Wkd3u; RtiUm: foreach ($pars as $k => $v) { $string1 .= "{$k}={$v}&"; v6UV4: } goto tqg7c; NBs9a: $ret['message'] = $procResult; goto fniMa; y6jO4: $extras = array(); goto zRBA3; GFd7t: $xml = array2xml($pars); goto y6jO4; vs8Cl: $pars['nick_name'] = $cfg['copyright']; goto c1XLa; jM5FF: $string1 = ''; goto RtiUm; yQrXn: $ret['dissuccess'] = 0; goto t4eGA; UGjk3: $error = $xpath->evaluate('string(//xml/err_code_des)'); goto Ly9Yk; Ly9Yk: $ret['code'] = -2; goto A8X2R; etRn2: $root = IA_ROOT . '/attachment/tiger_newhu/cert/' . $_W['uniacid'] . '/'; goto U1ITi; tqg7c: MyGKh: goto cLID9; osHML: $fans = mc_fetch($_W['openid']); goto zpWql; Wkd3u: $resp = ihttp_request($url, $xml, $extras); goto w9UKt; jLLNz: load()->func('communication'); goto cNmvG; A8X2R: $ret['dissuccess'] = 0; goto gLkep; vQDvG: $ret['dissuccess'] = 1; goto Qynr4; Pk_9P: $dmch_billno = random(10) . date('Ymd') . random(3); goto WDYYa; thoWd: $pars['sign'] = strtoupper(md5($string1)); goto GFd7t; L7gT7: $xml = '<?xml version="1.0" encoding="utf-8"?>' . $resp['content']; goto kDNZd; Kbr7E: z4vNf: goto PhzmM; fyW50: $pars['max_value'] = $dtotal_amount; goto s7ByD; ZcA2U: global $_W; goto Q09D2; gRJd5: $pars['client_ip'] = $cfg['client_ip']; goto Tiv_L; Qynr4: $ret['message'] = 'success'; goto C0aiN; gxdXY: $pars['re_openid'] = $openid; goto wLiWE; AlNz9: $pars['nonce_str'] = random(32); goto w1fd_; UGJul: goto vCvwG; goto jCw79; t4eGA: $ret['message'] = '余额不足'; goto frjTB; fCbhl: $ret['code'] = 0; goto vQDvG; zPSse: } public function post_qyfk($cfg, $openid, $amount, $desc, $dmch_billno) { goto Su85Q; n3_SS: hvUXl: goto wcf15; OdYJR: $extras = array(); goto zB59F; T7NQS: $ret['dissuccess'] = 1; goto a68yK; zB59F: $extras['CURLOPT_CAINFO'] = $root . 'rootca.pem'; goto Z_it6; ljgJV: ULjjf: goto GE0Tn; AvOic: return $ret; goto wvrmE; wcf15: $string1 .= "key={$cfg['apikey']}"; goto EWwrE; tttz3: return $ret; goto j6ldY; LArR0: $pars['nonce_str'] = random(32); goto c47bq; lkkLv: if (!($dtotal > $fans['credit2'])) { goto lqyqZ; } goto PuRsA; eodw0: $dmch_billno = random(10) . date('Ymd') . random(3); goto ljgJV; MbHaD: $ret['dissuccess'] = 0; goto Viv02; P90nV: $dtotal = $amount / 100; goto lkkLv; j2Qvi: return $ret; goto Z6l5t; eOFSz: $result = $xpath->evaluate('string(//xml/result_code)'); goto QDnQY; DBZI4: goto cx1Jy; goto O3EM1; nXgKC: $ret['code'] = -2; goto HxJT4; O3EM1: OXG3F: goto hB6R8; yIPG3: goto VDv7Z; goto yB2m3; LensO: $ret['amount'] = $amount; goto H4vOE; qAch4: ksort($pars, SORT_STRING); goto KDRkm; y0rcW: $pars['desc'] = '来自' . $_W['account']['name'] . '的提现'; goto r_XCB; FX78l: if (is_error($resp)) { goto OXG3F; } goto sfpKs; Z6C5K: $ret = array(); goto iBTDD; GHAvk: $extras['CURLOPT_SSLKEY'] = $root . 'apiclient_key.pem'; goto Ab3dD; QDnQY: if (strtolower($code) == 'success' && strtolower($result) == 'success') { goto aYZKc; } goto RUvQv; KDRkm: $string1 = ''; goto inSSX; c47bq: $pars['partner_trade_no'] = $dmch_billno; goto ivySy; v28hk: if (!empty($dmch_billno)) { goto ULjjf; } goto eodw0; uAiVP: $xpath = new DOMXPath($dom); goto mhMtz; EWwrE: $pars['sign'] = strtoupper(md5($string1)); goto uYIPH; iBTDD: $ret['code'] = 0; goto c3pTs; inSSX: foreach ($pars as $k => $v) { $string1 .= "{$k}={$v}&"; zV6i1: } goto n3_SS; hB6R8: $procResult = $resp['message']; goto y5Wa0; r_XCB: $pars['spbill_create_ip'] = $cfg['client_ip']; goto qAch4; LBq4R: if ($dom->loadXML($xml)) { goto LB_0B; } goto fdjv2; x2N0y: $resp = ihttp_request($url, $xml, $extras); goto FX78l; Z6l5t: exit; goto I_cn9; mhMtz: $code = $xpath->evaluate('string(//xml/return_code)'); goto eOFSz; Tdn6B: $ret['message'] = '-2:' . $error; goto Bj0QR; wvrmE: VDv7Z: goto EpXWa; j6ldY: goto H9MkI; goto mG1H7; sFldM: return $ret; goto RrVrY; PuRsA: $ret['code'] = -1; goto MbHaD; a68yK: $ret['message'] = 'success'; goto AvOic; l89e1: $ret['message'] = 'error response'; goto tttz3; iqjz1: $pars['check_name'] = 'NO_CHECK'; goto aOOEl; Ab3dD: load()->func('communication'); goto j6GHK; RrVrY: cx1Jy: goto a9avO; tLjGY: $pars = array(); goto vq4bQ; mZHr8: $pars['mchid'] = $cfg['mchid']; goto LArR0; fdjv2: $ret['code'] = -3; goto J1ugu; PmDMW: sPbkf: goto v28hk; yB2m3: aYZKc: goto BTCM2; H4vOE: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers'; goto tLjGY; EpXWa: H9MkI: goto DBZI4; B6Jm0: if (empty($desc)) { goto sPbkf; } goto nESRN; J1ugu: $ret['dissuccess'] = 0; goto l89e1; GE0Tn: $root = IA_ROOT . '/attachment/tiger_newhu/cert/' . $_W['uniacid'] . '/'; goto Z6C5K; aOOEl: $pars['amount'] = $amount; goto y0rcW; zWj33: $ret['dissuccess'] = 0; goto bp_BY; Viv02: $ret['message'] = '余额不足'; goto j2Qvi; sfpKs: $xml = '<?xml version="1.0" encoding="utf-8"?>' . $resp['content']; goto fsoDf; Z_it6: $extras['CURLOPT_SSLCERT'] = $root . 'apiclient_cert.pem'; goto GHAvk; mG1H7: LB_0B: goto uAiVP; BTCM2: $ret['code'] = 0; goto T7NQS; c3pTs: $ret['message'] = 'success'; goto LensO; RUvQv: $error = $xpath->evaluate('string(//xml/err_code_des)'); goto nXgKC; HxJT4: $ret['dissuccess'] = 0; goto Tdn6B; I_cn9: lqyqZ: goto PmDMW; VswNS: load()->model('mc'); goto B6Jm0; uYIPH: $xml = array2xml($pars); goto OdYJR; bp_BY: $ret['message'] = '-1:' . $procResult; goto sFldM; nESRN: $fans = mc_fetch($_W['openid']); goto P90nV; y5Wa0: $ret['code'] = -1; goto zWj33; Su85Q: global $_W; goto VswNS; vq4bQ: $pars['mch_appid'] = $cfg['appid']; goto mZHr8; fsoDf: $dom = new DOMDocument(); goto LBq4R; Bj0QR: return $ret; goto yIPG3; ivySy: $pars['openid'] = $openid; goto iqjz1; j6GHK: $procResult = null; goto x2N0y; a9avO: } public function getAccountLevel() { goto ZlxgL; bxinz: load()->classs('weixin.account'); goto MNMQf; MNMQf: $accObj = WeixinAccount::create($_W['uniacid']); goto besxB; gWPLq: return $account['level']; goto FuSDG; besxB: $account = $accObj->account; goto gWPLq; ZlxgL: global $_W; goto bxinz; FuSDG: } private function SendSMS($mobile, $content) { goto pFII0; HZd6t: if ($config['smstype'] == 'juhesj') { goto fDtkU; } goto iD4oN; pQhQK: goto oySBi; goto vmsG5; fEsoA: return 0; goto C_2jU; VjADA: file_put_contents(IA_ROOT . '/addons/tiger_newhu/log.txt', '
 old:' . json_encode($resp), FILE_APPEND); goto mGL3i; ji5S9: return '短信参数配置不正确，请联系管理员'; goto tSMQ2; OLD4_: if ($result['error_code'] == 0) { goto uvSoW; } goto AetE5; iD4oN: if (empty($config['dyAppKey']) || empty($config['dyAppSecret']) || empty($config['dysms_free_sign_name']) || empty($config['dysms_template_code'])) { goto iv1kr; } goto q430L; D14v8: WSHuQ: goto sTIsI; JWllI: Y3DlQ: goto fEsoA; ECoh3: return $resp->sub_msg; goto Hzp7F; XrjJ0: $json = ihttp_get("http://v.juhe.cn/sms/send?mobile={$mobile}&tpl_id={$jhcode}&tpl_value={$content}&key={$jhappkey}"); goto wbXk1; mGL3i: if ($resp->result->err_code == 0) { goto Y3DlQ; } goto ECoh3; tSMQ2: xjuP1: goto LYK_D; UwiZv: $req->setRecNum($mobile); goto Jy7zB; Zd_82: uvSoW: goto ADrx1; NuioR: fDtkU: goto itJ40; pFII0: $config = $this->module['config']; goto YuOBC; bDFAz: $c->secretKey = $config['dyAppSecret']; goto VSsL0; uwZC0: $resp = $c->execute($req); goto VjADA; sbkqs: W4yR5: goto uANHj; YuOBC: load()->func('communication'); goto HZd6t; IUbfA: $req->setSmsParam($content); goto UwiZv; RV0EG: $content = '接口调用错误.'; goto pQhQK; JIuX4: iv1kr: goto ji5S9; AetE5: $content = $result['error_code'] . $result['reason']; goto uDFHA; Cf4O7: goto xjuP1; goto JIuX4; qx1eX: return $content; goto D14v8; LYK_D: goto WSHuQ; goto NuioR; C_2jU: Pt_2H: goto Cf4O7; pHUQd: if ($json['code'] == 200) { goto bv6IF; } goto RV0EG; aoqNc: $c = new TopClient(); goto xPeRP; uDFHA: goto W4yR5; goto Zd_82; Jy7zB: $req->setSmsTemplateCode($config['dysms_template_code']); goto uwZC0; hGjus: $req->setSmsType('normal'); goto ddxqH; xPeRP: $c->appkey = $config['dyAppKey']; goto bDFAz; wbXk1: $result = @json_decode($json['content'], true); goto pHUQd; ADrx1: $content = 0; goto sbkqs; Hzp7F: goto Pt_2H; goto JWllI; itJ40: $jhappkey = $config['jhappkey']; goto nuY9j; ddxqH: $req->setSmsFreeSignName($config['dysms_free_sign_name']); goto IUbfA; VSsL0: $req = new AlibabaAliqinFcSmsNumSendRequest(); goto hGjus; nuY9j: $jhcode = $config['jhcode']; goto XrjJ0; uANHj: oySBi: goto qx1eX; vmsG5: bv6IF: goto OLD4_; q430L: include IA_ROOT . '/addons/tiger_newhu/inc/sdk/dayu/TopSdk.php'; goto aoqNc; sTIsI: } public function doMobileDuibaxf() { goto t2wXl; Sydee: $yue = intval($share['credit1']) - $request_array['credits']; goto nbO4D; Y3IkD: if (is_array($ret)) { goto bm9jt; } goto gtF0m; pGShD: DQVhN: goto QbgXv; QbgXv: $updatecredit = $this->mc_jl($uid, 0, 9, -abs($request_array['credits']), '兑吧兑换' . $request_array['description'], ''); goto WpOor; WpOor: if ($updatecredit['error'] == 1) { goto N4NCn; } goto DizRM; Nf9Ww: foreach ($request_array as $key => $val) { goto mkkwR; IYCy7: unset($request_array[$key]); goto eSD46; kmd_c: if (!(in_array($key, $unsetkeyarr) || strstr($key, '__'))) { goto GnRXE; } goto IYCy7; eZakr: drWlv: goto E3Bdd; eSD46: GnRXE: goto eZakr; mkkwR: $unsetkeyarr = array("i", "do", "m", "c", "module_status:1", "module_status:tiger_shouquan", "module_status:tiger_newhu", "notice", "state"); goto kmd_c; E3Bdd: } goto Ey1_o; QH_0J: G1ClN: goto E7f0I; duzEt: exit(json_encode(array("status" => "fail", "errorMessage" => "系统错误，请重试！", "credits" => $request_array['credits']))); goto O40AQ; bdy8X: exit(json_encode(array("status" => "ok", "errorMessage" => "", "bizId" => $insert['bizId'], "credits" => $yue))); goto QH_0J; t2wXl: global $_W, $_GPC; goto LKFwJ; KknHK: file_put_contents(IA_ROOT . '/addons/tiger_newhu/inc/mobile/log.txt', '
 old:' . json_encode($request_array), FILE_APPEND); goto pHO0d; LKFwJ: include 'duiba.php'; goto XQum0; QjzAj: $insert = array("uniacid" => $_W['uniacid'], "uid" => $uid, "bizId" => date('YmdHi') . random(8, 1), "orderNum" => $request_array['orderNum'], "credits" => $request_array['credits'], "params" => $request_array['params'], "type" => $request_array['type'], "ip" => $request_array['ip'], "starttimestamp" => $request_array['timestamp'], "waitAudit" => $request_array['waitAudit'], "actualPrice" => $request_array['actualPrice'], "description" => $request_array['description'], "facePrice" => $request_array['facePrice'], "Audituser" => $request_array['Audituser'], "itemCode" => $request_array['itemCode'], "status" => 0, "createtime" => time()); goto KBwUd; iUc8u: bm9jt: goto QjzAj; O40AQ: goto cknTe; goto R_VGa; nbO4D: if ($yue > 0) { goto DQVhN; } goto oew20; ZjPlE: $uid = $request_array['uid']; goto Nf9Ww; KQmVC: goto pplFZ; goto iUc8u; s6yec: if (pdo_insertid()) { goto ZIVN9; } goto duzEt; KBwUd: pdo_insert($this->modulename . '_dborder', $insert); goto s6yec; K036z: $settings = $this->module['config']; goto alVa6; gKpsC: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$uid}'"); goto Sydee; XQum0: $cfg = $this->module['config']; goto K036z; Ey1_o: FG36F: goto KknHK; oNgr1: goto G1ClN; goto xUUMf; T0XQG: cknTe: goto IFj5_; E7f0I: C44_2: goto T0XQG; alVa6: $request_array = $_GPC; goto ZjPlE; DizRM: exit(json_encode(array("status" => "fail", "errorMessage" => "扣除{$cfg['hztype']}错误", "credits" => $request_array['credits']))); goto oNgr1; Wp1ZA: goto C44_2; goto pGShD; xUUMf: N4NCn: goto bdy8X; R_VGa: ZIVN9: goto gKpsC; gtF0m: exit(json_encode(array("status" => "fail", "errorMessage" => $ret, "credits" => $request_array['credits']))); goto KQmVC; pHO0d: $ret = parseCreditConsume($settings['AppKey'], $settings['appSecret'], $request_array); goto Y3IkD; oew20: exit(json_encode(array("status" => "fail", "errorMessage" => "积分不足", "credits" => $request_array['credits']))); goto Wp1ZA; IFj5_: pplFZ: goto EbO2E; EbO2E: } public function postgoods($goods, $openid) { goto jmlL1; jqJyF: return $status; goto y4h2N; EoI5O: $status = $account->sendCustomNotice($message); goto jqJyF; Vh4vq: $message = array("touser" => trim($openid), "msgtype" => "news", "news" => array("articles" => $response)); goto BEBXD; OZYu3: if (!empty($acid)) { goto vKJMf; } goto Q6toO; MkYRY: vKJMf: goto RVTqT; RVTqT: include IA_ROOT . '/addons/tiger_newhu/wxtoken.php'; goto EoI5O; Wwo2I: kjfkn: goto Vh4vq; Q6toO: $acid = $_W['uniacid']; goto MkYRY; zj2XQ: foreach ($goods as $key => $value) { goto atmHL; t1KpW: $response[] = array("title" => urlencode('【券后价:' . $value['itemendprice'] . '】' . $value['itemtitle']), "description" => urlencode($value['itemtitle']), "picurl" => tomedia($value['itemtitle'] . '_100x100.jpg'), "url" => $viewurl); goto SBgLq; atmHL: $viewurl = $_W['siteroot'] . str_replace('./', 'app/', $this->createMobileurl('view', array("itemid" => $value['itemid']))); goto t1KpW; SBgLq: xwooC: goto UcVj1; UcVj1: } goto Wwo2I; jmlL1: global $_W; goto zj2XQ; BEBXD: $acid = $_W['acid']; goto OZYu3; y4h2N: } } ?>