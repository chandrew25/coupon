<?php
 defined('IN_IA') or exit('Access Denied'); class Tuike_pddModuleSite extends WeModuleSite { public $cfg; public function __construct() { goto tohx0; x1fh5: $s = pdo_fetch('select settings from ' . tablename('uni_account_modules') . " where module='tiger_newhu' and uniacid='{$weid}'"); goto BSkEL; nB50b: $weid = $_W['uniacid']; goto x1fh5; tohx0: global $_W, $_GPC; goto nB50b; BSkEL: $this->cfg = unserialize($s['settings']); goto QvWUb; QvWUb: } public function doWebIndex() { goto CISC5; CISC5: global $_W, $_GPC; goto wJILR; wJILR: echo 11; goto n_R6o; n_R6o: include $this->template('index'); goto VWe5i; VWe5i: } public function pddgoodslist($owner_name, $page, $keyword, $category_id, $sort_type, $with_coupon, $hd) { goto w5KRt; CT9g_: $owner_name = $pddset['ddjbbuid']; goto LOT7I; csSoU: $page = 1; goto s8JSU; Zx9gf: $arr['range_list'] = '[{"range_id":3,"range_from":5000,"range_to":""}]'; goto eswIR; hLapr: JBJK8: goto wBtD4; pVf2c: if (empty($keyword)) { goto JBJK8; } goto WwKfS; e9pmc: $arr['range_list'] = '[{"range_id":1,"range_from":2000,"range_to":"3000"}]'; goto u0Mku; Jd2uZ: zE62C: goto U9BGL; gB3Zn: HGfvk: goto xYvjj; iM94d: goto wGi0F; goto cdfvO; xYvjj: $hd = $_GPC['hd']; goto b5BKU; ySslq: $with_coupon = 'false'; goto I1c3w; wEPuV: if ($hd == 5) { goto AUku0; } goto JVLtt; eswIR: goto wGi0F; goto zvIUP; JVLtt: goto wGi0F; goto lTu1e; WwKfS: $arr['keyword'] = $keyword; goto hLapr; U9BGL: $with_coupon = $_GPC['with_coupon']; goto DUVaO; AJOcY: $arr['range_list'] = '[{"range_id":1,"range_from":800,"range_to":990}]'; goto iM94d; u0Mku: goto wGi0F; goto MbDJE; wBtD4: if (empty($category_id)) { goto HGfvk; } goto WlhS_; LOT7I: if (!empty($page)) { goto dyyjC; } goto csSoU; s8JSU: dyyjC: goto SUrmB; jrfdY: $goodslist = $this->createres($arr, 'pdd.ddk.goods.search', $owner_name); goto nu2Ta; YtoYz: wGi0F: goto jrfdY; f0cGg: $arr = array("page" => $page, "page_size" => "20", "sort_type" => $sort_type, "with_coupon" => $with_coupon); goto pVf2c; v3XA7: AUku0: goto v4071; SUrmB: if (!empty($sort_type)) { goto zE62C; } goto pRjps; tYrFr: goto wGi0F; goto v3XA7; v4071: $arr['range_list'] = '[{"range_id":1,"range_from":1,"range_to":660}]'; goto YtoYz; w5KRt: global $_W, $_GPC; goto RNddc; vkS7I: if ($hd == 3) { goto uE6BZ; } goto UUAxj; b5BKU: if ($hd == 1) { goto vHhwa; } goto IRbl3; DUVaO: if (!empty($with_coupon)) { goto NTkmm; } goto ySslq; zvIUP: m6NEG: goto OWAsw; UUAxj: if ($hd == 4) { goto m6NEG; } goto wEPuV; MbDJE: uE6BZ: goto Zx9gf; cdfvO: J3wSV: goto e9pmc; WlhS_: $arr['category_id'] = $category_id; goto gB3Zn; IRbl3: if ($hd == 2) { goto J3wSV; } goto vkS7I; pRjps: $sort_type = 0; goto Jd2uZ; I1c3w: NTkmm: goto f0cGg; RNddc: $pddset = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_set') . " WHERE  weid='{$_W['uniacid']}'"); goto CT9g_; nu2Ta: return $goodslist; goto pT9HZ; lTu1e: vHhwa: goto AJOcY; OWAsw: $arr['range_list'] = '[{"range_id":5,"range_from":2000,"range_to":""}]'; goto tYrFr; pT9HZ: } public function baokuan($sort_type, $sum) { goto KfF8f; sgGwU: $arr = array("has_coupon" => "true", "sort_type" => $sort_type, "limit" => $sum); goto T_zFi; KfF8f: global $_W, $_GPC; goto S2qGq; S2qGq: $pddset = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_set') . " WHERE  weid='{$_W['uniacid']}'"); goto iGHPB; T_zFi: $view = $this->createres($arr, 'pdd.ddk.oauth.top.goods.list.query', $owner_name); goto MSDDo; iGHPB: $owner_name = $pddset['ddjbbuid']; goto sgGwU; MSDDo: return $view; goto u0iWZ; u0iWZ: } public function createres($data, $type, $owner_name) { goto ElLe3; p2tIe: tHXeI: goto s8emH; dVtW2: $data['timestamp'] = $time; goto cRlKs; s8emH: $time = $this->getMillisecond(); goto LB6Y2; ZOQf9: $data = json_decode($res, 1); goto wHMMX; gZ4z1: $this->res_token($owner_name); goto p2tIe; blIV4: $data['client_id'] = '5cc019bb630a4210b15bfd0c26c70b44'; goto sL2YO; sL2YO: $data['type'] = $type; goto dVtW2; oTOJB: $res = $this->pdd_request($url, $data); goto ZOQf9; mCsuv: $data['sign'] = $sign; goto E0Ca2; cRlKs: $sign = $this->pddsign($data); goto mCsuv; ElLe3: global $_W; goto M48ZB; wtZ42: if (!($pddsign['endtime'] - time() < 3600)) { goto tHXeI; } goto gZ4z1; M48ZB: $pddsign = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_pddsign') . " WHERE  weid='{$_W['uniacid']}'"); goto wtZ42; LB6Y2: $data['access_token'] = $pddsign['access_token']; goto blIV4; E0Ca2: $url = 'http://gw-api.pinduoduo.com/api/router'; goto oTOJB; wHMMX: return $data; goto iibtz; iibtz: } public function getMillisecond() { goto xXQPC; wGZHw: $t = $time . $ran; goto rns_w; xXQPC: $time = time(); goto glV76; glV76: $ran = rand(100, 300); goto wGZHw; rns_w: return $t; goto myI6p; myI6p: } public function pdd_request($url, $data = "") { goto EhSFV; xT1C9: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto lKjW0; b4EUJ: ToxW6: goto a20fm; EhSFV: $headers = array("Content-Type: application/json"); goto awNiN; CTr2O: 　　curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0); goto pH5jj; lKjW0: $rtn = curl_exec($ch); goto mFSIa; UzGYf: curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data)); goto b4EUJ; awNiN: $ch = curl_init($url); goto EPS10; R5SO8: curl_setopt($ch, CURLOPT_POST, TRUE); goto UzGYf; KeOFS: if (!(0 === strpos(strtolower($url), 'https'))) { goto Cucsf; } goto CTr2O; a20fm: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto xT1C9; mFSIa: curl_close($ch); goto aDin4; pH5jj: 　　curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0); goto ztQxm; aDin4: return $rtn; goto WkuRQ; EPS10: curl_setopt($ch, CURLOPT_TIMEOUT, 60); goto KeOFS; XgQF7: if (!$data) { goto ToxW6; } goto R5SO8; ztQxm: Cucsf: goto XgQF7; WkuRQ: } public function pddsign($array) { goto CO946; CO946: ksort($array); goto nbfFM; Cs3eK: goto x51w0; goto E3pCY; nbfFM: $string = ''; goto w60Zh; bLOgy: $string = $string . $key . $val; goto Cs3eK; E3pCY: ma0OI: goto UH1gv; AYiXq: $md5str = MD5($string); goto mUunO; UH1gv: $string = '7f421c1ab7021045806ef07b4f505d6caf049313' . trim($string) . '7f421c1ab7021045806ef07b4f505d6caf049313'; goto AYiXq; mUunO: return strtoupper($md5str); goto ep5yi; w60Zh: x51w0: goto r_3SK; r_3SK: if (!(list($key, $val) = each($array))) { goto ma0OI; } goto bLOgy; ep5yi: } public function res_token($owner_name) { goto c8rEC; MYAbI: $data = array("client_id" => "5cc019bb630a4210b15bfd0c26c70b44", "client_secret" => "7f421c1ab7021045806ef07b4f505d6caf049313", "grant_type" => "refresh_token", "refresh_token" => $pddsign['refresh_token']); goto inFqe; iu1IF: $res = pdo_update($this->modulename . '_pddsign', $indata, array("owner_id" => $fhdaa['owner_id'])); goto kjmSi; P1AjU: $fhdaa = json_decode($res, 1); goto TUIiE; inFqe: $url = 'http://open-api.pinduoduo.com/oauth/token'; goto rpdXK; TUIiE: $indata = array("weid" => 2, "access_token" => $fhdaa['access_token'], "expires_in" => $fhdaa['expires_in'], "refresh_token" => $fhdaa['refresh_token'], "owner_id" => $fhdaa['owner_id'], "owner_name" => $fhdaa['owner_name'], "endtime" => time() + $fhdaa['expires_in'], "createtime" => time()); goto iu1IF; rpdXK: $res = $this->pdd_request($url, $data); goto P1AjU; c8rEC: $pddsign = pdo_fetch('SELECT * FROM ' . tablename($this->modulename . '_pddsign') . " WHERE weid='{$_W['uniacid']}'"); goto MYAbI; kjmSi: } public function Text_qzj($Text, $Front, $behind) { goto hsciy; YpGpF: $t1 = $t1 - 1 + strlen($Front); goto D4YAo; t5rZK: $t2 = mb_strpos($temp, $behind); goto WnVt8; eXpGP: return mb_substr($temp, 0, $t2); goto B6LOX; abkY_: say9v: goto z_PBr; hsciy: $t1 = mb_strpos('.' . $Text, $Front); goto dybwz; P5Ewj: return ''; goto abkY_; j42Ew: c_cdm: goto P5Ewj; z_PBr: $temp = mb_substr($Text, $t1, strlen($Text) - $t1); goto t5rZK; dybwz: if ($t1 == FALSE) { goto c_cdm; } goto YpGpF; TkrHl: R2LrR: goto eXpGP; WnVt8: if (!($t2 == FALSE)) { goto R2LrR; } goto Rp3Zz; Rp3Zz: return ''; goto TkrHl; D4YAo: goto say9v; goto j42Ew; B6LOX: } public function ptyjjl($endprice, $tkrate, $cfg) { goto vKhlO; ozd4B: vnk09: goto ytPy1; MgAqP: if (!empty($yongj)) { goto i7j4H; } goto K2qnx; Xfomy: gVyQ9: goto hYrjb; K2qnx: $yongj = '0.00'; goto wDEKP; ICAY4: goto Ehba9; goto ozd4B; k_a7B: if ($cfg['fxtype'] == 2) { goto vnk09; } goto ayIKG; wDEKP: i7j4H: goto PIYOY; D7t3f: $yongj = $yj * $cfg['zgf'] / 100; goto MgAqP; vKhlO: global $_W; goto EwSPm; EwSPm: $yj = $endprice * $tkrate / 100; goto D7t3f; ayIKG: goto Ehba9; goto Xfomy; oiFMI: return $yj1; goto TmPIg; PIYOY: if ($cfg['fxtype'] == 1) { goto gVyQ9; } goto k_a7B; sVBVi: $yj1 = intval($yj1); goto ICAY4; ytPy1: $yj1 = number_format($yongj, 2); goto iDKRH; iDKRH: Ehba9: goto oiFMI; hYrjb: $yj1 = $yongj * $cfg['jfbl']; goto sVBVi; TmPIg: } public function sharejl($endprice, $tkrate, $bl, $share, $cfg) { goto D6CVU; yeypk: goto oiFWT; goto GlM30; Waker: $yj = $this->ptyjjl($endprice, $tkrate, $cfg); goto yeypk; AvDfU: return $yj; goto bmoAo; hvb_M: $yj = $this->dljiangli($endprice, $tkrate, $bl, $share); goto H45hH; GlM30: Y2L0G: goto hvb_M; H45hH: oiFWT: goto AvDfU; D6CVU: if ($share['dltype'] == 1) { goto Y2L0G; } goto Waker; bmoAo: } public function dljiangli($endprice, $tkrate, $bl, $share) { goto h9F8Y; AQEwz: $dlrate = number_format($jrzyj, 2); goto MYwvJ; jquTd: $yj = number_format($dlyj * $dlbl / 100, 2); goto t761k; trByE: if (empty($sjshare['helpid'])) { goto mJmJ7; } goto xgMds; hUKRo: if ($bl['fxtype'] == 1) { goto BFV0V; } goto jquTd; WmxYS: goto oCpjy; goto FkI5c; GK8Dv: mJmJ7: goto sSINR; MYwvJ: goto aZswS; goto SD7lh; BKmRB: if ($bl['dltype'] == 3) { goto dVz32; } goto i57be; CGOUZ: S7Z85: goto ezazl; UjeQO: $dlyj = $dlyj * (100 - $bl['dlkcbl']) / 100; goto zN97y; zN97y: iIdZf: goto YNSRJ; MskPz: return $dlrate; goto L_wTp; IeAS7: $dlyj = $endprice * $tkrate / 100; goto lmgpq; j2K3C: oCpjy: goto c5tQT; sW5hP: iolJf: goto oKTAR; oKTAR: $jryj = 0; goto caoVk; Gfl2V: $jryj = $yj * $bl['dlbl2t3'] / 100; goto trByE; ezazl: goto bGUuo; goto sW5hP; bsANk: if (empty($share['helpid'])) { goto iolJf; } goto j_BeQ; tumQr: if (empty($share['dlbl'])) { goto ug0Th; } goto wPAoE; KMP5e: if (empty($share['helpid'])) { goto A1lUr; } goto R8kkx; h9F8Y: global $_W; goto IeAS7; Xpc6h: ug0Th: goto FBS8u; xgMds: $jrsjyj = $yj * $bl['dlbl1t3'] / 100; goto dT6_R; R8kkx: $jryj = $yj * $bl['dlbl1t2'] / 100; goto WmxYS; t6IXb: RuOFF: goto hUKRo; caoVk: bGUuo: goto oZM8k; dT6_R: goto S7Z85; goto GK8Dv; j_BeQ: $sjshare = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$share['weid']}'and dltype=1 and id='{$share['helpid']}'"); goto Gfl2V; wPAoE: $dlbl = $fs['bl']; goto RXSYW; sSINR: $jrsjyj = 0; goto CGOUZ; KdUd0: aZswS: goto MskPz; RXSYW: goto RuOFF; goto Xpc6h; mIAU9: dVz32: goto bsANk; Qzwn7: $jryj = 0; goto j2K3C; FBS8u: $dlbl = $bl['dlbl1']; goto t6IXb; lmgpq: if (empty($bl['dlkcbl'])) { goto iIdZf; } goto UjeQO; oZM8k: S0XPa: goto FxEP_; c5tQT: goto S0XPa; goto mIAU9; FxEP_: $jrzyj = $yj - $jryj - $jrsjyj; goto v5y2T; YNSRJ: $fs = $this->jcbl($share, $bl); goto tumQr; SD7lh: BFV0V: goto anTzB; i57be: goto S0XPa; goto uYzw8; FkI5c: A1lUr: goto Qzwn7; v5y2T: file_put_contents(IA_ROOT . '/addons/tiger_tkxcx/yj_log.txt', '
' . 'uid:' . $share['id'] . '------' . $yj . '-' . $jryj . '-' . $jrsjyj . '=' . $jrzyj, FILE_APPEND); goto AQEwz; t761k: if ($bl['dltype'] == 2) { goto tt5Vt; } goto BKmRB; uYzw8: tt5Vt: goto KMP5e; anTzB: $dlrate = number_format($dlyj * $dlbl / 100, 2); goto KdUd0; L_wTp: } public function islogin() { goto HXgzl; aCU2k: return $fans; goto XsvWb; aIozE: $share = pdo_fetch('select * from ' . tablename('tiger_newhu_share') . " where weid='{$_W['uniacid']}' and id='{$_SESSION['tkuid']}'"); goto cBvlm; FAryy: $fans['openid'] = $_SESSION['openid']; goto aIozE; hrUhc: $mc = mc_fetch($fans['openid']); goto uIWB0; uIWB0: $fans = array("id" => $_SESSION['tkuid'], "tkuid" => $_SESSION['tkuid'], "wquid" => $mc['uid'], "credit1" => $share['credit1'], "credit2" => $share['credit2'], "nickname" => $share['nickname'], "avatar" => $share['avatar'], "helpid" => $share['helpid'], "dlptpid" => $share['dlptpid'], "unionid" => $share['unionid'], "from_user" => $share['from_user'], "openid" => $share['from_user'], "createtime" => $share['createtime'], "tgwid" => $share['tgwid'], "cqtype" => $share['cqtype'], "dltype" => $share['dltype'], "status" => $share['status']); goto aCU2k; cBvlm: P7gfb: goto hrUhc; HXgzl: global $_W; goto PRWs0; PRWs0: if (empty($_SESSION['openid'])) { goto P7gfb; } goto FAryy; XsvWb: } } ?>