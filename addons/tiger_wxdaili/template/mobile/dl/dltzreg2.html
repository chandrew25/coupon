<!doctype html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
<title>会员充值</title>

<link rel="stylesheet" type="text/css" href="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/css/amazeui.min.css"/>
<link rel="stylesheet" type="text/css" href="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/css/publicstyle.css"/>

<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/js/jquery.min.js"></script>
<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/js/amazeui.min.js"></script>

</head>

<style>


@media screen and (min-width: 640px) {
    .fq-promotion,.fq-camera,.am-gotop-fixed{
        max-width: 640px;
        margin-left: calc((100% - 640px) / 2);
        margin-right: calc((100% - 640px) / 2);
    }

    .fq-grandeur-menu{
      max-width: 640px;
    }
}
</style>

<body>

<div class="am-modal am-modal-alert" tabindex="-1" id="fq_alert">
  <div class="am-modal-dialog">
    <div class="am-modal-hd" id="fq_alert_title"></div>
    <div class="am-modal-bd" id="fq_alert_info">
    </div>
    <div class="am-modal-footer">
      <span class="am-modal-btn">确定</span>
    </div>
  </div>
</div>

<div class="am-modal am-modal-confirm" tabindex="-1" id="fq_confirm">
  <div class="am-modal-dialog">
    <div class="am-modal-hd" id="fq_confirm_title"></div>
    <div class="am-modal-bd" id="fq_confirm_info"></div>
    <div class="am-modal-footer">
      <span class="am-modal-btn" data-am-modal-confirm>确定</span>
    </div>
  </div>
</div>
  
<link rel="stylesheet" href="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/icon_font/iconfont.css">
<style>
    body{margin:auto;max-width:640px;background:#f6f7fb}
img{width:100%}
header{position:relative}
header div{position:absolute;top:0;width:100%}

.fq-apply-message .am-input-group{display:flex;align-items:center}
.fq-apply-message i{display:flex;width:30px;color:#C9B174;font-size:24px;justify-content:center}
.fq-apply-message .am-input-group input{border:none;color:#333}
.fq-apply-message textarea{width:100%;border:none;background:#F4F4F4}
input[type=text]::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#B7B7B7}
.fq-apply-button{width:50%;border:none;background:#C9B174;box-shadow:0 6px 6px rgba(199,167,85,.22)}

</style>

<div class="am-modal am-modal-confirm" tabindex="-1" id="fq_true_confirm">
    <div class="am-modal-dialog">
        <div class="am-modal-hd"></div>
        <div class="am-modal-bd" id="fq_true_confirm_info"></div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
        </div>
    </div>
</div>

<header style="height: 45px;line-height: 45px;background: #fff;border-bottom: 1px solid #f5f0ec;">
        <a href="javascript:void(0);" onclick="back();" style="color:#555555;width:45px;height:100%;padding-left:10px;font-size:25px;margin-bottom: 5px;"
            class="am-inline-block am-text-middle am-icon-angle-left"></a>
        <div class="am-per-center am-text-center" style="color:#555555;font-size:16px;">会员充值</div>
</header>
<input type="hidden" name="orderno" id="orderno">
<input type="hidden" name="orderid" id="orderid">
<div class="fq-apply-message fq-background-white ">
	<div class="am-input-group am-center am-padding-bottom am-padding " style="line-height: 25px; height: 25px;">
        	{$_W['account']['name']}
    </div>
    
	<div class="am-input-group am-center am-padding-bottom am-padding " style=" border-bottom:10px solid #f6f7fb;">
		<div style="width: 100%;border: 1px #c6a54d solid;background: #fefaef;padding: 20px;">
			<img src="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/images/icon_pay_sub.png" style=" display: inline-block; width: 25px;height: 25px;margin-right: 10px;" id="sub"> <span id="day">30</span>天会员权益服务费 <img src="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/images/icon_pay_add.png" style="display:inline-block;height:25px; width: 25px;margin-left: 10px;" id="add">
			<div style="float: right; color: #ff0000;" >¥<span id="rmb1">{$appset['rmb']}</span>元</div>
		</div>
		
	</div>
	
    <div class="am-input-group am-center am-padding-bottom am-padding " style=" border-bottom: 1px solid #f5f0ec;margin-top: 8px;">
        <div style="float: left;width:50%;display: inline-block;">开通会员</div>
        <div style="float: right;width:50%;text-align:right;display: inline-block;font-weight: bold;">VIP</div>
    </div>
    <div class="am-input-group am-center am-padding-bottom am-padding " style=" border-bottom: 1px solid #f5f0ec;">
        <div style="float: left;width:50%;display: inline-block;">付款金额</div>
        <div style="float: right;width:50%;text-align:right;display: inline-block;font-weight: bold;" >¥<span id="rmb2">{$appset['rmb']}</span>元</div>
    </div>
    <div class="am-input-group am-center am-padding-bottom am-padding " style=" background: #f6f7fb;line-height: 25px; height: 25px;font-size: 14px;">
        	支付方式
    </div>
    
	<div class="am-input-group am-center am-padding-bottom am-padding " style=" border-bottom: 1px solid #f5f0ec;">
		<div><img src="{$_W['siteroot']}addons/tiger_wxdaili/template/mobile/public/images/wx.png" style=" display: inline-block;
    width: 30px;
    height: 30px;
"> 微信支付</div>
	</div>

</div>

<button  class="fq-apply-button am-text-center am-center am-round am-margin-vertical-xl am-padding-vertical-sm" id="js_submit2" style="width: 96%;">确认支付</button>

<div class="am-hide"></div>
<div class="am-hide"></div>	

</body>
</html>

<div class="am-modal am-modal-confirm" tabindex="-1" id="fq_confirm_msg">
    <div class="am-modal-dialog">
        <div class="am-modal-hd"></div>
        <div class="am-modal-bd" id="fq_confirm_msg_info"></div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" id="qdbotn" data-am-modal-confirm>确定</span>
        </div>
    </div>
</div>
{php echo register_jssdk(false);}
<script>
    function back() {
        window.history.back();
    }

    function fq_alert(info) {
        $('#fq_alert_info').html(info);
        $('#fq_alert').modal();
    }
    
    
    $(function() {	
	    $("#sub").click(function(){
	    	  var rmb=parseFloat("{$appset['rmb']}");
	          var rmb1=parseFloat($("#rmb1").html());
	          var day=parseFloat($("#day").html());
	          if(rmb>=rmb1){
	          	rmb3=rmb;
	          	day3=30;
	          }else{
	          	rmb3=rmb1-rmb;
	          	day3=day-30;
	          }
	          $("#rmb1").html(rmb3);
	          $("#rmb2").html(rmb3);
	          $("#day").html(day3);
	    });
	    $("#add").click(function(){
	    	  var rmb=parseFloat("{$appset['rmb']}");
	          var rmb1=parseFloat($("#rmb1").html());
	          var day=parseFloat($("#day").html());
	          rmb3=rmb1+rmb;
	          day3=day+30;
	          $("#rmb1").html(rmb3);
	          $("#rmb2").html(rmb3);
	          $("#day").html(day3);
	    });
	    
	    
	    //代理付费
				$("#js_submit2").click(function(){
					    var id = "{$member['id']}";
						var rmb1=parseFloat($("#rmb1").html());
						var fss="{$appset['fsm']}";//粉丝数
						var dlfs="{$dlfs}";//现有粉丝
						var mdd="{$appset['ordermsum']}";
						var day3=$("#day").html();
						var dlorder="{$dlorder}";
						if(fss>dlfs){
							fq_alert('粉丝数未达到，暂不能申请！');
							return;
						}
						if(mdd>dlorder){
							fq_alert('订单数未达到，暂不能申请！');
							return;
						}


						// var wechatid = $.trim($('#js_wechatid').val());//微信ID
						$('#js_submit2').html('团长支付申请提交中 <i class="am-icon-spinner am-icon-spin"></i>').attr('disabled',true);
						$.ajax({
									url:'{php echo $this->createMobileUrl("dlgetpay");}',
									type:'post',
									dataType:'json',
									data:{"uid":id,"rmb":rmb1,"day3":day3},
									//data:{"tel":'13888888888',"dlmsg":'introduc',"pcpasswords":'password',"uid":id,"smscode":'smscode',"weixin":'wechatid',"tname":'name'},
									success:function(res){
											var json =res;
											//alert(JSON.stringify(res));
											if(json.errcode == 0){
															$("#orderno").val(json.orderno);
															$("#orderid").val(json.orderid);
															//alert(json.orderno);
															//alert(json.orderid);
															wx.chooseWXPay({
																		timestamp: json.timeStamp, 
																		nonceStr: json.nonceStr, 
																		package: json.package, 
																		signType: json.signType, 
																		paySign: json.paySign,
																		success: function (res) {
																				//alertFun(json.package);
																				// 支付成功后的回调函数
																				//var str = JSON.stringify(res);
																				//alert("支付成功")
																				checkorder();
																		}
																});				       						  
											}else{	 
												fq_alert(json.errmsg);
												return;
											}
									}
							});
						
				
				        
				});
							
							function checkorder(){
							          //alert(232323);
				    			var orderno =  $("#orderno").val();
				    			var orderid =  $("#orderid").val();
				    			if(orderno.length == 0){
										fq_alert('订单号为空');
										//alert("订单号为空");
										return;
				    			}
									//alert(phone1);
				    		   	$.ajax({
											type:'post',
											dataType:'json',
											data:{"orderno":orderno,"orderid":orderid},
											url:'{php echo $this->createMobileUrl("dlpayresult");}',
											success:function(data){
				    					  var json = data;
												//alert(JSON.stringify(json));
				    					  if(json.errcode == 0){
													  
											  $('#js_submit2').html('支付成功！').attr('disabled',true);
											  setTimeout(function(){
					                            	window.location.href = '{php echo $this->createMobileUrl("tzmember");}';
					                          }, 3000);
													  
				    					  }else{	 
				    						  checkorder();
				    					  }
				    				 }
				    			 });
				    		}
				
				
    });
    
    
    
    
    
</script>
