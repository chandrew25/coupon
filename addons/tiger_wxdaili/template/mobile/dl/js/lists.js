$(function(){$(".j-close").click(function(){var e=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"关闭后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Order/cancle_order?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,action:"cancle"},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，订单已关闭！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，订单关闭失败："+e.msg),$.jBox.hideloading()}})}}}),!1}),$(".btn_table_closeAll").click(function(){var e=[],n=$(".table-ckbs:checked");return n.each(function(){e.push($(this).data("id"))}),e.length?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"关闭后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(i){$.jBox.close(i),$.ajax({url:"/Order/cancleAll?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?n.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，订单已关闭！")}):HYD.hint("danger","对不起，关闭订单失败："+e.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要关闭的订单！")}),$(".j-modify").click(function(){var e=$(this).data("id");$.post("/Order/ajax_order_list",{order_id:e},function(n){var n=n.data,i=_.template($("#tpl_order_lists_modify").html(),n),a=$(i),t=function(){n.riseOrDrop=parseFloat(a.find(".j-modify-riseOrDrop").val());var e=a.find(".j-modify-freightipt"),i=a.find(".j-modify-ptout-freight");0==a.find(".j-modify-freight:checked").val()?(n.freight=0,i.text("包邮"),e.attr("disabled",!0)):(n.freight=parseFloat(e.val()),i.text("(包含"+n.freight+"元邮费)"),e.attr("disabled",!1)),n.coupon.money=n.coupon.money?n.coupon.money:0,n.riseOrDrop=isNaN(n.riseOrDrop)?0:n.riseOrDrop,n.realPrice=n.orderPrice-n.coupon.money+n.riseOrDrop+n.freight,a.find(".j-modify-ptout-realPrice").text(n.realPrice.toFixed(2))};a.find(".j-modify-riseOrDrop,.j-modify-freight,.j-modify-freightipt").change(t),$.jBox.show({width:600,title:"修改订单价格",content:a,btnOK:{onBtnClick:function(i){$.jBox.close(i),$.ajax({url:"/Order/cancle_order?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{data:n,id:e,action:"save"},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，订单价格修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，订单价格修改失败："+e.msg),$.jBox.hideloading()}})}}})})}),$(".j-item-sku").click(function(){var e=$(this).data("id");$.post("/Order/get_order_sku",{order_id:e},function(n){var i=_.template($("#tpl_order_lists_sku").html(),n),a=$(i);$.jBox.show({width:600,title:"修改规格",content:a,btnOK:{onBtnClick:function(n){$.jBox.close(n);var i=[],a=[];n.find("select[name='sku_id[]']").each(function(){i.push($(this).val()),a.push($(this).siblings("input[name='item_id[]']").val())}),$.ajax({url:"/Order/update_order_sku?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,sku_ids:i,item_ids:a},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+e.msg),$.jBox.hideloading()}})}}})})}),$(".j-order-deliver").click(function(){var e=$(this).data("id"),n=$(this).data("selfid"),i={self_id:n},a=_.template($("#tpl_order_lists_deliver").html(),i),t=$(a),o=t.find('input[name="is_self_take"]:checked').val();change_deliver(t,o),t.change(".send_deliver",function(){var e=t.find(".send_deliver").val();10==e?t.find(".express_class").removeClass("hide"):t.find(".express_class").addClass("hide")}),t.change('input[name="is_self_take"]',function(){var e=t.find('input[name="is_self_take"]:checked').val();change_deliver(t,e)}),$.jBox.show({width:600,height:600,title:"标记发货",content:t,btnOK:{onBtnClick:function(n){var i=t.find("select[name='deliver_wuliu']"),a=t.find("input[name='deliver_number']"),o=t.find("input[name='express_name']"),d=t.find("input[name='is_self_take']:checked"),s=t.find("select[name='self_address_id']"),r=i.val(),l=o.val(),c=a.val(),f=d.val(),h=s.val();if(0==f){if(""==r)return void HYD.FormShowError(i,"请选择物流公司");if(""==c)return void HYD.FormShowError(a,"请输入快递单号")}else if(1==f){if(0>h)return void HYD.FormShowError(s,"请选择自提地址");if(0==h){var u=t.find("input[name='name']"),m=t.find("input[name='mobile']"),p=t.find("input[name='phone']"),v=t.find("select[name='province_id']"),_=t.find("select[name='city_id']"),x=t.find("select[name='area_id']"),j=t.find("textarea[name='address']"),g=t.find("input[name='shop_name']"),l=u.val(),w=m.val(),y=p.val(),k=v.val(),D=_.val(),b=x.val(),B=g.val(),C=j.val();if(""==l)return void HYD.FormShowError(u,"联系人姓名不能为空");if(""==w)return void HYD.FormShowError(m,"手机号不能为空");if(0==k)return void HYD.FormShowError(v,"请选择省份");if(0==D)return void HYD.FormShowError(_,"请选择城市");if(0==b)return void HYD.FormShowError(x,"请选择地区");if(""==C)return void HYD.FormShowError(j,"请填写详细地址")}}$.jBox.close(n),$.ajax({url:"/Order/ajax_send_goods?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,express:r,express_name:l,express_no:c,is_self_take:f,self_address_id:h,name:l,mobile:w,phone:y,province_id:k,city_id:D,area_id:b,address:C,shop_name:B},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，标记发货成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，标记发货失败："+e.msg),$.jBox.hideloading()}})}}})}),$(".j-self_address").click(function(){var e=$(this).data("id"),n=$(this).data("selfid"),i={self_id:n},a=_.template($("#tpl_order_slef_address").html(),i),t=$(a);t.change(".J-selectAddress",function(){var e=t.find("select[name='self_address_id']").val();0==e?(console.log(e),$(".J-selfname").removeClass("hide"),$(".J-selfmobile").removeClass("hide"),$(".J-selfprovince").removeClass("hide"),$(".J-selfcity").removeClass("hide"),$(".J-selfarea").removeClass("hide"),$(".J-selfaddress").removeClass("hide"),$(".s_province").change(function(){var e=t.find(".s_province").val(),n='<option value="0">请选择</option>';pickerCity(e,function(e){$.each(e,function(e,i){n+="<option value='"+i.city_id+"'>"+i.city_name+"</option>"}),$(".s_city").empty().append(n)})}),t.find(".s_city").change(function(){var e=t.find(".s_city").val(),n='<option value="0">请选择</option>';pickerArea(e,function(e){$.each(e,function(e,i){n+="<option value='"+i.area_id+"'>"+i.area_name+"</option>"}),$(".s_area").empty().append(n)})})):($(".J-selfname").addClass("hide"),$(".J-selfmobile").addClass("hide"),$(".J-selfprovince").addClass("hide"),$(".J-selfcity").addClass("hide"),$(".J-selfarea").addClass("hide"),$(".J-selfaddress").addClass("hide"))}),$.jBox.show({width:600,height:600,title:"标记发货",content:t,btnOK:{onBtnClick:function(n){var i=t.find("select[name='self_address_id']"),a=i.val();if(0>a)return void HYD.FormShowError(i,"请选择自提地址");if(0==a){var o=t.find("input[name='name']"),d=t.find("input[name='mobile']"),s=t.find("input[name='phone']"),r=t.find("select[name='province_id']"),l=t.find("select[name='city_id']"),c=t.find("select[name='area_id']"),f=t.find("textarea[name='address']"),h=o.val(),u=d.val(),m=s.val(),p=r.val(),v=l.val(),_=c.val(),x=f.val();if(""==h)return void HYD.FormShowError(o,"联系人姓名不能为空");if(""==u)return void HYD.FormShowError(d,"手机号不能为空");if(0==p)return void HYD.FormShowError(r,"请选择省份");if(0==v)return void HYD.FormShowError(l,"请选择城市");if(0==_)return void HYD.FormShowError(c,"请选择地区");if(""==x)return void HYD.FormShowError(f,"请填写详细地址")}$.jBox.close(n),$.ajax({url:"/Order/ajax_slef_address?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,self_address_id:a,name:h,mobile:u,phone:m,province_id:p,city_id:v,area_id:_,address:x},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+e.msg),$.jBox.hideloading()}})}}})}),$(".j-no-deliver").click(function(){var e=$(this).data("id");$.jBox.show({width:500,title:"标记发货",content:_.template($("#tpl_jbox_simple").html(),{content:"确认发货吗？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Order/ajax_send_order?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，标记发货成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，标记发货失败："+e.msg),$.jBox.hideloading()}})}}})}),$(".J_batch_invoice").click(function(){var e="",n=$(".table-ckbs:checked");return n.each(function(){e+=$(this).data("id")+","}),e=e.substring(0,e.length-1),e.length?($(":hidden[name='ids']").val(e),void $("#ids").submit()):void HYD.hint("warning","对不起，请选择要打印的订单！")}),$(".J_del_order").click(function(){var e=$(this).data("id");data={id:e};var n=_.template($("#tpl_order_del").html(),data),i=$(n),a=i.find("textarea[name='del_remark']");return $.jBox.show({title:"提示",content:i,btnOK:{onBtnClick:function(n){val_remark=a.val(),$.jBox.close(n),$.ajax({url:"/Order/del_order?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,remark:val_remark},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜，订单已删除！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","抱歉，订单删除失败："+e.msg),$.jBox.hideloading()}})}}}),!1}),$(".J_batch_del").click(function(){var e=[],n=$(".table-ckbs:checked");return n.each(function(){e.push($(this).data("id"))}),e.length?($.jBox.show({title:"提示",content:_.template($("#tpl_order_del").html()),btnOK:{onBtnClick:function(n){remark=n.find('textarea[name="del_remark"]').val(),$.jBox.close(n),$.ajax({url:"/Order/batch_del_order?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,remark:remark},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜，订单批量删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","抱歉，订单批量删除失败："+e.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要关闭的订单！")}),$(".J_batch_deliver").click(function(){var e=[],n=$(".table-ckbs:checked");if(n.each(function(){e.push($(this).data("id"))}),!e.length)return void HYD.hint("warning","对不起，请选择要发货的订单！");var i=$("#tpl_order_lists_deliver").html(),i=_.template(i,{self_id:0}),a=$(i),t=a.find('input[name="is_self_take"]:checked').val();return change_deliver(a,t),a.change(".send_deliver",function(){var e=a.find(".send_deliver").val();10==e?a.find(".express_class").removeClass("hide"):a.find(".express_class").addClass("hide")}),a.change('input[name="is_self_take"]',function(){var e=a.find('input[name="is_self_take"]:checked').val();change_deliver(a,e)}),a.find('select[name="province_id"]').change(function(e){var n=a.find('.select[name="province_id"]').val();change_deliver(a,n)}),$.jBox.show({width:600,height:600,title:"批量发货",content:a,btnOK:{onBtnClick:function(n){var i=a.find("select[name='deliver_wuliu']"),t=a.find("input[name='deliver_number']"),o=a.find("input[name='express_name']"),d=a.find("input[name='is_self_take']:checked"),s=i.val(),r=o.val(),l=t.val(),c=d.val(),f=a.find("select[name='self_address_id']"),s=i.val(),r=o.val(),l=t.val(),c=d.val(),h=f.val();if(console.log(l.length),c){if(1==c){if(0>h)return void HYD.FormShowError(f,"请选择自提地址");if(0==h){var u=a.find("input[name='name']"),m=a.find("input[name='mobile']"),p=a.find("select[name='province_id']"),v=a.find("select[name='city_id']"),_=a.find("select[name='area_id']"),x=a.find("textarea[name='address']"),r=u.val(),j=m.val(),g=p.val(),w=v.val(),y=_.val(),k=x.val();if(""==r)return void HYD.FormShowError(u,"联系人姓名不能为空");if(""==j)return void HYD.FormShowError(m,"手机号不能为空");if(0==g)return void HYD.FormShowError(p,"请选择省份");if(0==w)return void HYD.FormShowError(v,"请选择城市");if(0==y)return void HYD.FormShowError(_,"请选择地区");if(""==k)return void HYD.FormShowError(x,"请填写详细地址")}}}else{if(""==s)return void HYD.FormShowError(i,"请选择物流公司");if(""==l)return void HYD.FormShowError(t,"请输入快递单号");if(l.length<5)return void HYD.FormShowError(t,"输入快递单号不能小于5位")}$.jBox.close(n),$.ajax({url:"/Order/batch_deliver?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{ids:e,express:s,express_name:r,express_no:l,is_self_take:c,self_address_id:h,name:r,mobile:j,province_id:g,city_id:w,area_id:y,address:k},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?HYD.hint("success","恭喜您，批量发货成功！"):HYD.hint("danger","对不起，批量发货失败："+e.msg),setTimeout(function(){window.location.reload()},1e3),$.jBox.hideloading()}})}}}),!1}),$(".j-confrimpay").click(function(){var e=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认付款后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Order/comfrimPay?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+e.msg),$.jBox.hideloading()}})}}}),!1}),$(".intem").click(function(){$(this).addClass("cur").siblings().removeClass("cur");var e=parseInt($(this).text());$.post("/Order/lists",{pagelist:e},function(e){window.location.href=""})}),$(".j-order-express").click(function(){var e=$(this).data("id"),n=$(this).data("express"),i=$(this).data("no"),a=$(this).data("name"),t={express:n,express_no:i,express_name:a},o=_.template($("#tpl_order_lists_express").html(),t),d=$(o);10==n?d.find(".express_class").removeClass("hide"):d.find(".express_class").addClass("hide"),d.change(".send_deliver",function(){var e=d.find(".send_deliver").val();10==e?d.find(".express_class").removeClass("hide"):d.find(".express_class").addClass("hide")}),$.jBox.show({width:500,title:"修改快递信息",content:d,btnOK:{onBtnClick:function(n){var i=d.find("select[name='deliver_wuliu']"),a=d.find("input[name='deliver_number']"),t=d.find("input[name='express_name']"),o=i.val(),s=t.val(),r=a.val();return""==o?void HYD.FormShowError(i,"请选择物流公司"):""==r?void HYD.FormShowError(a,"请输入快递单号"):($.jBox.close(n),void $.ajax({url:"/Order/ajaxSaveExpressno?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,express:o,express_name:s,express_no:r},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+e.msg),$.jBox.hideloading()}}))}}})}),$(".j-confirm-order").click(function(){var e=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认标记收货吗？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Order/ConfirmOrder?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+e.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-update-address").click(function(){var e=$(this).data("id"),n=$(this).data("name"),i=$(this).data("mobile"),a=$(this).data("address"),t={name:n,mobile:i,address:a},o=_.template($("#tpl_order_lists_address").html(),t),d=$(o);$.jBox.show({width:500,title:"修改收货地址",content:d,btnOK:{onBtnClick:function(n){var i=d.find("input[name='name']"),a=d.find("input[name='mobile']"),t=d.find("input[name='address']"),o=i.val(),s=a.val(),r=t.val();return""==o?void HYD.FormShowError(i,"收货人姓名不能为空"):""==s?void HYD.FormShowError(a,"手机号不能为空"):""==r?void HYD.FormShowError(t,"收货地址不能为空"):($.jBox.close(n),void $.ajax({url:"/Order/ajaxSaveAddress?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:e,name:o,mobile:s,address:r},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+e.msg),$.jBox.hideloading()}}))}}})}),$(".J_province").change(function(){var e=$(this).val(),n='<option value="0">所有城市</option>';pickerCity(e,function(e){$.each(e,function(e,i){n+="<option value='"+i.city_id+"'>"+i.city_name+"</option>"}),$(".J_city").empty().append(n),$(".J_area").empty().append('<option value="0">所有区域</option>')})}),$(".J_city").change(function(){var e=$(this).val(),n='<option value="0">所有区域</option>';pickerArea(e,function(e){$.each(e,function(e,i){n+="<option value='"+i.area_id+"'>"+i.area_name+"</option>"}),$(".J_area").empty().append(n)})}),_QV_="%E6%9D%AD%E5%B7%9E%E5%90%AF%E5%8D%9A%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89"});var pickerCity=function(e,n){$.ajax({url:"/System/getCity?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{province_id:e},success:function(e){1==e.status&&n&&n(e.data)}})},pickerArea=function(e,n){$.ajax({url:"/System/getArea?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{city_id:e},success:function(e){1==e.status&&n&&n(e.data)}})},change_deliver=function(e,n){if(1==n){e.find(".J_express_company").addClass("hide"),e.find(".express_class").addClass("hide"),e.find(".J_express_no").addClass("hide"),e.find(".J_select_address").removeClass("hide");var i=e.find("select[name='self_address_id']").val();0==i?(e.find(".J-name").removeClass("hide"),e.find(".J-mobile").removeClass("hide"),e.find(".J-province").removeClass("hide"),e.find(".J-city").removeClass("hide"),e.find(".J-area").removeClass("hide"),e.find(".J-address").removeClass("hide"),e.find(".s_province").change(function(){var n=e.find(".s_province").val(),i='<option value="0">请选择</option>';pickerCity(n,function(e){$.each(e,function(e,n){i+="<option value='"+n.city_id+"'>"+n.city_name+"</option>"}),$(".s_city").empty().append(i)})}),e.find(".s_city").change(function(){var n=e.find(".s_city").val(),i='<option value="0">请选择</option>';pickerArea(n,function(e){$.each(e,function(e,n){i+="<option value='"+n.area_id+"'>"+n.area_name+"</option>"}),$(".s_area").empty().append(i)})})):(e.find(".J-name").addClass("hide"),e.find(".J-mobile").addClass("hide"),e.find(".J-province").addClass("hide"),e.find(".J-city").addClass("hide"),e.find(".J-area").addClass("hide"),e.find(".J-address").addClass("hide"))}else{e.find(".J_express_company").removeClass("hide"),e.find(".J_express_no").removeClass("hide"),e.find(".J_select_address").addClass("hide"),e.find(".J-name").addClass("hide"),e.find(".J-mobile").addClass("hide"),e.find(".J-province").addClass("hide"),e.find(".J-city").addClass("hide"),e.find(".J-area").addClass("hide"),e.find(".J-address").addClass("hide");var n=e.find(".send_deliver").val();10==n?e.find(".express_class").removeClass("hide"):e.find(".express_class").addClass("hide")}};